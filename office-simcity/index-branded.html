<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SpawnKit â€” SimCity Office</title>
<script>window.OC_RELAY_URL = window.OC_RELAY_URL || 'http://127.0.0.1:18790';</script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
  /* ============================================================
     iOS Brand Design System â€” SimCity Theme Integration
     ============================================================ */

  :root {
    /* --- iOS Typography --- */
    --font-display: 'Inter', -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;
    --font-body: 'Inter', -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'Segoe UI', Roboto, sans-serif;

    /* --- iOS Color System (Dark Mode for SimCity) --- */
    --color-bg-primary: #000000;
    --color-bg-secondary: #1c1c1e;
    --color-bg-tertiary: #2c2c2e;
    --color-surface: #1c1c1e;
    --color-text-primary: #f5f5f7;
    --color-text-secondary: #86868b;
    --color-text-tertiary: #636366;
    --color-border: #38383a;
    --color-border-light: #2c2c2e;
    --color-nav-bg: rgba(29, 29, 31, 0.72);
    --color-nav-border: rgba(255, 255, 255, 0.08);

    /* --- SpawnKit Brand Colors (SimCity = Green Theme) --- */
    --color-accent: #30d158;
    --color-accent-hover: #3dd663;
    --color-accent-active: #2db84e;
    --color-accent-light: rgba(48, 209, 88, 0.1);

    /* --- Semantic Colors (iOS Dark) --- */
    --status-active: #30d158;
    --status-busy: #ffd60a;
    --status-idle: var(--color-text-secondary);
    --status-error: #ff453a;
    --status-warning: #ff9f0a;

    /* --- Spacing (4px base) --- */
    --space-1: 4px;
    --space-2: 8px;
    --space-3: 12px;
    --space-4: 16px;
    --space-5: 20px;
    --space-6: 24px;
    --space-8: 32px;

    /* --- Border Radius --- */
    --radius-sm: 8px;
    --radius-md: 12px;
    --radius-lg: 20px;
    --radius-pill: 980px;

    /* --- iOS Animations --- */
    --ease-out: cubic-bezier(0.25, 0.46, 0.45, 0.94);
    --ease-apple: cubic-bezier(0.4, 0, 0.2, 1);
    --ease-spring: cubic-bezier(0.25, 1, 0.5, 1);
    --duration-fast: 150ms;
    --duration-normal: 300ms;

    /* --- Shadows (Dark Mode) --- */
    --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.3);
    --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.3);
    --shadow-lg: 0 8px 40px rgba(0, 0, 0, 0.4);
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     Reset & Base (iOS Standards)
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  * { 
    margin: 0; 
    padding: 0; 
    box-sizing: border-box; 
  }
  
  html, body {
    width: 100%; 
    height: 100%; 
    overflow: hidden; 
    background: var(--color-bg-primary);
    font-family: var(--font-body);
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-rendering: optimizeLegibility;
  }
  
  canvas { 
    display: block; 
    cursor: grab; 
  }
  
  canvas.grabbing { 
    cursor: grabbing; 
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     iOS-Style Navigation Header
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  #topbar {
    position: fixed; 
    top: 0; 
    left: 0; 
    right: 0; 
    height: 52px;
    background: var(--color-nav-bg);
    backdrop-filter: saturate(180%) blur(20px);
    -webkit-backdrop-filter: saturate(180%) blur(20px);
    display: flex; 
    align-items: center; 
    justify-content: space-between;
    color: var(--color-text-primary); 
    font-size: var(--text-base);
    font-weight: 600;
    z-index: 1000; 
    border-bottom: 1px solid var(--color-nav-border);
    letter-spacing: -0.01em; 
    padding: 0 var(--space-5);
    font-family: var(--font-display);
  }

  #topbar .sep { 
    margin: 0 var(--space-2); 
    opacity: 0.3; 
  }
  
  /* â”€â”€ SpawnKit Brand Badge â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .brand-badge {
    display: flex; 
    align-items: center; 
    gap: var(--space-2);
    background: var(--color-accent-light);
    border: 1px solid rgba(48, 209, 88, 0.3); 
    border-radius: var(--radius-pill); 
    padding: 6px var(--space-3);
    font-size: 0.8125rem; 
    font-weight: 600; 
    color: var(--color-accent);
  }
  
  .brand-badge-icon { 
    font-size: 1rem; 
  }
  
  /* â”€â”€ Agent Status List â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .agent-status-list {
    display: flex; 
    align-items: center; 
    gap: var(--space-3); 
    font-size: 0.8125rem;
  }
  
  .agent-status-item {
    display: flex; 
    align-items: center; 
    gap: var(--space-1);
    padding: 3px var(--space-2); 
    border-radius: var(--radius-sm);
    background: var(--color-bg-tertiary); 
    font-weight: 500;
  }
  
  .status-dot { 
    width: 6px; 
    height: 6px; 
    border-radius: 50%; 
    background: var(--status-active); 
  }

  .status-dot.busy { background: var(--status-busy); }
  .status-dot.idle { background: var(--status-idle); }
  .status-dot.error { background: var(--status-error); }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     iOS-Style Agent Labels
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .agent-label {
    position: fixed; 
    pointer-events: auto; 
    z-index: 50;
    transform: translate(-50%, -100%);
    background: var(--color-nav-bg); 
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border-radius: var(--radius-pill); 
    padding: 4px var(--space-3) 5px;
    font-size: 0.6875rem; 
    font-weight: 600; 
    color: var(--color-text-primary);
    white-space: nowrap; 
    border: 1px solid var(--color-nav-border);
    cursor: pointer;
    transition: all var(--duration-fast) var(--ease-apple);
    font-family: var(--font-body);
    letter-spacing: -0.005em;
  }
  
  .agent-label:hover {
    background: var(--color-accent-light);
    border-color: rgba(48, 209, 88, 0.4);
    transform: translate(-50%, -100%) translateY(-1px);
    box-shadow: var(--shadow-sm);
  }
  
  .agent-label .dot {
    display: inline-block; 
    width: 7px; 
    height: 7px; 
    border-radius: 50%;
    margin-right: 5px; 
    vertical-align: middle;
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     iOS-Style Info Panel
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  #infopanel {
    position: fixed; 
    bottom: 0; 
    left: 0; 
    right: 0;
    background: var(--color-nav-bg); 
    backdrop-filter: saturate(180%) blur(20px);
    -webkit-backdrop-filter: saturate(180%) blur(20px);
    color: var(--color-text-primary); 
    padding: var(--space-4) var(--space-5) var(--space-4);
    z-index: 100; 
    border-top: 1px solid var(--color-nav-border);
    display: none;
    transform: translateY(100%);
    transition: transform var(--duration-normal) var(--ease-spring);
  }

  #infopanel.show {
    transform: translateY(0);
  }
  
  #infopanel .name { 
    font-size: var(--text-lg); 
    font-weight: 700; 
    letter-spacing: -0.01em; 
    font-family: var(--font-display);
  }
  
  #infopanel .role { 
    font-size: 0.75rem; 
    opacity: 0.7; 
    margin-top: 2px; 
    color: var(--color-text-secondary);
  }
  
  #infopanel .status { 
    font-size: 0.875rem; 
    margin-top: var(--space-2); 
    color: var(--color-text-secondary);
  }
  
  #infopanel .close {
    position: absolute; 
    top: var(--space-2); 
    right: var(--space-4); 
    cursor: pointer;
    color: var(--color-text-tertiary); 
    font-size: 1.25rem; 
    line-height: 1;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: all var(--duration-fast) var(--ease-out);
  }
  
  #infopanel .close:hover { 
    color: var(--color-text-primary); 
    background: var(--color-bg-tertiary);
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     iOS-Style Controls
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  #controls {
    position: fixed; 
    bottom: var(--space-5); 
    right: var(--space-4); 
    z-index: 100;
    display: flex; 
    flex-direction: column; 
    gap: var(--space-1);
  }

  #controls button {
    width: 44px; 
    height: 44px; 
    border: none; 
    border-radius: 50%;
    background: var(--color-nav-bg); 
    color: var(--color-text-primary); 
    font-size: 1.125rem;
    cursor: pointer; 
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border: 1px solid var(--color-nav-border);
    display: flex; 
    align-items: center; 
    justify-content: center;
    transition: all var(--duration-fast) var(--ease-apple);
    font-family: var(--font-body);
  }
  
  #controls button:hover {
    background: var(--color-accent-light);
    border-color: rgba(48, 209, 88, 0.35);
    transform: translateY(-1px);
    box-shadow: var(--shadow-sm);
  }

  #controls button:active {
    transform: translateY(0);
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     iOS-Style Loading Screen
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  #loading {
    position: fixed; 
    inset: 0; 
    z-index: 2000;
    background: var(--color-bg-primary); 
    display: flex; 
    align-items: center; 
    justify-content: center;
    color: var(--color-accent); 
    font-size: 0.9375rem; 
    flex-direction: column; 
    gap: var(--space-3);
    font-family: var(--font-body);
    font-weight: 500; 
    letter-spacing: -0.005em;
  }

  #loading h2 {
    font-family: var(--font-display);
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--color-text-primary);
    margin-bottom: var(--space-2);
    letter-spacing: -0.02em;
  }
  
  #loading .bar { 
    width: 200px; 
    height: 4px; 
    background: var(--color-bg-tertiary); 
    border-radius: 2px; 
    overflow: hidden; 
  }
  
  #loading .fill { 
    height: 100%; 
    background: var(--color-accent); 
    border-radius: 2px; 
    transition: width 0.3s var(--ease-apple); 
    width: 0%;
  }

  .loading-fade {
    opacity: 1;
    transition: opacity var(--duration-normal) var(--ease-out);
  }

  .loading-fade.hidden {
    opacity: 0;
    pointer-events: none;
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     iOS-Style Status Bar (Bottom)
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  #village-statusbar {
    position: fixed; 
    bottom: 0; 
    left: 0; 
    right: 0;
    height: 52px; 
    z-index: 120;
    background: var(--color-nav-bg);
    backdrop-filter: saturate(180%) blur(20px);
    -webkit-backdrop-filter: saturate(180%) blur(20px);
    border-top: 1px solid var(--color-nav-border);
    display: flex; 
    align-items: center; 
    gap: var(--space-3);
    padding: 0 var(--space-4);
    font-family: var(--font-body);
  }
  
  .vsb-info {
    display: flex; 
    align-items: center; 
    gap: var(--space-2); 
    flex-shrink: 0;
  }
  
  .vsb-dot {
    width: 8px; 
    height: 8px; 
    border-radius: 50%;
    background: var(--color-accent);
    box-shadow: 0 0 6px rgba(48, 209, 88, 0.5);
    animation: statusPulse 2.5s ease-in-out infinite;
    flex-shrink: 0;
  }

  .vsb-text {
    font-size: 0.8125rem;
    font-weight: 500;
    color: var(--color-text-secondary);
    letter-spacing: -0.005em;
  }

  .vsb-metrics {
    display: flex;
    align-items: center;
    gap: var(--space-4);
    margin-left: auto;
  }

  .vsb-metric {
    display: flex;
    align-items: center;
    gap: var(--space-1);
    font-size: 0.8125rem;
    color: var(--color-text-secondary);
  }

  .vsb-metric-value {
    font-weight: 600;
    color: var(--color-text-primary);
  }

  @keyframes statusPulse {
    0%, 100% { 
      opacity: 1; 
      transform: scale(1); 
    }
    50% { 
      opacity: 0.6; 
      transform: scale(1.1); 
    }
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     iOS-Style Agent Tooltips
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .agent-tooltip {
    position: fixed;
    background: var(--color-nav-bg);
    backdrop-filter: saturate(180%) blur(20px);
    -webkit-backdrop-filter: saturate(180%) blur(20px);
    border: 1px solid var(--color-nav-border);
    border-radius: var(--radius-md);
    padding: var(--space-3) var(--space-4);
    color: var(--color-text-primary);
    font-size: 0.75rem;
    line-height: 1.4;
    max-width: 220px;
    z-index: 200;
    display: none;
    pointer-events: none;
    box-shadow: var(--shadow-md);
    font-family: var(--font-body);
  }

  .agent-tooltip .name {
    font-weight: 600;
    font-size: 0.875rem;
    letter-spacing: -0.01em;
    margin-bottom: 2px;
  }

  .agent-tooltip .role {
    color: var(--color-accent);
    font-size: 0.6875rem;
    font-weight: 500;
    margin-bottom: 4px;
  }

  .agent-tooltip .status {
    color: var(--color-text-secondary);
    font-size: 0.6875rem;
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     Responsive Design
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  @media (max-width: 768px) {
    #topbar {
      padding: 0 var(--space-3);
      font-size: 0.9375rem;
    }

    .agent-status-list {
      display: none; /* Hide on mobile to save space */
    }

    #controls {
      bottom: 70px; /* Account for status bar */
    }

    #controls button {
      width: 40px;
      height: 40px;
    }
  }

  @media (max-width: 480px) {
    #topbar {
      height: 48px;
    }

    .brand-badge {
      font-size: 0.75rem;
      padding: 4px var(--space-2);
    }
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     Canvas-specific styling
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  #main-canvas {
    background: var(--color-bg-primary);
    image-rendering: pixelated;
    image-rendering: -moz-crisp-edges;
    image-rendering: crisp-edges;
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     iOS Button Components
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .btn-primary {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-2);
    padding: 12px 24px;
    font-family: var(--font-body);
    font-size: 0.9375rem;
    font-weight: 600;
    line-height: 1;
    text-decoration: none;
    border: none;
    border-radius: var(--radius-pill);
    cursor: pointer;
    transition: all var(--duration-fast) var(--ease-out);
    white-space: nowrap;
    background-color: var(--color-accent);
    color: var(--color-bg-primary);
  }

  .btn-primary:hover {
    background-color: var(--color-accent-hover);
    transform: translateY(-1px);
    text-decoration: none;
  }

  .btn-primary:active {
    background-color: var(--color-accent-active);
    transform: translateY(0);
  }

  .btn-secondary {
    background-color: transparent;
    color: var(--color-accent);
    border: 1.5px solid var(--color-border);
  }

  .btn-secondary:hover {
    background-color: var(--color-accent-light);
    border-color: var(--color-accent);
  }
</style>
</head>
<body>
  <!-- iOS-Style Navigation Header -->
  <div id="topbar">
    <div class="brand-badge">
      <span class="brand-badge-icon">ğŸ™ï¸</span>
      <span>SpawnKit SimCity</span>
    </div>
    
    <div class="agent-status-list">
      <div class="agent-status-item">
        <div class="status-dot"></div>
        <span>CEO Active</span>
      </div>
      <div class="agent-status-item">
        <div class="status-dot busy"></div>
        <span>Atlas Busy</span>
      </div>
      <div class="agent-status-item">
        <div class="status-dot"></div>
        <span>Forge Online</span>
      </div>
    </div>
  </div>

  <!-- Main Canvas -->
  <canvas id="main-canvas"></canvas>

  <!-- iOS-Style Agent Info Panel -->
  <div id="infopanel">
    <div class="close">Ã—</div>
    <div class="name"></div>
    <div class="role"></div>
    <div class="status"></div>
  </div>

  <!-- iOS-Style Controls -->
  <div id="controls">
    <button id="zoomIn" title="Zoom In">+</button>
    <button id="zoomOut" title="Zoom Out">âˆ’</button>
    <button id="reset" title="Reset View">âŒ‚</button>
  </div>

  <!-- iOS-Style Status Bar -->
  <div id="village-statusbar">
    <div class="vsb-info">
      <div class="vsb-dot"></div>
      <span class="vsb-text">SpawnKit SimCity Active</span>
    </div>
    <div class="vsb-metrics">
      <div class="vsb-metric">
        <span>Agents:</span>
        <span class="vsb-metric-value" id="agentCount">6</span>
      </div>
      <div class="vsb-metric">
        <span>Tasks:</span>
        <span class="vsb-metric-value" id="taskCount">24</span>
      </div>
      <div class="vsb-metric">
        <span>Uptime:</span>
        <span class="vsb-metric-value" id="uptimeCount">99.2%</span>
      </div>
    </div>
  </div>

  <!-- iOS-Style Loading Screen -->
  <div id="loading" class="loading-fade">
    <h2>Loading SpawnKit SimCity</h2>
    <div>Initializing agent workspace...</div>
    <div class="bar">
      <div class="fill" id="loadingFill"></div>
    </div>
  </div>

  <script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // SimCity Theme JavaScript with iOS Integration
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    // Global variables
    let canvas, ctx;
    let viewX = 0, viewY = 0, zoom = 1;
    let isDragging = false, lastMouseX = 0, lastMouseY = 0;
    let agents = [];
    let agentLabels = [];

    // Initialize the application
    function init() {
      canvas = document.getElementById('main-canvas');
      ctx = canvas.getContext('2d');
      
      // Set canvas size
      resizeCanvas();
      window.addEventListener('resize', resizeCanvas);
      
      // Setup event listeners
      setupEventListeners();
      
      // Load agents
      loadAgents();
      
      // Start rendering loop
      requestAnimationFrame(render);
      
      // Simulate loading
      simulateLoading();
    }

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }

    function setupEventListeners() {
      // Mouse events for dragging
      canvas.addEventListener('mousedown', startDrag);
      canvas.addEventListener('mousemove', drag);
      canvas.addEventListener('mouseup', endDrag);
      canvas.addEventListener('mouseleave', endDrag);
      
      // Zoom controls
      document.getElementById('zoomIn').addEventListener('click', () => {
        zoom = Math.min(zoom * 1.2, 3);
      });
      
      document.getElementById('zoomOut').addEventListener('click', () => {
        zoom = Math.max(zoom / 1.2, 0.3);
      });
      
      document.getElementById('reset').addEventListener('click', () => {
        viewX = 0;
        viewY = 0;
        zoom = 1;
      });

      // Info panel close
      document.querySelector('#infopanel .close').addEventListener('click', () => {
        hideInfoPanel();
      });
    }

    function startDrag(e) {
      isDragging = true;
      lastMouseX = e.clientX;
      lastMouseY = e.clientY;
      canvas.style.cursor = 'grabbing';
      canvas.classList.add('grabbing');
    }

    function drag(e) {
      if (!isDragging) return;
      
      const deltaX = e.clientX - lastMouseX;
      const deltaY = e.clientY - lastMouseY;
      
      viewX += deltaX / zoom;
      viewY += deltaY / zoom;
      
      lastMouseX = e.clientX;
      lastMouseY = e.clientY;
    }

    function endDrag() {
      isDragging = false;
      canvas.style.cursor = 'grab';
      canvas.classList.remove('grabbing');
    }

    function loadAgents() {
      // Sample agents for SimCity theme
      agents = [
        { 
          id: 'ceo', 
          name: 'CEO Agent', 
          role: 'Strategic Oversight',
          x: 300, 
          y: 200, 
          status: 'active',
          icon: 'ğŸ‘‘',
          color: '#0071e3'
        },
        { 
          id: 'atlas', 
          name: 'Atlas Agent', 
          role: 'Knowledge Mapping',
          x: 500, 
          y: 250, 
          status: 'busy',
          icon: 'ğŸ—ºï¸',
          color: '#8b5cf6'
        },
        { 
          id: 'forge', 
          name: 'Forge Agent', 
          role: 'Development',
          x: 400, 
          y: 350, 
          status: 'active',
          icon: 'ğŸ”¨',
          color: '#f56300'
        },
        { 
          id: 'hunter', 
          name: 'Hunter Agent', 
          role: 'Data Collection',
          x: 600, 
          y: 300, 
          status: 'active',
          icon: 'ğŸ¯',
          color: '#ff453a'
        },
        { 
          id: 'echo', 
          name: 'Echo Agent', 
          role: 'Communication',
          x: 350, 
          y: 450, 
          status: 'active',
          icon: 'ğŸ“¡',
          color: '#0077ed'
        },
        { 
          id: 'sentinel', 
          name: 'Sentinel Agent', 
          role: 'Security',
          x: 550, 
          y: 400, 
          status: 'active',
          icon: 'ğŸ›¡ï¸',
          color: '#30d158'
        }
      ];

      // Create agent labels
      createAgentLabels();
    }

    function createAgentLabels() {
      agents.forEach(agent => {
        const label = document.createElement('div');
        label.className = 'agent-label';
        label.innerHTML = `<span class="dot" style="background-color: ${agent.color}"></span>${agent.name}`;
        label.addEventListener('click', () => showAgentInfo(agent));
        document.body.appendChild(label);
        agentLabels.push({ element: label, agent });
      });
    }

    function updateAgentLabels() {
      agentLabels.forEach(({ element, agent }) => {
        const screenX = (agent.x + viewX) * zoom + canvas.width / 2;
        const screenY = (agent.y + viewY) * zoom + canvas.height / 2;
        
        element.style.left = screenX + 'px';
        element.style.top = (screenY - 40) + 'px';
        
        // Hide labels that are off-screen
        const isVisible = screenX > -100 && screenX < canvas.width + 100 && 
                         screenY > -100 && screenY < canvas.height + 100;
        element.style.display = isVisible ? 'block' : 'none';
      });
    }

    function showAgentInfo(agent) {
      const panel = document.getElementById('infopanel');
      panel.querySelector('.name').textContent = agent.name;
      panel.querySelector('.role').textContent = agent.role;
      panel.querySelector('.status').textContent = `Status: ${agent.status}`;
      panel.style.display = 'block';
      
      // Trigger animation
      setTimeout(() => {
        panel.classList.add('show');
      }, 10);
    }

    function hideInfoPanel() {
      const panel = document.getElementById('infopanel');
      panel.classList.remove('show');
      
      setTimeout(() => {
        panel.style.display = 'none';
      }, 300);
    }

    function render() {
      // Clear canvas
      ctx.fillStyle = '#000000';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      // Save context
      ctx.save();
      
      // Apply zoom and pan
      ctx.translate(canvas.width / 2, canvas.height / 2);
      ctx.scale(zoom, zoom);
      ctx.translate(viewX, viewY);
      
      // Draw grid
      drawGrid();
      
      // Draw agents
      drawAgents();
      
      // Draw connections
      drawConnections();
      
      // Restore context
      ctx.restore();
      
      // Update agent labels
      updateAgentLabels();
      
      requestAnimationFrame(render);
    }

    function drawGrid() {
      ctx.strokeStyle = 'rgba(48, 209, 88, 0.1)';
      ctx.lineWidth = 1 / zoom;
      
      const gridSize = 50;
      const startX = Math.floor(-viewX / gridSize) * gridSize;
      const startY = Math.floor(-viewY / gridSize) * gridSize;
      const endX = startX + (canvas.width / zoom) + gridSize;
      const endY = startY + (canvas.height / zoom) + gridSize;
      
      ctx.beginPath();
      for (let x = startX; x <= endX; x += gridSize) {
        ctx.moveTo(x, startY);
        ctx.lineTo(x, endY);
      }
      for (let y = startY; y <= endY; y += gridSize) {
        ctx.moveTo(startX, y);
        ctx.lineTo(endX, y);
      }
      ctx.stroke();
    }

    function drawAgents() {
      agents.forEach(agent => {
        // Draw agent building/node
        ctx.fillStyle = agent.color;
        ctx.fillRect(agent.x - 25, agent.y - 25, 50, 50);
        
        // Draw status indicator
        const statusColors = {
          active: '#30d158',
          busy: '#ffd60a',
          idle: '#86868b',
          error: '#ff453a'
        };
        
        ctx.fillStyle = statusColors[agent.status] || '#86868b';
        ctx.beginPath();
        ctx.arc(agent.x + 20, agent.y - 20, 5, 0, Math.PI * 2);
        ctx.fill();
      });
    }

    function drawConnections() {
      // Draw simple connections between agents
      ctx.strokeStyle = 'rgba(48, 209, 88, 0.3)';
      ctx.lineWidth = 2 / zoom;
      
      // Connect some agents as an example
      const connections = [
        [0, 1], // CEO to Atlas
        [0, 2], // CEO to Forge
        [1, 3], // Atlas to Hunter
        [2, 4], // Forge to Echo
        [4, 5]  // Echo to Sentinel
      ];
      
      ctx.beginPath();
      connections.forEach(([fromIndex, toIndex]) => {
        const from = agents[fromIndex];
        const to = agents[toIndex];
        ctx.moveTo(from.x, from.y);
        ctx.lineTo(to.x, to.y);
      });
      ctx.stroke();
    }

    function simulateLoading() {
      const loadingElement = document.getElementById('loading');
      const fillElement = document.getElementById('loadingFill');
      let progress = 0;
      
      const loadingInterval = setInterval(() => {
        progress += Math.random() * 10;
        if (progress > 100) progress = 100;
        
        fillElement.style.width = progress + '%';
        
        if (progress >= 100) {
          clearInterval(loadingInterval);
          setTimeout(() => {
            loadingElement.classList.add('hidden');
          }, 500);
        }
      }, 150);
    }

    // Update metrics periodically
    function updateMetrics() {
      const activeAgents = agents.filter(a => a.status === 'active').length;
      const totalTasks = agents.reduce((sum, a) => sum + Math.floor(Math.random() * 5 + 2), 0);
      const uptime = (99.0 + Math.random() * 0.9).toFixed(1);
      
      document.getElementById('agentCount').textContent = agents.length;
      document.getElementById('taskCount').textContent = totalTasks;
      document.getElementById('uptimeCount').textContent = uptime + '%';
    }

    // Initialize when DOM is ready
    document.addEventListener('DOMContentLoaded', () => {
      init();
      
      // Update metrics every 5 seconds
      setInterval(updateMetrics, 5000);
      updateMetrics();
    });

    // Handle window resize
    window.addEventListener('resize', () => {
      resizeCanvas();
    });

    // Prevent context menu on canvas
    canvas.addEventListener('contextmenu', (e) => {
      e.preventDefault();
    });

    console.log('ğŸ™ï¸ SpawnKit SimCity theme loaded with iOS branding');
  </script>
</body>
</html>