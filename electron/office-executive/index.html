<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpawnKit — Executive Office</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* ═══════════════════════════════════════════════════════════════
           SpawnKit Executive Office v3 — Apple × Linear × Raycast
           Premium light-mode AI workspace. SS+ quality.
           SVG Avatars + Hierarchy View + Agent TODO Panel
           ═══════════════════════════════════════════════════════════════ */

        :root {
            /* ── Executive Palette ──────────────────────────── */
            --exec-blue: #007AFF;
            --exec-blue-hover: #0A84FF;
            --exec-blue-muted: rgba(0, 122, 255, 0.15);
            --exec-blue-glow: rgba(0, 122, 255, 0.3);
            --exec-white: #FFFFFF;
            --exec-gray-50: #F5F5F7;
            --exec-gray-100: #E5E5EA;
            --exec-gray-200: #C7C7CC;
            --exec-gray-300: #AEAEB2;
            --exec-gray-400: #8E8E93;
            --exec-gray-500: #636366;
            --exec-gray-600: #48484A;
            --exec-gray-700: #3A3A3C;
            --exec-gray-800: #2C2C2E;
            --exec-gray-900: #1C1C1E;
            --exec-black: #000000;

            /* ── Semantic Colors (Light Mode Default) ───────── */
            --bg-primary: #F5F5F7;
            --bg-secondary: var(--exec-white);
            --bg-tertiary: var(--exec-gray-50);
            --bg-room: rgba(255, 255, 255, 0.85);
            --bg-room-hover: rgba(255, 255, 255, 0.95);
            --bg-frosted: rgba(255, 255, 255, 0.72);
            --text-primary: var(--exec-gray-900);
            --text-secondary: var(--exec-gray-600);
            --text-tertiary: var(--exec-gray-500);
            --border-subtle: rgba(0, 0, 0, 0.06);
            --border-medium: rgba(0, 0, 0, 0.1);
            --border-strong: rgba(0, 0, 0, 0.16);

            /* ── Status Colors ──────────────────────────────── */
            --status-active: #30D158;
            --status-busy: #FFD60A;
            --status-idle: var(--exec-gray-500);
            --status-error: #FF453A;

            /* ── Agent Brand Colors ─────────────────────────── */
            --color-ceo: var(--exec-blue);
            --color-atlas: #BF5AF2;
            --color-forge: #FF9F0A;
            --color-hunter: #FF453A;
            --color-echo: #0A84FF;
            --color-sentinel: #30D158;

            /* ── Typography ─────────────────────────────────── */
            --font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;

            /* ── Animation ──────────────────────────────────── */
            --ease-smooth: cubic-bezier(0.2, 0.8, 0.2, 1);
            --ease-spring: cubic-bezier(0.34, 1.56, 0.64, 1);
            --ease-out: cubic-bezier(0, 0, 0.2, 1);

            /* ── Layout ─────────────────────────────────────── */
            --room-radius: 16px;
            --panel-width: 380px;
        }

        /* ═══════════════════════════════════════════════════
           Reset & Base
           ═══════════════════════════════════════════════════ */
        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: var(--font-family);
            background: var(--bg-primary);
            color: var(--text-primary);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* ═══════════════════════════════════════════════════
           Ambient Background — Subtle Grain + Gradient
           ═══════════════════════════════════════════════════ */
        .exec-backdrop {
            position: fixed;
            inset: 0;
            z-index: 0;
            background:
                radial-gradient(ellipse 80% 60% at 50% 20%, rgba(0, 122, 255, 0.06) 0%, transparent 70%),
                radial-gradient(ellipse 60% 40% at 80% 80%, rgba(0, 122, 255, 0.04) 0%, transparent 60%),
                var(--bg-primary);
            pointer-events: none;
        }

        /* ── Floating Ambient Particles ─────────────────── */
        .exec-particles {
            position: fixed;
            inset: 0;
            z-index: 0;
            pointer-events: none;
            overflow: hidden;
        }

        .exec-particle {
            position: absolute;
            width: 3px;
            height: 3px;
            background: rgba(0, 122, 255, 0.12);
            border-radius: 50%;
            animation: particleDrift linear infinite;
        }

        .exec-particle:nth-child(1) {
            left: 15%;
            top: 30%;
            animation-duration: 28s;
            animation-delay: 0s;
        }
        .exec-particle:nth-child(2) {
            left: 70%;
            top: 60%;
            width: 2px;
            height: 2px;
            background: rgba(0, 122, 255, 0.15);
            animation-duration: 34s;
            animation-delay: -8s;
        }
        .exec-particle:nth-child(3) {
            left: 45%;
            top: 80%;
            width: 2px;
            height: 2px;
            background: rgba(0, 0, 0, 0.04);
            animation-duration: 22s;
            animation-delay: -14s;
        }

        @keyframes particleDrift {
            0%   { transform: translate(0, 0) scale(1); opacity: 0; }
            10%  { opacity: 1; }
            50%  { transform: translate(40px, -60px) scale(1.3); }
            90%  { opacity: 1; }
            100% { transform: translate(-20px, -120px) scale(0.8); opacity: 0; }
        }

        /* ═══════════════════════════════════════════════════
           Main Layout Container
           ═══════════════════════════════════════════════════ */
        .exec-container {
            position: relative;
            z-index: 1;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        /* ═══════════════════════════════════════════════════
           View Toggle Bar
           ═══════════════════════════════════════════════════ */
        .exec-view-toggle {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            padding: 12px 24px 0;
            flex-shrink: 0;
        }

        .view-toggle-group {
            display: flex;
            align-items: center;
            background: rgba(0, 0, 0, 0.04);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 3px;
            gap: 2px;
        }

        .view-toggle-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 14px;
            border: none;
            background: transparent;
            border-radius: 8px;
            font-family: var(--font-family);
            font-size: 12px;
            font-weight: 500;
            color: var(--text-tertiary);
            cursor: pointer;
            transition: all 0.25s var(--ease-smooth);
            -webkit-tap-highlight-color: transparent;
            outline: none;
            white-space: nowrap;
        }

        .view-toggle-btn:hover {
            color: var(--text-secondary);
            background: rgba(0, 0, 0, 0.03);
        }

        .view-toggle-btn.active {
            background: var(--exec-white);
            color: var(--text-primary);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08), 0 0 0 1px rgba(0, 0, 0, 0.04);
        }

        .view-toggle-btn:focus-visible {
            outline: 2px solid var(--exec-blue);
            outline-offset: 2px;
        }

        .view-toggle-icon {
            font-size: 14px;
            line-height: 1;
        }

        /* ═══════════════════════════════════════════════════
           Office Floor — CSS Grid Layout (Grid View)
           ═══════════════════════════════════════════════════ */
        .exec-floor {
            flex: 1;
            padding: 16px 24px 24px;
            display: grid;
            grid-template-columns: 1fr 1.6fr 1fr;
            grid-template-rows: 1fr 1fr 0.8fr;
            gap: 12px;
            max-width: 1200px;
            max-height: calc(100vh - 112px);
            margin: 0 auto;
            width: 100%;
            transition: opacity 0.3s var(--ease-smooth);
        }

        .exec-floor.hidden {
            display: none;
        }

        /* ═══════════════════════════════════════════════════
           Hierarchy / Org Chart View
           ═══════════════════════════════════════════════════ */
        .exec-hierarchy {
            flex: 1;
            padding: 16px 24px 24px;
            display: none;
            flex-direction: column;
            align-items: center;
            max-width: 1200px;
            max-height: calc(100vh - 112px);
            margin: 0 auto;
            width: 100%;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--exec-gray-300) transparent;
        }

        .exec-hierarchy.visible {
            display: flex;
        }

        .exec-hierarchy::-webkit-scrollbar { width: 4px; }
        .exec-hierarchy::-webkit-scrollbar-thumb { background: var(--exec-gray-300); border-radius: 2px; }

        /* ── Org Tree Structure ──────────────────────────── */
        .org-tree {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0;
            padding: 12px 0;
            width: 100%;
        }

        /* ── Tree Node (generic) ────────────────────────── */
        .org-node {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        .org-card {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 14px 22px;
            background: var(--bg-room);
            border: 1px solid var(--border-subtle);
            border-radius: 14px;
            cursor: pointer;
            transition: all 0.3s var(--ease-smooth);
            min-width: 180px;
        }

        .org-card:hover {
            background: var(--bg-room-hover);
            border-color: var(--border-medium);
            transform: translateY(-1px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
        }

        .org-card--ceo {
            padding: 18px 28px;
            background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(255,255,255,0.85));
            border-color: var(--border-medium);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.06);
        }

        .org-card--ceo:hover {
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1), 0 0 0 1px rgba(0, 122, 255, 0.15);
        }

        .org-card-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .org-card-info .agent-name {
            font-size: 14px;
            font-weight: 600;
        }

        .org-card-info .agent-role {
            font-size: 11px;
        }

        .org-card--ceo .org-card-info .agent-name {
            font-size: 16px;
            font-weight: 700;
        }

        .org-card--ceo .org-card-info .agent-role {
            font-size: 12px;
        }

        /* ── Tree Connector Lines ───────────────────────── */
        .org-connector {
            width: 2px;
            height: 28px;
            background: var(--border-medium);
            flex-shrink: 0;
        }

        .org-connector--branch {
            width: 2px;
            height: 20px;
            background: var(--border-medium);
        }

        .org-children {
            display: flex;
            justify-content: center;
            gap: 16px;
            position: relative;
            padding-top: 0;
        }

        /* Horizontal connecting bar above children */
        .org-children::before {
            content: '';
            position: absolute;
            top: 0;
            left: calc(50% - var(--bar-half-width, 200px));
            right: calc(50% - var(--bar-half-width, 200px));
            height: 2px;
            background: var(--border-medium);
        }

        .org-child {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* ═══════════════════════════════════════════════════
           Room — Base Component
           ═══════════════════════════════════════════════════ */
        .exec-room {
            position: relative;
            background: var(--bg-room);
            border: 1px solid var(--border-subtle);
            border-radius: var(--room-radius);
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
            transition:
                background 0.3s var(--ease-smooth),
                border-color 0.3s var(--ease-smooth),
                transform 0.3s var(--ease-smooth),
                box-shadow 0.3s var(--ease-smooth);
            overflow: hidden;
            -webkit-tap-highlight-color: transparent;
            outline: none;
        }

        .exec-room::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: inherit;
            background: radial-gradient(ellipse at 50% 0%, rgba(0,122,255,0.03) 0%, transparent 70%);
            pointer-events: none;
        }

        .exec-room:hover {
            background: var(--bg-room-hover);
            border-color: var(--border-medium);
            transform: translateY(-1px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
        }

        .exec-room:focus-visible {
            outline: 2px solid var(--exec-blue);
            outline-offset: 2px;
        }

        .exec-room:active {
            transform: translateY(0);
        }

        /* ── Room Label (top-left) ──────────────────────── */
        .exec-room-label {
            position: absolute;
            top: 12px;
            left: 16px;
            font-size: 10px;
            font-weight: 600;
            letter-spacing: 1.2px;
            text-transform: uppercase;
            color: var(--text-tertiary);
        }

        /* ═══════════════════════════════════════════════════
           CEO Room — Hero Room (center-top, spans full width)
           ═══════════════════════════════════════════════════ */
        .exec-room--ceo {
            grid-column: 1 / -1;
            grid-row: 1;
            flex-direction: row;
            justify-content: center;
            align-items: center;
            gap: 32px;
            padding: 28px 36px;
            background: linear-gradient(135deg,
                rgba(255, 255, 255, 0.95) 0%,
                rgba(255, 255, 255, 0.85) 100%
            );
            border-color: var(--border-medium);
        }

        .exec-room--ceo::after {
            content: '';
            position: absolute;
            inset: -1px;
            border-radius: inherit;
            padding: 1px;
            background: linear-gradient(
                135deg,
                rgba(0, 122, 255, 0.15) 0%,
                rgba(0, 122, 255, 0) 40%,
                rgba(0, 122, 255, 0) 60%,
                rgba(0, 122, 255, 0.1) 100%
            );
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            pointer-events: none;
            animation: ceoBorderShift 8s ease-in-out infinite alternate;
        }

        @keyframes ceoBorderShift {
            0%   { opacity: 0.5; }
            50%  { opacity: 1; }
            100% { opacity: 0.5; }
        }

        .exec-room--ceo:hover {
            box-shadow:
                0 8px 32px rgba(0, 0, 0, 0.1),
                0 0 0 1px rgba(0, 122, 255, 0.15);
        }

        .ceo-content {
            display: flex;
            align-items: center;
            gap: 24px;
        }

        .ceo-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .ceo-info .agent-name {
            font-size: 18px;
            font-weight: 700;
        }

        .ceo-info .agent-role {
            font-size: 13px;
        }

        /* ── Mailbox Button ─────────────────────────────── */
        .ceo-mailbox {
            position: absolute;
            top: 16px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 14px;
            background: var(--exec-blue-muted);
            border: 1px solid rgba(0, 122, 255, 0.2);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.25s var(--ease-smooth);
            font-family: inherit;
            color: var(--exec-blue);
            font-size: 13px;
            font-weight: 500;
            -webkit-tap-highlight-color: transparent;
            outline: none;
        }

        .ceo-mailbox:hover {
            background: rgba(0, 122, 255, 0.25);
            border-color: rgba(0, 122, 255, 0.4);
            transform: scale(1.03);
        }

        .ceo-mailbox:focus-visible {
            outline: 2px solid var(--exec-blue);
            outline-offset: 2px;
        }

        .ceo-mailbox-icon {
            font-size: 18px;
            line-height: 1;
        }

        .ceo-mailbox-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 18px;
            height: 18px;
            padding: 0 5px;
            background: var(--exec-blue);
            color: var(--exec-white);
            font-size: 11px;
            font-weight: 700;
            border-radius: 9px;
            line-height: 1;
        }

        /* ═══════════════════════════════════════════════════
           Agent Avatar — SVG Container
           ═══════════════════════════════════════════════════ */
        .agent-avatar {
            position: relative;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: transform 0.3s var(--ease-spring), box-shadow 0.3s var(--ease-smooth);
            overflow: hidden;
        }

        .agent-avatar svg {
            width: 100%;
            height: 100%;
            display: block;
        }

        .agent-avatar--lg {
            width: 56px;
            height: 56px;
        }

        .exec-room:hover .agent-avatar,
        .org-card:hover .agent-avatar {
            transform: scale(1.08);
        }

        /* ── Status Dot ─────────────────────────────────── */
        .agent-status-dot {
            position: absolute;
            bottom: 1px;
            right: 1px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid var(--bg-room);
            transition: background 0.3s var(--ease-smooth);
            z-index: 2;
        }

        .agent-status-dot--active { background: var(--status-active); }
        .agent-status-dot--busy   { background: var(--status-busy); }
        .agent-status-dot--idle   { background: var(--status-idle); }

        /* ── Agent Text ─────────────────────────────────── */
        .agent-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            line-height: 1.2;
        }

        .agent-role {
            font-size: 11px;
            font-weight: 400;
            color: var(--text-tertiary);
            line-height: 1.2;
        }

        /* ═══════════════════════════════════════════════════
           Agent Rooms — Grid Placement
           ═══════════════════════════════════════════════════ */
        .exec-room--atlas    { grid-column: 1; grid-row: 2; }
        .exec-room--forge    { grid-column: 2; grid-row: 2; }
        .exec-room--hunter   { grid-column: 3; grid-row: 2; }
        .exec-room--echo     { grid-column: 1; grid-row: 3; }
        .exec-room--meeting  { grid-column: 2; grid-row: 3; }
        .exec-room--sentinel { grid-column: 3; grid-row: 3; }

        /* ═══════════════════════════════════════════════════
           Meeting Room — Boardroom
           ═══════════════════════════════════════════════════ */
        .exec-room--meeting {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(248, 248, 250, 0.9));
            border: 1px solid var(--border-medium);
            cursor: pointer;
            flex-direction: column;
            gap: 12px;
            align-items: flex-start;
            padding: 18px 22px;
        }

        .exec-room--meeting:hover {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(248, 248, 250, 0.95));
            border-color: var(--border-strong);
            transform: translateY(-1px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
        }

        .meeting-status {
            display: flex;
            align-items: center;
            gap: 12px;
            width: 100%;
        }

        .meeting-label {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            flex: 1;
        }

        .meeting-icon {
            font-size: 24px;
            opacity: 0.7;
        }

        .meeting-count {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 20px;
            height: 20px;
            padding: 0 6px;
            background: var(--exec-blue);
            color: var(--exec-white);
            font-size: 11px;
            font-weight: 700;
            border-radius: 10px;
            line-height: 1;
            animation: meetingPulse 3s ease-in-out infinite;
        }

        @keyframes meetingPulse {
            0%, 100% { 
                box-shadow: 0 0 0 0 rgba(0, 122, 255, 0.7);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 0 0 4px rgba(0, 122, 255, 0);
                transform: scale(1.05);
            }
        }

        .meeting-preview {
            display: flex;
            flex-direction: column;
            gap: 6px;
            width: 100%;
        }

        .meeting-active {
            font-size: 12px;
            color: var(--text-secondary);
            padding: 4px 8px;
            background: rgba(0, 122, 255, 0.08);
            border-radius: 6px;
            border-left: 3px solid var(--exec-blue);
        }

        /* ═══════════════════════════════════════════════════
           Agent Detail Expand Panel (in-place)
           ═══════════════════════════════════════════════════ */
        .agent-detail {
            display: none;
            width: 100%;
            padding-top: 8px;
            border-top: 1px solid var(--border-subtle);
            margin-top: 4px;
        }

        .agent-detail.visible {
            display: block;
            animation: detailSlideIn 0.3s var(--ease-smooth);
        }

        @keyframes detailSlideIn {
            from { opacity: 0; transform: translateY(-4px); }
            to   { opacity: 1; transform: translateY(0); }
        }

        .agent-detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 4px 0;
            font-size: 11px;
        }

        .agent-detail-label {
            color: var(--text-tertiary);
            font-weight: 500;
        }

        .agent-detail-value {
            color: var(--text-secondary);
            font-weight: 400;
            text-align: right;
            max-width: 60%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* ═══════════════════════════════════════════════════
           Mailbox Slide-In Panel
           ═══════════════════════════════════════════════════ */
        .mailbox-overlay {
            position: fixed;
            inset: 0;
            z-index: 100;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s var(--ease-smooth);
        }

        .mailbox-overlay.open {
            pointer-events: auto;
            opacity: 1;
        }

        .mailbox-overlay.open .mailbox-backdrop {
            opacity: 1;
        }

        .mailbox-overlay.open .mailbox-panel {
            transform: translateX(0);
        }

        .mailbox-backdrop {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            opacity: 0;
            transition: opacity 0.35s var(--ease-smooth);
        }

        .mailbox-panel {
            position: absolute;
            top: 0;
            right: 0;
            width: var(--panel-width);
            max-width: 90vw;
            height: 100%;
            background: var(--bg-secondary);
            border-left: 1px solid var(--border-medium);
            display: flex;
            flex-direction: column;
            transform: translateX(100%);
            transition: transform 0.4s var(--ease-smooth);
            box-shadow: -16px 0 48px rgba(0, 0, 0, 0.1);
        }

        .mailbox-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            border-bottom: 1px solid var(--border-subtle);
            flex-shrink: 0;
        }

        .mailbox-title {
            font-size: 17px;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .mailbox-close {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.2s var(--ease-smooth);
            font-family: inherit;
            -webkit-tap-highlight-color: transparent;
        }

        .mailbox-close:hover {
            background: var(--exec-gray-100);
            color: var(--text-primary);
        }

        .mailbox-close:focus-visible {
            outline: 2px solid var(--exec-blue);
            outline-offset: 2px;
        }

        .mailbox-messages {
            flex: 1;
            overflow-y: auto;
            padding: 8px 0;
            scrollbar-width: thin;
            scrollbar-color: var(--exec-gray-300) transparent;
        }

        .mailbox-messages::-webkit-scrollbar {
            width: 4px;
        }

        .mailbox-messages::-webkit-scrollbar-thumb {
            background: var(--exec-gray-300);
            border-radius: 2px;
        }

        /* ── Message Item ───────────────────────────────── */
        .mail-item {
            display: flex;
            gap: 12px;
            padding: 14px 24px;
            transition: background 0.2s var(--ease-smooth);
            cursor: pointer;
            position: relative;
        }

        .mail-item:hover {
            background: rgba(0, 0, 0, 0.03);
        }

        .mail-item--read {
            opacity: 0.7;
        }

        .mail-item--read .mail-preview {
            color: var(--text-tertiary);
        }

        .mail-unread-dot {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            width: 8px;
            height: 8px;
            background: var(--exec-blue);
            border-radius: 50%;
            animation: unreadPulse 2s ease-in-out infinite;
        }

        @keyframes unreadPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .mail-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            font-weight: 700;
            color: var(--exec-white);
            flex-shrink: 0;
            overflow: hidden;
        }

        .mail-avatar svg {
            width: 100%;
            height: 100%;
        }

        .mail-content {
            flex: 1;
            min-width: 0;
        }

        .mail-header {
            display: flex;
            align-items: baseline;
            gap: 8px;
            margin-bottom: 3px;
        }

        .mail-sender {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .mail-time {
            font-size: 11px;
            color: var(--text-tertiary);
            flex-shrink: 0;
        }

        .mail-preview {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.4;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .mail-divider {
            height: 1px;
            background: var(--border-subtle);
            margin: 0 24px;
        }

        /* ═══════════════════════════════════════════════════
           Agent TODO Panel — Slide-In from Right
           ═══════════════════════════════════════════════════ */
        .todo-overlay {
            position: fixed;
            inset: 0;
            z-index: 200;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s var(--ease-smooth);
        }

        .todo-overlay.open {
            pointer-events: auto;
            opacity: 1;
        }

        .todo-overlay.open .todo-backdrop {
            opacity: 1;
        }

        .todo-overlay.open .todo-panel {
            transform: translateX(0);
        }

        .todo-backdrop {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            opacity: 0;
            transition: opacity 0.35s var(--ease-smooth);
        }

        .todo-panel {
            position: absolute;
            top: 0;
            right: 0;
            width: var(--panel-width);
            max-width: 90vw;
            height: 100%;
            background: var(--bg-secondary);
            border-left: 1px solid var(--border-medium);
            display: flex;
            flex-direction: column;
            transform: translateX(100%);
            transition: transform 0.4s var(--ease-smooth);
            box-shadow: -16px 0 48px rgba(0, 0, 0, 0.1);
        }

        .todo-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px 16px;
            border-bottom: 1px solid var(--border-subtle);
            flex-shrink: 0;
        }

        .todo-agent-info {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .todo-agent-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            overflow: hidden;
        }

        .todo-agent-avatar svg {
            width: 100%;
            height: 100%;
            display: block;
        }

        .todo-agent-details {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .todo-agent-name {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1.2;
        }

        .todo-agent-role {
            font-size: 12px;
            font-weight: 500;
            color: var(--text-tertiary);
            line-height: 1.2;
        }

        .todo-close {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.2s var(--ease-smooth);
            font-family: inherit;
            -webkit-tap-highlight-color: transparent;
        }

        .todo-close:hover {
            background: var(--exec-gray-100);
            color: var(--text-primary);
        }

        .todo-close:focus-visible {
            outline: 2px solid var(--exec-blue);
            outline-offset: 2px;
        }

        .todo-content {
            flex: 1;
            overflow-y: auto;
            padding: 0;
            scrollbar-width: thin;
            scrollbar-color: var(--exec-gray-300) transparent;
        }

        .todo-content::-webkit-scrollbar {
            width: 4px;
        }

        .todo-content::-webkit-scrollbar-thumb {
            background: var(--exec-gray-300);
            border-radius: 2px;
        }

        /* ── TODO Sections ──────────────────────────────── */
        .todo-section {
            padding: 20px 24px;
            border-bottom: 1px solid var(--border-subtle);
        }

        .todo-section:last-child {
            border-bottom: none;
        }

        .todo-section-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.8px;
            margin-bottom: 12px;
        }

        .todo-current-task {
            font-size: 15px;
            font-weight: 500;
            color: var(--text-primary);
            line-height: 1.3;
        }

        .todo-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .todo-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 0;
        }

        .todo-icon {
            font-size: 16px;
            line-height: 1;
            width: 18px;
            text-align: center;
            flex-shrink: 0;
        }

        .todo-text {
            font-size: 14px;
            color: var(--text-primary);
            line-height: 1.3;
            flex: 1;
        }

        .todo-item--done .todo-text {
            color: var(--text-tertiary);
            text-decoration: line-through;
        }

        .todo-item--progress .todo-text {
            color: var(--text-primary);
        }

        .todo-item--pending .todo-text {
            color: var(--text-secondary);
        }

        /* ── Skills Section ─────────────────────────────── */
        .todo-skills {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .skill-item {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .skill-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .skill-name {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .skill-percentage {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-tertiary);
        }

        .skill-bar {
            width: 100%;
            height: 6px;
            background: var(--exec-gray-100);
            border-radius: 3px;
            overflow: hidden;
        }

        .skill-progress {
            height: 100%;
            background: var(--exec-blue);
            border-radius: 3px;
            transition: width 0.6s var(--ease-smooth);
        }

        /* ═══════════════════════════════════════════════════════════════
           Meeting Room Panel — Similar to TODO Panel
           ═══════════════════════════════════════════════════════════════ */
        .meeting-overlay {
            position: fixed;
            inset: 0;
            z-index: 200;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s var(--ease-smooth);
        }

        .meeting-overlay.open {
            pointer-events: auto;
            opacity: 1;
        }

        .meeting-overlay.open .meeting-backdrop {
            opacity: 1;
        }

        .meeting-overlay.open .meeting-panel {
            transform: translateX(0);
        }

        .meeting-backdrop {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            opacity: 0;
            transition: opacity 0.35s var(--ease-smooth);
        }

        .meeting-panel {
            position: absolute;
            top: 0;
            right: 0;
            width: var(--panel-width);
            max-width: 90vw;
            height: 100%;
            background: var(--bg-secondary);
            border-left: 1px solid var(--border-medium);
            display: flex;
            flex-direction: column;
            transform: translateX(100%);
            transition: transform 0.4s var(--ease-smooth);
            box-shadow: -16px 0 48px rgba(0, 0, 0, 0.1);
        }

        .meeting-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px 16px;
            border-bottom: 1px solid var(--border-subtle);
            flex-shrink: 0;
        }

        .meeting-title {
            font-size: 17px;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .meeting-close {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.2s var(--ease-smooth);
            font-family: inherit;
            -webkit-tap-highlight-color: transparent;
        }

        .meeting-close:hover {
            background: var(--exec-gray-100);
            color: var(--text-primary);
        }

        .meeting-close:focus-visible {
            outline: 2px solid var(--exec-blue);
            outline-offset: 2px;
        }

        .meeting-content {
            flex: 1;
            overflow-y: auto;
            padding: 0;
            scrollbar-width: thin;
            scrollbar-color: var(--exec-gray-300) transparent;
        }

        .meeting-content::-webkit-scrollbar {
            width: 4px;
        }

        .meeting-content::-webkit-scrollbar-thumb {
            background: var(--exec-gray-300);
            border-radius: 2px;
        }

        /* ── Meeting Sections ──────────────────────────── */
        .meeting-section {
            padding: 20px 24px;
            border-bottom: 1px solid var(--border-subtle);
        }

        .meeting-section:last-child {
            border-bottom: none;
        }

        .meeting-section-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.8px;
            margin-bottom: 12px;
        }

        .meeting-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .meeting-item {
            display: flex;
            flex-direction: column;
            gap: 6px;
            padding: 12px 16px;
            background: rgba(0, 122, 255, 0.05);
            border-left: 4px solid var(--exec-blue);
            border-radius: 8px;
        }

        .meeting-item--active {
            border-left-color: #FF453A;
            background: rgba(255, 69, 58, 0.08);
        }

        .meeting-item--scheduled {
            border-left-color: #FFD60A;
            background: rgba(255, 214, 10, 0.08);
        }

        .meeting-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .meeting-item-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .meeting-item-status {
            font-size: 11px;
            font-weight: 500;
            padding: 2px 8px;
            border-radius: 4px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .meeting-item--active .meeting-item-status {
            background: #FF453A;
            color: white;
        }

        .meeting-item--scheduled .meeting-item-status {
            background: #FFD60A;
            color: #8B6914;
        }

        .meeting-item-description {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .meeting-participants {
            display: flex;
            gap: 6px;
            margin-top: 8px;
        }

        .meeting-participant {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 600;
            color: white;
            background: var(--exec-blue);
            overflow: hidden;
        }

        .meeting-participant svg {
            width: 100%;
            height: 100%;
        }

        /* ── Sub-Agent Display in Hierarchy ──────────── */
        .org-sub-level {
            margin-top: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .org-sub-level-demo {
            margin-top: 24px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .org-sub-children {
            display: flex;
            gap: 12px;
        }

        .org-sub-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px 12px;
            background: rgba(0, 122, 255, 0.08);
            border: 1px solid rgba(0, 122, 255, 0.2);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.25s var(--ease-smooth);
            min-width: 100px;
        }

        .org-sub-card:hover {
            background: rgba(0, 122, 255, 0.15);
            border-color: rgba(0, 122, 255, 0.35);
            transform: translateY(-1px);
        }

        .sub-agent-name {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
            line-height: 1.2;
        }

        .sub-agent-role {
            font-size: 10px;
            font-weight: 400;
            color: var(--text-tertiary);
            line-height: 1.2;
        }

        /* ═══════════════════════════════════════════════════
           Status Bar — Frosted Glass Bottom Bar
           ═══════════════════════════════════════════════════ */
        .exec-statusbar {
            position: relative;
            z-index: 10;
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 12px 24px;
            background: var(--bg-frosted);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border-top: 1px solid var(--border-subtle);
            flex-shrink: 0;
        }

        .statusbar-info {
            display: flex;
            align-items: center;
            gap: 16px;
            flex-shrink: 0;
        }

        .statusbar-item {
            font-size: 12px;
            font-weight: 500;
            color: var(--text-tertiary);
            display: flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
        }

        .statusbar-item-icon {
            font-size: 14px;
        }

        .statusbar-dot {
            width: 7px;
            height: 7px;
            border-radius: 50%;
            background: var(--status-active);
            animation: statusPulse 2.5s ease-in-out infinite;
        }

        @keyframes statusPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .statusbar-separator {
            width: 1px;
            height: 16px;
            background: var(--border-subtle);
        }

        /* ── Command Input ──────────────────────────────── */
        .exec-command-input {
            flex: 1;
            position: relative;
        }

        .exec-command-input input {
            width: 100%;
            height: 40px;
            padding: 0 16px 0 38px;
            background: rgba(0, 0, 0, 0.03);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            color: var(--text-primary);
            font-family: var(--font-family);
            font-size: 13px;
            font-weight: 400;
            outline: none;
            transition:
                border-color 0.25s var(--ease-smooth),
                background 0.25s var(--ease-smooth),
                box-shadow 0.25s var(--ease-smooth);
        }

        .exec-command-input input::placeholder {
            color: var(--text-tertiary);
        }

        .exec-command-input input:focus {
            background: var(--exec-white);
            border-color: var(--exec-blue);
            box-shadow: 0 0 0 3px var(--exec-blue-muted);
        }

        .exec-command-input .input-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-tertiary);
            font-size: 15px;
            pointer-events: none;
            transition: color 0.25s var(--ease-smooth);
        }

        .exec-command-input input:focus ~ .input-icon {
            color: var(--exec-blue);
        }

        /* ═══════════════════════════════════════════════════
           Responsive — Mobile / Small Viewports
           ═══════════════════════════════════════════════════ */
        @media (max-width: 768px) {
            .exec-floor {
                grid-template-columns: 1fr 1fr;
                grid-template-rows: auto;
                gap: 10px;
                padding: 16px;
                max-height: none;
                overflow-y: auto;
            }

            .exec-room--ceo {
                grid-column: 1 / -1;
                grid-row: auto;
                flex-direction: column;
                gap: 16px;
                padding: 20px;
            }

            .ceo-content {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }

            .ceo-mailbox {
                position: relative;
                top: auto;
                right: auto;
                margin-top: 8px;
            }

            .exec-room--atlas    { grid-column: 1; grid-row: auto; }
            .exec-room--forge    { grid-column: 2; grid-row: auto; }
            .exec-room--hunter   { grid-column: 1; grid-row: auto; }
            .exec-room--echo     { grid-column: 2; grid-row: auto; }
            .exec-room--meeting  { grid-column: 1 / -1; grid-row: auto; }
            .exec-room--sentinel { grid-column: 1 / -1; grid-row: auto; }

            .exec-room {
                padding: 16px;
                min-height: 100px;
            }

            .agent-avatar { width: 40px; height: 40px; }
            .agent-avatar--lg { width: 48px; height: 48px; }

            .statusbar-info { gap: 10px; }
            .statusbar-item { font-size: 11px; }

            .mailbox-panel,
            .todo-panel,
            .meeting-panel { 
                width: 100vw; 
            }

            /* Hierarchy responsive */
            .org-children {
                flex-wrap: wrap;
                gap: 12px;
            }

            .org-card {
                min-width: 140px;
                padding: 10px 14px;
                gap: 10px;
            }

            .org-card .agent-avatar {
                width: 36px;
                height: 36px;
            }
        }

        @media (max-width: 480px) {
            .exec-floor {
                grid-template-columns: 1fr;
                padding: 12px;
            }

            .exec-room--atlas,
            .exec-room--forge,
            .exec-room--hunter,
            .exec-room--echo,
            .exec-room--sentinel {
                grid-column: 1;
            }

            .exec-statusbar {
                flex-direction: column;
                gap: 10px;
                padding: 12px 16px;
            }

            .statusbar-info {
                width: 100%;
                justify-content: center;
            }

            .org-children {
                flex-direction: column;
                align-items: center;
            }

            .org-children::before {
                display: none;
            }
        }

        /* ═══════════════════════════════════════════════════
           Accessibility — Focus-Visible Ring
           ═══════════════════════════════════════════════════ */
        :focus-visible {
            outline: 2px solid var(--exec-blue);
            outline-offset: 2px;
        }

        /* Disable outline for mouse users */
        :focus:not(:focus-visible) {
            outline: none;
        }

        /* ═══════════════════════════════════════════════════
           Idle State — Pulse Animation
           ═══════════════════════════════════════════════════ */
        .agent-status-dot--idle {
            background: var(--status-idle);
            animation: idlePulse 3s ease-in-out infinite;
        }

        @keyframes idlePulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(0.85); }
        }

        .agent-idle-label {
            font-size: 11px;
            color: var(--text-tertiary);
            font-weight: 400;
            margin-top: 2px;
        }

        /* ═══════════════════════════════════════════════════
           Agent Detail Panel — 420px Slide-In (Feature 1)
           ═══════════════════════════════════════════════════ */
        .detail-overlay {
            position: fixed;
            inset: 0;
            z-index: 200;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s var(--ease-smooth);
        }
        .detail-overlay.open {
            pointer-events: auto;
            opacity: 1;
        }
        .detail-overlay.open .detail-backdrop { opacity: 1; }
        .detail-overlay.open .detail-panel { transform: translateX(0); }
        .detail-backdrop {
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.5);
            opacity: 0;
            transition: opacity 0.35s var(--ease-smooth);
        }
        .detail-panel {
            position: absolute;
            top: 0; right: 0;
            width: 420px;
            max-width: 90vw;
            height: 100%;
            background: var(--bg-secondary);
            border-left: 1px solid var(--border-medium);
            display: flex;
            flex-direction: column;
            transform: translateX(100%);
            transition: transform 0.4s var(--ease-smooth);
            box-shadow: -16px 0 48px rgba(0,0,0,0.12);
        }
        .detail-hero {
            display: flex;
            align-items: center;
            gap: 18px;
            padding: 24px 24px 20px;
            border-bottom: 1px solid var(--border-subtle);
        }
        .detail-hero-avatar {
            width: 64px; height: 64px;
            border-radius: 50%;
            overflow: hidden;
            flex-shrink: 0;
            position: relative;
        }
        .detail-hero-avatar svg { width: 100%; height: 100%; display: block; }
        .detail-hero-status {
            position: absolute; bottom: 2px; right: 2px;
            width: 14px; height: 14px; border-radius: 50%;
            border: 2.5px solid var(--bg-secondary);
            z-index: 2;
        }
        .detail-hero-info { flex: 1; min-width: 0; }
        .detail-hero-name { font-size: 18px; font-weight: 700; color: var(--text-primary); }
        .detail-hero-role { font-size: 13px; color: var(--text-tertiary); font-weight: 500; }
        .detail-hero-task {
            font-size: 12px; color: var(--exec-blue);
            margin-top: 4px; font-weight: 500;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        .detail-close {
            width: 32px; height: 32px;
            display: flex; align-items: center; justify-content: center;
            border: none; background: var(--bg-tertiary); color: var(--text-secondary);
            border-radius: 8px; cursor: pointer; font-size: 16px;
            transition: all 0.2s var(--ease-smooth); font-family: inherit;
            flex-shrink: 0;
        }
        .detail-close:hover { background: var(--exec-gray-100); color: var(--text-primary); }
        .detail-body {
            flex: 1; overflow-y: auto; padding: 0;
            scrollbar-width: thin; scrollbar-color: var(--exec-gray-300) transparent;
        }
        .detail-body::-webkit-scrollbar { width: 4px; }
        .detail-body::-webkit-scrollbar-thumb { background: var(--exec-gray-300); border-radius: 2px; }
        .detail-section {
            padding: 18px 24px;
            border-bottom: 1px solid var(--border-subtle);
        }
        .detail-section:last-child { border-bottom: none; }
        .detail-section-title {
            font-size: 11px; font-weight: 600; color: var(--text-tertiary);
            text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px;
        }
        .detail-metrics {
            display: grid; grid-template-columns: 1fr 1fr; gap: 10px;
        }
        .detail-metric {
            padding: 10px 12px; background: var(--bg-tertiary);
            border-radius: 10px;
        }
        .detail-metric-value {
            font-size: 16px; font-weight: 700; color: var(--text-primary);
        }
        .detail-metric-label {
            font-size: 11px; color: var(--text-tertiary); margin-top: 2px;
        }
        .detail-todo-item {
            display: flex; align-items: center; gap: 10px;
            padding: 6px 0; font-size: 13px;
        }
        .detail-todo-icon { width: 18px; text-align: center; flex-shrink: 0; }
        .detail-todo-text { flex: 1; color: var(--text-primary); line-height: 1.3; }
        .detail-todo-item--done .detail-todo-text {
            color: var(--text-tertiary); text-decoration: line-through;
        }
        .detail-skill-chips {
            display: flex; flex-wrap: wrap; gap: 8px;
        }
        .detail-skill-chip {
            display: inline-flex; align-items: center; gap: 5px;
            padding: 5px 12px; background: var(--exec-blue-muted);
            border-radius: 20px; font-size: 12px; font-weight: 500;
            color: var(--exec-blue);
        }
        .detail-soul-excerpt {
            font-size: 13px; color: var(--text-secondary);
            line-height: 1.5; white-space: pre-wrap;
            max-height: 200px; overflow-y: auto;
        }

        /* ═══════════════════════════════════════════════════
           CEO Chat Panel (Feature 2)
           ═══════════════════════════════════════════════════ */
        .chat-overlay {
            position: fixed;
            inset: 0;
            z-index: 250;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s var(--ease-smooth);
        }
        .chat-overlay.open {
            pointer-events: auto;
            opacity: 1;
        }
        .chat-overlay.open .chat-backdrop { opacity: 1; }
        .chat-overlay.open .chat-panel { transform: translateY(0); }
        .chat-backdrop {
            position: absolute; inset: 0;
            background: rgba(0,0,0,0.5);
            opacity: 0;
            transition: opacity 0.35s var(--ease-smooth);
        }
        .chat-panel {
            position: absolute;
            bottom: 0; right: 0;
            width: 480px; max-width: 100vw;
            height: 70vh;
            background: var(--bg-secondary);
            border-top-left-radius: 16px;
            border-left: 1px solid var(--border-medium);
            border-top: 1px solid var(--border-medium);
            display: flex;
            flex-direction: column;
            transform: translateY(100%);
            transition: transform 0.4s var(--ease-smooth);
            box-shadow: -8px -8px 32px rgba(0,0,0,0.12);
        }
        .chat-header {
            display: flex; align-items: center; justify-content: space-between;
            padding: 16px 20px; border-bottom: 1px solid var(--border-subtle);
            flex-shrink: 0;
        }
        .chat-title {
            font-size: 15px; font-weight: 700; color: var(--text-primary);
            display: flex; align-items: center; gap: 8px;
        }
        .chat-title-dot {
            width: 8px; height: 8px; border-radius: 50%;
            background: var(--status-active);
            animation: statusPulse 2.5s ease-in-out infinite;
        }
        .chat-close {
            width: 28px; height: 28px;
            display: flex; align-items: center; justify-content: center;
            border: none; background: var(--bg-tertiary); color: var(--text-secondary);
            border-radius: 7px; cursor: pointer; font-size: 14px;
            transition: all 0.2s var(--ease-smooth); font-family: inherit;
        }
        .chat-close:hover { background: var(--exec-gray-100); color: var(--text-primary); }
        .chat-messages {
            flex: 1; overflow-y: auto; padding: 16px 20px;
            display: flex; flex-direction: column; gap: 12px;
            scrollbar-width: thin; scrollbar-color: var(--exec-gray-300) transparent;
        }
        .chat-messages::-webkit-scrollbar { width: 4px; }
        .chat-messages::-webkit-scrollbar-thumb { background: var(--exec-gray-300); border-radius: 2px; }
        .chat-msg {
            max-width: 80%; padding: 10px 14px;
            border-radius: 14px; font-size: 13px; line-height: 1.45;
            animation: chatMsgIn 0.25s var(--ease-smooth);
        }
        @keyframes chatMsgIn {
            from { opacity: 0; transform: translateY(6px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .chat-msg--user {
            align-self: flex-end;
            background: var(--exec-blue);
            color: white;
            border-bottom-right-radius: 4px;
        }
        .chat-msg--system {
            align-self: flex-start;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border-bottom-left-radius: 4px;
        }
        .chat-msg-time {
            font-size: 10px; opacity: 0.6; margin-top: 4px;
        }
        .chat-msg--user .chat-msg-time { text-align: right; }
        .chat-input-bar {
            display: flex; align-items: center; gap: 10px;
            padding: 12px 20px; border-top: 1px solid var(--border-subtle);
            flex-shrink: 0;
        }
        .chat-input {
            flex: 1; height: 40px; padding: 0 14px;
            background: var(--bg-tertiary); border: 1px solid var(--border-subtle);
            border-radius: 20px; color: var(--text-primary);
            font-family: var(--font-family); font-size: 13px;
            outline: none; transition: border-color 0.2s, box-shadow 0.2s;
        }
        .chat-input:focus {
            border-color: var(--exec-blue);
            box-shadow: 0 0 0 3px var(--exec-blue-muted);
        }
        .chat-input::placeholder { color: var(--text-tertiary); }
        .chat-send {
            width: 40px; height: 40px;
            display: flex; align-items: center; justify-content: center;
            background: var(--exec-blue); color: white;
            border: none; border-radius: 50%; cursor: pointer;
            font-size: 16px; transition: all 0.2s var(--ease-smooth);
            flex-shrink: 0;
        }
        .chat-send:hover { background: var(--exec-blue-hover); transform: scale(1.05); }
        .chat-send:active { transform: scale(0.95); }
        .chat-empty {
            flex: 1; display: flex; align-items: center; justify-content: center;
            color: var(--text-tertiary); font-size: 13px; text-align: center;
            padding: 40px;
        }

        /* ═══════════════════════════════════════════════════
           Cron / Calendar Overlay (Feature 4)
           ═══════════════════════════════════════════════════ */
        .cron-overlay {
            position: fixed; inset: 0; z-index: 200;
            pointer-events: none; opacity: 0;
            transition: opacity 0.3s var(--ease-smooth);
        }
        .cron-overlay.open { pointer-events: auto; opacity: 1; }
        .cron-overlay.open .cron-backdrop { opacity: 1; }
        .cron-overlay.open .cron-panel { transform: translateX(0); }
        .cron-backdrop {
            position: absolute; inset: 0;
            background: rgba(0,0,0,0.5); opacity: 0;
            transition: opacity 0.35s var(--ease-smooth);
        }
        .cron-panel {
            position: absolute; top: 0; right: 0;
            width: 420px; max-width: 90vw; height: 100%;
            background: var(--bg-secondary);
            border-left: 1px solid var(--border-medium);
            display: flex; flex-direction: column;
            transform: translateX(100%);
            transition: transform 0.4s var(--ease-smooth);
            box-shadow: -16px 0 48px rgba(0,0,0,0.1);
        }
        .cron-header {
            display: flex; align-items: center; justify-content: space-between;
            padding: 20px 24px; border-bottom: 1px solid var(--border-subtle);
            flex-shrink: 0;
        }
        .cron-title {
            font-size: 17px; font-weight: 700; color: var(--text-primary);
            display: flex; align-items: center; gap: 8px;
        }
        .cron-close {
            width: 32px; height: 32px;
            display: flex; align-items: center; justify-content: center;
            border: none; background: var(--bg-tertiary); color: var(--text-secondary);
            border-radius: 8px; cursor: pointer; font-size: 16px;
            transition: all 0.2s var(--ease-smooth); font-family: inherit;
        }
        .cron-close:hover { background: var(--exec-gray-100); color: var(--text-primary); }
        .cron-body {
            flex: 1; overflow-y: auto; padding: 0;
            scrollbar-width: thin; scrollbar-color: var(--exec-gray-300) transparent;
        }
        .cron-body::-webkit-scrollbar { width: 4px; }
        .cron-body::-webkit-scrollbar-thumb { background: var(--exec-gray-300); border-radius: 2px; }
        .cron-group {
            padding: 18px 24px;
            border-bottom: 1px solid var(--border-subtle);
        }
        .cron-group:last-child { border-bottom: none; }
        .cron-group-title {
            font-size: 11px; font-weight: 600; color: var(--text-tertiary);
            text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px;
        }
        .cron-item {
            display: flex; align-items: center; gap: 12px;
            padding: 12px 14px; background: var(--bg-tertiary);
            border-radius: 10px; margin-bottom: 8px;
            transition: background 0.2s;
        }
        .cron-item:last-child { margin-bottom: 0; }
        .cron-item:hover { background: var(--exec-gray-100); }
        .cron-item-icon { font-size: 20px; flex-shrink: 0; }
        .cron-item-info { flex: 1; min-width: 0; }
        .cron-item-name {
            font-size: 13px; font-weight: 600; color: var(--text-primary);
        }
        .cron-item-schedule {
            font-size: 11px; color: var(--text-tertiary); margin-top: 2px;
        }
        .cron-item-next {
            font-size: 11px; color: var(--exec-blue); margin-top: 1px;
        }
        .cron-item-status {
            display: inline-flex; align-items: center; justify-content: center;
            padding: 3px 8px; border-radius: 6px;
            font-size: 10px; font-weight: 600; text-transform: uppercase;
            letter-spacing: 0.5px; flex-shrink: 0;
        }
        .cron-item-status--active { background: rgba(48,209,88,0.15); color: #30D158; }
        .cron-item-status--paused { background: rgba(255,214,10,0.15); color: #B89B00; }
        .cron-item-status--error { background: rgba(255,69,58,0.15); color: #FF453A; }
        .cron-toggle {
            width: 36px; height: 20px;
            background: var(--exec-gray-300);
            border-radius: 10px; border: none;
            cursor: pointer; position: relative;
            transition: background 0.25s; flex-shrink: 0;
        }
        .cron-toggle::after {
            content: ''; position: absolute;
            top: 2px; left: 2px;
            width: 16px; height: 16px;
            background: white; border-radius: 50%;
            transition: transform 0.25s var(--ease-smooth);
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        .cron-toggle.on { background: var(--status-active); }
        .cron-toggle.on::after { transform: translateX(16px); }
        .cron-empty {
            padding: 40px 24px; text-align: center;
            color: var(--text-tertiary); font-size: 13px;
        }

        /* ═══════════════════════════════════════════════════
           Memory View Overlay (Feature 5)
           ═══════════════════════════════════════════════════ */
        .memory-overlay {
            position: fixed; inset: 0; z-index: 200;
            pointer-events: none; opacity: 0;
            transition: opacity 0.3s var(--ease-smooth);
        }
        .memory-overlay.open { pointer-events: auto; opacity: 1; }
        .memory-overlay.open .memory-backdrop { opacity: 1; }
        .memory-overlay.open .memory-panel { transform: translateX(0); }
        .memory-backdrop {
            position: absolute; inset: 0;
            background: rgba(0,0,0,0.5); opacity: 0;
            transition: opacity 0.35s var(--ease-smooth);
        }
        .memory-panel {
            position: absolute; top: 0; right: 0;
            width: 500px; max-width: 90vw; height: 100%;
            background: var(--bg-secondary);
            border-left: 1px solid var(--border-medium);
            display: flex; flex-direction: column;
            transform: translateX(100%);
            transition: transform 0.4s var(--ease-smooth);
            box-shadow: -16px 0 48px rgba(0,0,0,0.1);
        }
        .memory-header {
            display: flex; align-items: center; justify-content: space-between;
            padding: 20px 24px; border-bottom: 1px solid var(--border-subtle);
            flex-shrink: 0;
        }
        .memory-title {
            font-size: 17px; font-weight: 700; color: var(--text-primary);
            display: flex; align-items: center; gap: 8px;
        }
        .memory-close {
            width: 32px; height: 32px;
            display: flex; align-items: center; justify-content: center;
            border: none; background: var(--bg-tertiary); color: var(--text-secondary);
            border-radius: 8px; cursor: pointer; font-size: 16px;
            transition: all 0.2s var(--ease-smooth); font-family: inherit;
        }
        .memory-close:hover { background: var(--exec-gray-100); color: var(--text-primary); }
        .memory-body {
            flex: 1; overflow-y: auto; padding: 0;
            scrollbar-width: thin; scrollbar-color: var(--exec-gray-300) transparent;
        }
        .memory-body::-webkit-scrollbar { width: 4px; }
        .memory-body::-webkit-scrollbar-thumb { background: var(--exec-gray-300); border-radius: 2px; }
        .memory-section {
            padding: 18px 24px;
            border-bottom: 1px solid var(--border-subtle);
        }
        .memory-section:last-child { border-bottom: none; }
        .memory-section-title {
            font-size: 11px; font-weight: 600; color: var(--text-tertiary);
            text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px;
        }
        .memory-content-md {
            font-size: 13px; color: var(--text-secondary);
            line-height: 1.6;
        }
        .memory-content-md h1, .memory-content-md h2, .memory-content-md h3 {
            color: var(--text-primary); margin: 14px 0 6px; font-weight: 700;
        }
        .memory-content-md h1 { font-size: 18px; }
        .memory-content-md h2 { font-size: 15px; }
        .memory-content-md h3 { font-size: 13px; }
        .memory-content-md ul, .memory-content-md ol {
            padding-left: 18px; margin: 6px 0;
        }
        .memory-content-md li { margin: 3px 0; }
        .memory-content-md strong { color: var(--text-primary); }
        .memory-content-md code {
            background: var(--bg-tertiary); padding: 1px 5px;
            border-radius: 4px; font-size: 12px;
        }
        .memory-golden-rules {
            background: rgba(255, 214, 10, 0.08);
            border: 1px solid rgba(255, 214, 10, 0.2);
            border-radius: 10px; padding: 14px 16px;
            margin-bottom: 12px;
        }
        .memory-golden-rules-title {
            font-size: 12px; font-weight: 700; color: #B89B00;
            margin-bottom: 8px;
        }
        .memory-daily-list { display: flex; flex-direction: column; gap: 6px; }
        .memory-daily-item {
            display: flex; align-items: center; gap: 10px;
            padding: 8px 12px; background: var(--bg-tertiary);
            border-radius: 8px; font-size: 12px; color: var(--text-secondary);
            cursor: default;
        }
        .memory-daily-item-date { font-weight: 600; color: var(--text-primary); min-width: 80px; }
        .memory-daily-item-size { color: var(--text-tertiary); margin-left: auto; }
        .memory-readonly {
            display: flex; align-items: center; gap: 6px;
            padding: 8px 14px; background: rgba(0,122,255,0.06);
            border-radius: 8px; font-size: 11px; color: var(--exec-blue);
            font-weight: 500; margin-top: 12px;
        }

        /* ═══════════════════════════════════════════════════
           Status Bar Action Buttons
           ═══════════════════════════════════════════════════ */
        .statusbar-action {
            display: flex; align-items: center; gap: 5px;
            padding: 5px 10px; background: transparent;
            border: 1px solid var(--border-subtle); border-radius: 7px;
            cursor: pointer; font-family: var(--font-family);
            font-size: 12px; font-weight: 500; color: var(--text-tertiary);
            transition: all 0.2s var(--ease-smooth);
            white-space: nowrap;
        }
        .statusbar-action:hover {
            background: rgba(0,0,0,0.04); border-color: var(--border-medium);
            color: var(--text-secondary);
        }
        .statusbar-action-icon { font-size: 14px; }

        /* ═══════════════════════════════════════════════════
           Mailbox — Priority Flags & Dispatch (Feature 3/8)
           ═══════════════════════════════════════════════════ */
        .mail-flags {
            display: flex; align-items: center; gap: 6px;
            margin-top: 4px;
        }
        .mail-flag {
            font-size: 10px; padding: 1px 6px;
            border-radius: 4px; font-weight: 600;
        }
        .mail-flag--urgent { background: rgba(255,69,58,0.12); color: #FF453A; }
        .mail-flag--normal { background: rgba(255,214,10,0.12); color: #B89B00; }
        .mail-flag--info { background: rgba(48,209,88,0.12); color: #30D158; }
        .mail-dispatch {
            display: flex; align-items: center; gap: 4px;
            font-size: 10px; color: var(--text-tertiary); margin-top: 4px;
        }
        .mail-dispatch-arrow { color: var(--exec-blue); }
        
        /* ═══════════════════════════════════════════════════
           Decommission Animation (NEW #7)
           ═══════════════════════════════════════════════════ */
        @keyframes decommissionFade {
            0% { opacity: 1; transform: scale(1); filter: brightness(1); }
            30% { opacity: 0.8; transform: scale(1.02); filter: brightness(1.3); }
            60% { opacity: 0.4; transform: scale(0.95); filter: brightness(0.7) blur(2px); }
            100% { opacity: 0; transform: scale(0.8); filter: brightness(0) blur(8px); }
        }
        @keyframes decommissionParticles {
            0% { opacity: 1; }
            50% { opacity: 0.6; }
            100% { opacity: 0; transform: translateY(-20px) scale(0); }
        }
        .decommission-anim {
            animation: decommissionFade 800ms var(--ease-smooth) forwards;
            pointer-events: none;
        }
        .decommission-particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: var(--exec-blue);
            border-radius: 50%;
            animation: decommissionParticles 800ms ease-out forwards;
        }

        /* ═══════════════════════════════════════════════════
           Toast Notification
           ═══════════════════════════════════════════════════ */
        .exec-toast {
            position: fixed; bottom: 80px; left: 50%;
            transform: translateX(-50%) translateY(20px);
            padding: 10px 20px; background: var(--exec-gray-900);
            color: white; border-radius: 10px; font-size: 13px;
            font-weight: 500; z-index: 999;
            opacity: 0; transition: all 0.3s var(--ease-smooth);
            pointer-events: none;
            box-shadow: 0 8px 24px rgba(0,0,0,0.25);
        }
        .exec-toast.show {
            opacity: 1; transform: translateX(-50%) translateY(0);
        }

        /* ═══════════════════════════════════════════════════
           FIX #17: Room Visual Differentiation — Per-Agent Identity
           ═══════════════════════════════════════════════════ */
        
        /* ── CEO: Gold accent, premium presence ────── */
        .exec-room--ceo {
            border-left: 4px solid #FFD60A;
            background: linear-gradient(135deg,
                rgba(255, 214, 10, 0.04) 0%,
                rgba(255, 255, 255, 0.95) 30%,
                rgba(255, 255, 255, 0.85) 100%
            );
        }
        .exec-room--ceo::before {
            background: radial-gradient(ellipse at 20% 50%, rgba(255, 214, 10, 0.06) 0%, transparent 60%);
        }

        /* ── Forge (CTO): Purple/indigo, terminal icon ──── */
        .exec-room--forge {
            border-left: 4px solid #7C3AED;
        }
        .exec-room--forge::before {
            background:
                radial-gradient(ellipse at 85% 85%, rgba(124, 58, 237, 0.05) 0%, transparent 50%);
        }
        .exec-room--forge::after {
            content: '⌨️';
            position: absolute;
            bottom: 10px;
            right: 14px;
            font-size: 18px;
            opacity: 0.12;
            pointer-events: none;
        }

        /* ── Atlas (COO): Teal, structured/organized ──── */
        .exec-room--atlas {
            border-left: 4px solid #06B6D4;
        }
        .exec-room--atlas::before {
            background:
                radial-gradient(ellipse at 15% 85%, rgba(6, 182, 212, 0.05) 0%, transparent 50%);
        }
        .exec-room--atlas::after {
            content: '📋';
            position: absolute;
            bottom: 10px;
            right: 14px;
            font-size: 18px;
            opacity: 0.12;
            pointer-events: none;
        }

        /* ── Hunter (CRO): Red/coral, target decoration ──── */
        .exec-room--hunter {
            border-left: 4px solid #EF4444;
        }
        .exec-room--hunter::before {
            background:
                radial-gradient(ellipse at 85% 15%, rgba(239, 68, 68, 0.05) 0%, transparent 50%);
        }
        .exec-room--hunter::after {
            content: '🎯';
            position: absolute;
            bottom: 10px;
            right: 14px;
            font-size: 18px;
            opacity: 0.12;
            pointer-events: none;
        }

        /* ── Echo (CMO): Pink/magenta, creative decoration ──── */
        .exec-room--echo {
            border-left: 4px solid #EC4899;
        }
        .exec-room--echo::before {
            background:
                radial-gradient(ellipse at 15% 15%, rgba(236, 72, 153, 0.05) 0%, transparent 50%);
        }
        .exec-room--echo::after {
            content: '🎨';
            position: absolute;
            bottom: 10px;
            right: 14px;
            font-size: 18px;
            opacity: 0.12;
            pointer-events: none;
        }

        /* ── Sentinel (QA): Green, shield decoration ──── */
        .exec-room--sentinel {
            border-left: 4px solid #22C55E;
        }
        .exec-room--sentinel::before {
            background:
                radial-gradient(ellipse at 85% 50%, rgba(34, 197, 94, 0.05) 0%, transparent 50%);
        }
        .exec-room--sentinel::after {
            content: '🛡️';
            position: absolute;
            bottom: 10px;
            right: 14px;
            font-size: 18px;
            opacity: 0.12;
            pointer-events: none;
        }

        /* ── Meeting/Boardroom: Distinguished look ──── */
        .exec-room--meeting {
            border-left: 4px solid var(--exec-blue);
        }

        /* ── Idle/Cafeteria State ──────────────────── */
        .exec-room.room-idle {
            opacity: 0.72;
            filter: saturate(0.7);
            transition: opacity 0.5s var(--ease-smooth), filter 0.5s var(--ease-smooth);
        }
        .exec-room.room-idle:hover {
            opacity: 0.9;
            filter: saturate(0.9);
        }
        .exec-room.room-idle .agent-status-dot {
            background: var(--exec-gray-400) !important;
        }
        .agent-idle-coffee {
            display: inline-flex;
            align-items: center;
            gap: 3px;
            font-size: 11px;
            color: var(--text-tertiary);
            margin-top: 2px;
            opacity: 0;
            animation: fadeInCoffee 0.5s var(--ease-smooth) forwards;
        }
        @keyframes fadeInCoffee {
            to { opacity: 1; }
        }
        .room-idle-overlay {
            position: absolute;
            inset: 0;
            border-radius: inherit;
            background: linear-gradient(180deg, transparent 40%, rgba(0,0,0,0.02) 100%);
            pointer-events: none;
            z-index: 1;
        }

        /* ── Hierarchy view: per-agent card accents ──── */
        .org-card[data-agent="forge"] { border-left: 3px solid #7C3AED; }
        .org-card[data-agent="atlas"] { border-left: 3px solid #06B6D4; }
        .org-card[data-agent="hunter"] { border-left: 3px solid #EF4444; }
        .org-card[data-agent="echo"] { border-left: 3px solid #EC4899; }
        .org-card[data-agent="sentinel"] { border-left: 3px solid #22C55E; }
        .org-card[data-agent="ceo"], .org-card--ceo { border-left: 3px solid #FFD60A; }

        /* ═══════════════════════════════════════════════════
           FIX #1: Real-Time Log Viewer Panel
           ═══════════════════════════════════════════════════ */
        .logs-overlay {
            position: fixed; inset: 0; z-index: 200;
            pointer-events: none; opacity: 0;
            transition: opacity 0.3s var(--ease-smooth);
        }
        .logs-overlay.open { pointer-events: auto; opacity: 1; }
        .logs-overlay.open .logs-backdrop { opacity: 1; }
        .logs-overlay.open .logs-panel { transform: translateX(0); }
        .logs-backdrop {
            position: absolute; inset: 0;
            background: rgba(0,0,0,0.5); opacity: 0;
            transition: opacity 0.35s var(--ease-smooth);
        }
        .logs-panel {
            position: absolute; top: 0; right: 0;
            width: 520px; max-width: 95vw; height: 100%;
            background: var(--bg-secondary);
            border-left: 1px solid var(--border-medium);
            display: flex; flex-direction: column;
            transform: translateX(100%);
            transition: transform 0.4s var(--ease-smooth);
            box-shadow: -16px 0 48px rgba(0,0,0,0.1);
        }
        .logs-header {
            display: flex; align-items: center; justify-content: space-between;
            padding: 20px 24px; border-bottom: 1px solid var(--border-subtle);
            flex-shrink: 0; gap: 12px;
        }
        .logs-title {
            font-size: 17px; font-weight: 700; color: var(--text-primary);
            display: flex; align-items: center; gap: 8px;
        }
        .logs-close {
            width: 32px; height: 32px;
            display: flex; align-items: center; justify-content: center;
            border: none; background: var(--bg-tertiary); color: var(--text-secondary);
            border-radius: 8px; cursor: pointer; font-size: 16px;
            transition: all 0.2s var(--ease-smooth); font-family: inherit; flex-shrink: 0;
        }
        .logs-close:hover { background: var(--exec-gray-100); color: var(--text-primary); }
        .logs-filter {
            padding: 4px 10px; border-radius: 8px;
            border: 1px solid var(--border-medium);
            background: var(--bg-tertiary); color: var(--text-secondary);
            font-size: 12px; font-family: var(--font-family);
            cursor: pointer; flex-shrink: 0;
        }
        .logs-body {
            flex: 1; overflow-y: auto; padding: 0;
            scrollbar-width: thin; scrollbar-color: var(--exec-gray-300) transparent;
            font-family: 'SF Mono', 'Fira Code', 'Cascadia Code', monospace;
        }
        .logs-body::-webkit-scrollbar { width: 4px; }
        .logs-body::-webkit-scrollbar-thumb { background: var(--exec-gray-300); border-radius: 2px; }
        .log-entry {
            display: flex; align-items: flex-start; gap: 10px;
            padding: 8px 24px; border-bottom: 1px solid var(--border-subtle);
            font-size: 12px; line-height: 1.5;
            transition: background 0.15s;
        }
        .log-entry:hover { background: rgba(0,0,0,0.02); }
        .log-time {
            color: var(--text-tertiary); white-space: nowrap;
            font-size: 11px; min-width: 55px; flex-shrink: 0;
            font-family: 'SF Mono', 'Fira Code', monospace;
        }
        .log-role {
            font-weight: 600; font-size: 10px; text-transform: uppercase;
            letter-spacing: 0.5px; padding: 1px 6px; border-radius: 4px;
            white-space: nowrap; flex-shrink: 0; min-width: 60px; text-align: center;
        }
        .log-role--user { background: rgba(0,122,255,0.12); color: #007AFF; }
        .log-role--assistant { background: rgba(48,209,88,0.12); color: #30D158; }
        .log-role--system { background: rgba(255,214,10,0.12); color: #B89B00; }
        .log-role--error { background: rgba(255,69,58,0.12); color: #FF453A; }
        .log-text {
            flex: 1; color: var(--text-secondary);
            overflow: hidden; text-overflow: ellipsis;
            white-space: nowrap; min-width: 0;
        }
        .log-model {
            font-size: 10px; color: var(--text-tertiary);
            white-space: nowrap; flex-shrink: 0;
        }
        .logs-status {
            padding: 8px 24px; border-top: 1px solid var(--border-subtle);
            display: flex; align-items: center; justify-content: space-between;
            font-size: 11px; color: var(--text-tertiary); flex-shrink: 0;
        }
        .logs-live-dot {
            width: 6px; height: 6px; border-radius: 50%;
            background: #30D158; display: inline-block;
            animation: statusPulse 2s ease-in-out infinite;
            margin-right: 6px;
        }
        .logs-empty {
            padding: 60px 24px; text-align: center;
            color: var(--text-tertiary); font-size: 13px;
            font-family: var(--font-family);
        }

        /* ═══════════════════════════════════════════════════
           FIX #13: Enhanced Agent Builder — Inline Editor
           ═══════════════════════════════════════════════════ */
        .detail-editor-section {
            padding: 14px 0;
        }
        .detail-editor-field {
            display: flex; flex-direction: column; gap: 4px;
            margin-bottom: 10px;
        }
        .detail-editor-label {
            font-size: 11px; font-weight: 600;
            color: var(--text-tertiary); text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .detail-editor-input {
            padding: 7px 12px; border-radius: 8px;
            border: 1px solid var(--border-medium);
            font-size: 13px; font-family: var(--font-family);
            background: var(--bg-tertiary); color: var(--text-primary);
            outline: none; transition: border-color 0.2s, box-shadow 0.2s;
        }
        .detail-editor-input:focus {
            border-color: var(--exec-blue);
            box-shadow: 0 0 0 3px var(--exec-blue-muted);
        }
        .detail-color-picker-row {
            display: flex; align-items: center; gap: 10px;
        }
        .detail-color-swatch {
            width: 28px; height: 28px; border-radius: 8px;
            border: 2px solid var(--border-medium); cursor: pointer;
            transition: transform 0.2s;
        }
        .detail-color-swatch:hover { transform: scale(1.1); }
        .detail-color-swatch.selected {
            border-color: var(--exec-blue);
            box-shadow: 0 0 0 2px var(--exec-blue-muted);
        }
        .detail-save-bar {
            display: flex; gap: 8px; margin-top: 12px;
        }
        .detail-save-btn {
            padding: 8px 20px; border-radius: 8px; border: none;
            background: var(--exec-blue); color: #fff;
            font-size: 13px; font-weight: 600; cursor: pointer;
            transition: all 0.2s var(--ease-smooth);
            font-family: var(--font-family);
        }
        .detail-save-btn:hover { background: var(--exec-blue-hover); transform: translateY(-1px); }
        .detail-cancel-btn {
            padding: 8px 16px; border-radius: 8px;
            border: 1px solid var(--border-medium); background: transparent;
            color: var(--text-secondary); font-size: 13px; cursor: pointer;
            font-family: var(--font-family);
            transition: all 0.2s;
        }
        .detail-cancel-btn:hover { background: var(--bg-tertiary); }
        .detail-toast-saved {
            display: inline-flex; align-items: center; gap: 6px;
            padding: 6px 14px; background: rgba(48,209,88,0.12);
            border-radius: 8px; color: #30D158; font-size: 12px;
            font-weight: 600; animation: toastFadeIn 0.3s var(--ease-smooth);
        }
        @keyframes toastFadeIn {
            from { opacity: 0; transform: translateY(4px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ═══════════════════════════════════════════════════
           Reduced Motion
           ═══════════════════════════════════════════════════ */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* ═══════════════════════════════════════════════════
           #1 — Logs Metrics Header
           ═══════════════════════════════════════════════════ */
        .logs-metrics-bar {
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px;
            padding: 14px 24px; border-bottom: 1px solid var(--border-subtle);
            background: var(--bg-tertiary);
        }
        .logs-metric-card {
            display: flex; flex-direction: column; gap: 2px;
            padding: 8px 10px; background: var(--bg-secondary);
            border-radius: 8px; border: 1px solid var(--border-subtle);
        }
        .logs-metric-card-value {
            font-size: 15px; font-weight: 700; color: var(--text-primary);
        }
        .logs-metric-card-label {
            font-size: 10px; font-weight: 500; color: var(--text-tertiary);
            text-transform: uppercase; letter-spacing: 0.5px;
        }

        /* ═══════════════════════════════════════════════════
           #3 — CEO Detail: Gold border, crown, mini-chat
           ═══════════════════════════════════════════════════ */
        .detail-ceo-crown {
            position: absolute; top: -8px; left: 50%; transform: translateX(-50%);
            font-size: 20px; z-index: 3; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.15));
        }
        .detail-hero--ceo {
            border-bottom: 2px solid #FFD60A !important;
            background: linear-gradient(135deg, rgba(255,214,10,0.04), transparent);
        }
        .detail-hero--ceo .detail-hero-avatar {
            border: 3px solid #FFD60A; border-radius: 50%;
        }
        .detail-mini-chat {
            display: flex; flex-direction: column; gap: 8px;
            max-height: 200px; overflow-y: auto;
        }
        .detail-mini-chat-msg {
            display: flex; gap: 8px; align-items: flex-start;
            padding: 6px 10px; border-radius: 10px;
            font-size: 12px; line-height: 1.4;
            background: var(--bg-tertiary);
        }
        .detail-mini-chat-msg--user {
            background: rgba(0,122,255,0.08);
        }
        .detail-mini-chat-msg-role {
            font-weight: 600; font-size: 10px;
            color: var(--text-tertiary); white-space: nowrap;
            min-width: 48px;
        }
        .detail-mini-chat-msg-text {
            color: var(--text-secondary); flex: 1;
        }
        .detail-open-chat-btn {
            display: flex; align-items: center; justify-content: center;
            gap: 6px; padding: 10px 16px; margin-top: 8px;
            background: var(--exec-blue); color: #fff;
            border: none; border-radius: 10px;
            font-size: 13px; font-weight: 600; cursor: pointer;
            font-family: var(--font-family);
            transition: all 0.2s var(--ease-smooth);
        }
        .detail-open-chat-btn:hover { background: var(--exec-blue-hover); transform: translateY(-1px); }

        /* ═══════════════════════════════════════════════════
           #7 — Calendar Timeline Header
           ═══════════════════════════════════════════════════ */
        .cron-timeline {
            display: flex; align-items: flex-end; gap: 2px;
            padding: 16px 24px 12px; border-bottom: 1px solid var(--border-subtle);
            background: var(--bg-tertiary); overflow-x: auto;
        }
        .cron-timeline-hour {
            display: flex; flex-direction: column; align-items: center; gap: 4px;
            min-width: 32px;
        }
        .cron-timeline-bar {
            width: 24px; border-radius: 4px 4px 0 0;
            background: var(--exec-gray-100); transition: background 0.2s;
        }
        .cron-timeline-bar.has-event {
            background: var(--exec-blue);
        }
        .cron-timeline-bar.current-hour {
            background: var(--status-active); box-shadow: 0 0 6px rgba(48,209,88,0.4);
        }
        .cron-timeline-label {
            font-size: 9px; color: var(--text-tertiary); font-weight: 500;
        }
        .cron-timeline-label.current-hour { color: var(--status-active); font-weight: 700; }

        /* ═══════════════════════════════════════════════════
           #9 — Model Dropdown, Priority, Session selectors
           ═══════════════════════════════════════════════════ */
        .detail-editor-select {
            padding: 7px 12px; border-radius: 8px;
            border: 1px solid var(--border-medium);
            font-size: 13px; font-family: var(--font-family);
            background: var(--bg-tertiary); color: var(--text-primary);
            outline: none; transition: border-color 0.2s, box-shadow 0.2s;
            cursor: pointer; width: 100%;
        }
        .detail-editor-select:focus {
            border-color: var(--exec-blue);
            box-shadow: 0 0 0 3px var(--exec-blue-muted);
        }
        .detail-readonly-badge {
            display: inline-flex; align-items: center; gap: 5px;
            padding: 4px 12px; background: rgba(0,0,0,0.04);
            border: 1px solid var(--border-subtle); border-radius: 8px;
            font-size: 11px; font-weight: 500; color: var(--text-tertiary);
        }
        .detail-soul-preview {
            padding: 10px 14px; background: var(--bg-tertiary);
            border-radius: 8px; border-left: 3px solid var(--exec-blue);
            font-size: 12px; color: var(--text-secondary); line-height: 1.5;
            font-style: italic; max-height: 120px; overflow-y: auto;
        }
        .detail-skill-checkbox {
            display: flex; align-items: center; gap: 8px;
            padding: 5px 0; font-size: 13px; color: var(--text-primary);
        }
        .detail-skill-checkbox input[type="checkbox"] {
            accent-color: var(--exec-blue);
        }
        .detail-skill-checkbox-desc {
            font-size: 11px; color: var(--text-tertiary); margin-left: auto;
        }

        /* ═══════════════════════════════════════════════════
           #10 — Idle agent enhanced visuals
           ═══════════════════════════════════════════════════ */
        .idle-timer {
            font-size: 10px; color: var(--text-tertiary);
            font-variant-numeric: tabular-nums;
        }

        /* ═══════════════════════════════════════════════════
           #11 — Sub-agent dispatch hint in chat
           ═══════════════════════════════════════════════════ */
        .chat-route-hint {
            padding: 6px 16px; font-size: 11px; color: var(--text-tertiary);
            background: rgba(0,122,255,0.04); border-bottom: 1px solid var(--border-subtle);
            display: none;
        }
        .chat-route-hint.visible { display: block; }

        /* ═══════════════════════════════════════════════════
           #12 — Mailbox notification pulse
           ═══════════════════════════════════════════════════ */
        .mailbox-notif-dot {
            position: absolute; top: -3px; right: -3px;
            width: 10px; height: 10px; background: #FF453A;
            border-radius: 50%; border: 2px solid var(--bg-room);
            animation: mailboxNotifPulse 2s ease-in-out infinite;
            z-index: 3;
        }
        @keyframes mailboxNotifPulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255,69,58,0.4); }
            50% { transform: scale(1.2); box-shadow: 0 0 0 6px rgba(255,69,58,0); }
        }
        .mail-item--new {
            background: rgba(0,122,255,0.04);
            animation: mailNewSlide 0.4s var(--ease-smooth);
        }
        @keyframes mailNewSlide {
            from { opacity: 0; transform: translateY(-8px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ═══════════════════════════════════════════════════
           #13 — Mailbox dispatch detail view
           ═══════════════════════════════════════════════════ */
        .mail-detail-view {
            padding: 20px 24px; border-bottom: 1px solid var(--border-subtle);
            animation: detailSlideIn 0.3s var(--ease-smooth);
        }
        .mail-detail-header {
            display: flex; align-items: center; gap: 12px; margin-bottom: 12px;
        }
        .mail-detail-back {
            width: 28px; height: 28px;
            display: flex; align-items: center; justify-content: center;
            border: none; background: var(--bg-tertiary); color: var(--text-secondary);
            border-radius: 7px; cursor: pointer; font-size: 14px;
            transition: all 0.2s var(--ease-smooth); font-family: inherit;
        }
        .mail-detail-back:hover { background: var(--exec-gray-100); }
        .mail-detail-sender {
            font-size: 15px; font-weight: 700; color: var(--text-primary);
        }
        .mail-detail-time {
            font-size: 11px; color: var(--text-tertiary); margin-left: auto;
        }
        .mail-detail-body {
            font-size: 14px; color: var(--text-primary); line-height: 1.6;
            margin-bottom: 16px; white-space: pre-wrap;
        }
        .mail-detail-priority {
            display: inline-flex; align-items: center; gap: 6px;
            padding: 4px 12px; border-radius: 6px;
            font-size: 12px; font-weight: 600;
        }
        .mail-detail-priority--urgent { background: rgba(255,69,58,0.1); color: #FF453A; }
        .mail-detail-priority--normal { background: rgba(255,214,10,0.1); color: #B89B00; }
        .mail-detail-priority--info { background: rgba(48,209,88,0.1); color: #30D158; }
        .mail-detail-dispatch {
            display: flex; align-items: center; gap: 10px;
            padding: 12px 16px; margin-top: 12px;
            background: rgba(0,122,255,0.04); border-radius: 10px;
            border: 1px solid rgba(0,122,255,0.1);
        }
        .mail-detail-dispatch-arrow {
            font-size: 18px; color: var(--exec-blue);
            animation: dispatchArrowAnim 1.5s ease-in-out infinite;
        }
        @keyframes dispatchArrowAnim {
            0%, 100% { transform: translateX(0); opacity: 1; }
            50% { transform: translateX(4px); opacity: 0.6; }
        }
        .mail-detail-dispatch-target {
            font-size: 13px; font-weight: 600; color: var(--text-primary);
        }
        .mail-detail-dispatch-status {
            margin-left: auto; font-size: 12px; font-weight: 500;
        }

        /* ═══════════════════════════════════════════════════
           #14 — Room backgrounds: stronger visual identity
           ═══════════════════════════════════════════════════ */
        .exec-room--ceo {
            background: linear-gradient(135deg,
                rgba(255, 214, 10, 0.06) 0%,
                rgba(255, 255, 255, 0.95) 30%,
                rgba(255, 248, 220, 0.4) 100%
            ) !important;
            border: 1px solid rgba(255, 214, 10, 0.2) !important;
            border-left: 4px solid #FFD60A !important;
        }
        .exec-room--forge {
            background: linear-gradient(135deg,
                rgba(124, 58, 237, 0.06) 0%,
                rgba(255, 255, 255, 0.92) 50%,
                rgba(238, 230, 255, 0.3) 100%
            ) !important;
        }
        .exec-room--atlas {
            background: linear-gradient(135deg,
                rgba(6, 182, 212, 0.05) 0%,
                rgba(255, 255, 255, 0.92) 50%,
                rgba(220, 245, 250, 0.3) 100%
            ) !important;
        }
        .exec-room--hunter {
            background: linear-gradient(135deg,
                rgba(239, 68, 68, 0.05) 0%,
                rgba(255, 255, 255, 0.92) 50%,
                rgba(255, 230, 230, 0.3) 100%
            ) !important;
        }
        .exec-room--echo {
            background: linear-gradient(135deg,
                rgba(236, 72, 153, 0.05) 0%,
                rgba(255, 255, 255, 0.92) 50%,
                rgba(255, 228, 240, 0.3) 100%
            ) !important;
        }
        .exec-room--sentinel {
            background: linear-gradient(135deg,
                rgba(34, 197, 94, 0.05) 0%,
                rgba(255, 255, 255, 0.92) 50%,
                rgba(220, 255, 230, 0.3) 100%
            ) !important;
        }
        .exec-room--meeting {
            background: linear-gradient(135deg,
                rgba(0, 122, 255, 0.04) 0%,
                rgba(255, 255, 255, 0.92) 50%,
                rgba(230, 240, 255, 0.3) 100%
            ) !important;
        }
        /* Architectural walls between rooms */
        .exec-floor {
            background: linear-gradient(135deg, rgba(0,0,0,0.02), transparent);
            border-radius: 20px;
            padding: 18px 26px 26px !important;
        }
        .exec-room {
            border: 1px solid rgba(0,0,0,0.08) !important;
            box-shadow: inset 0 0 0 1px rgba(255,255,255,0.5);
        }

        /* ═══════════════════════════════════════════════════
           #15 — Skills list checkboxes in settings
           ═══════════════════════════════════════════════════ */
        .skills-list-grid {
            display: flex; flex-direction: column; gap: 6px;
        }
        .skill-list-item {
            display: flex; align-items: center; gap: 10px;
            padding: 8px 12px; background: var(--bg-tertiary);
            border-radius: 8px; transition: background 0.15s;
        }
        .skill-list-item:hover { background: var(--exec-gray-100); }
        .skill-list-item-check {
            font-size: 14px; color: var(--status-active); flex-shrink: 0;
        }
        .skill-list-item-name {
            font-size: 13px; font-weight: 600; color: var(--text-primary);
        }
        .skill-list-item-desc {
            font-size: 11px; color: var(--text-tertiary); margin-left: auto;
        }

        /* ═══════════════════════════════════════════════════
           #16 — Memory golden rules enhanced
           ═══════════════════════════════════════════════════ */
        .memory-golden-rules {
            background: linear-gradient(135deg, rgba(255,214,10,0.08), rgba(255,69,58,0.04)) !important;
            border: 1px solid rgba(255,69,58,0.2) !important;
            border-left: 4px solid #FF453A !important;
        }
        .memory-golden-rules-title {
            color: #FF453A !important; font-size: 13px !important;
        }

        /* ═══════════════════════════════════════════════════
           #18 — Decommission enhanced particles
           ═══════════════════════════════════════════════════ */
        .decommission-overlay-flash {
            position: fixed; inset: 0; z-index: 998;
            background: rgba(255,69,58,0.05);
            animation: decommFlash 600ms ease-out forwards;
            pointer-events: none;
        }
        @keyframes decommFlash {
            0% { opacity: 1; }
            100% { opacity: 0; }
        }

        /* ═══════════════════════════════════════════════════
           Missions — Progress bar styles
           ═══════════════════════════════════════════════════ */
        .mission-progress-bar {
            height: 6px; background: var(--exec-gray-100);
            border-radius: 3px; overflow: hidden; margin-top: 6px;
        }
        .mission-progress-fill {
            height: 100%; border-radius: 3px;
            transition: width 0.6s var(--ease-smooth);
        }
        .mission-progress-fill--active { background: var(--exec-blue); }
        .mission-progress-fill--done { background: var(--status-active); }
        .mission-meta {
            display: flex; align-items: center; gap: 8px;
            font-size: 11px; color: var(--text-tertiary); margin-top: 4px;
        }
    </style>
</head>
<body>

    <!-- ═══ Ambient Background ═══ -->
    <div class="exec-backdrop" aria-hidden="true"></div>
    <div class="exec-particles" aria-hidden="true">
        <div class="exec-particle"></div>
        <div class="exec-particle"></div>
        <div class="exec-particle"></div>
    </div>

    <!-- ═══ SVG Avatar Definitions (hidden, referenced by use) ═══ -->
    <svg xmlns="http://www.w3.org/2000/svg" style="display:none">
        <defs>
            <!-- ── ApoMac: Tech CEO with glasses ── -->
            <symbol id="avatar-ceo" viewBox="0 0 48 48">
                <circle cx="24" cy="24" r="24" fill="#007AFF"/>
                <circle cx="24" cy="20" r="10" fill="#F5D6B8"/>
                <path d="M14 42c0-8 4.5-14 10-14s10 6 10 14" fill="#1C1C1E"/>
                <!-- Hair -->
                <path d="M14 17c0-6 4.5-11 10-11s10 5 10 11c0 1-.2 2-.5 2.8-.8-4-4.5-7-9.5-7s-8.7 3-9.5 7c-.3-.8-.5-1.8-.5-2.8z" fill="#3A3A3C"/>
                <!-- Glasses -->
                <rect x="15.5" y="17.5" width="7" height="5.5" rx="2.5" fill="none" stroke="#1C1C1E" stroke-width="1.5"/>
                <rect x="25.5" y="17.5" width="7" height="5.5" rx="2.5" fill="none" stroke="#1C1C1E" stroke-width="1.5"/>
                <line x1="22.5" y1="20" x2="25.5" y2="20" stroke="#1C1C1E" stroke-width="1.2"/>
                <!-- Eyes behind glasses -->
                <circle cx="19" cy="20.2" r="1.2" fill="#1C1C1E"/>
                <circle cx="29" cy="20.2" r="1.2" fill="#1C1C1E"/>
                <!-- Smile -->
                <path d="M20 24.5c0 0 2 2.5 4 2.5s4-2.5 4-2.5" fill="none" stroke="#C4856A" stroke-width="1" stroke-linecap="round"/>
            </symbol>

            <!-- ── Atlas: Professional / Organized (neat hair, tie) ── -->
            <symbol id="avatar-atlas" viewBox="0 0 48 48">
                <circle cx="24" cy="24" r="24" fill="#BF5AF2"/>
                <circle cx="24" cy="20" r="10" fill="#E8C9A0"/>
                <path d="M14 42c0-8 4.5-14 10-14s10 6 10 14" fill="#4A3668"/>
                <!-- Tie -->
                <polygon points="24,29 22,34 24,36 26,34" fill="#9B59B6"/>
                <!-- Neat side-parted hair -->
                <path d="M14 17c0-6 4.5-11 10-11s10 5 10 11v1c0-5-3.5-9-7-9-2 0-3.5.8-4.5 2C21 9.5 19 10 17 12c-1.5 1.5-2.5 3-3 5z" fill="#2C1810"/>
                <!-- Eyes -->
                <ellipse cx="19.5" cy="19.5" rx="1.3" ry="1.5" fill="#1C1C1E"/>
                <ellipse cx="28.5" cy="19.5" rx="1.3" ry="1.5" fill="#1C1C1E"/>
                <!-- Subtle smile -->
                <path d="M21 24c0 0 1.5 2 3 2s3-2 3-2" fill="none" stroke="#B5896E" stroke-width="1" stroke-linecap="round"/>
            </symbol>

            <!-- ── Forge: Engineer with hard hat ── -->
            <symbol id="avatar-forge" viewBox="0 0 48 48">
                <circle cx="24" cy="24" r="24" fill="#FF9F0A"/>
                <circle cx="24" cy="21" r="10" fill="#D4A87A"/>
                <path d="M14 42c0-8 4.5-14 10-14s10 6 10 14" fill="#5C3D1E"/>
                <!-- Hard hat -->
                <path d="M12 17h24v2c0 1-1 2-2 2H14c-1 0-2-1-2-2v-2z" fill="#FFD60A"/>
                <path d="M14 17c0-5 4.5-9 10-9s10 4 10 9H14z" fill="#FFD60A"/>
                <rect x="12" y="16.5" width="24" height="2" rx="1" fill="#E8B800"/>
                <!-- Hat stripe -->
                <rect x="14" y="12" width="20" height="1.5" rx="0.75" fill="#E8B800"/>
                <!-- Eyes — determined -->
                <rect x="18" y="19" width="3" height="2" rx="1" fill="#1C1C1E"/>
                <rect x="27" y="19" width="3" height="2" rx="1" fill="#1C1C1E"/>
                <!-- Confident grin -->
                <path d="M20 25c0 0 2 2 4 2s4-2 4-2" fill="none" stroke="#A07050" stroke-width="1.2" stroke-linecap="round"/>
            </symbol>

            <!-- ── Hunter: Sharp / Aggressive (angular features, sharp eyes) ── -->
            <symbol id="avatar-hunter" viewBox="0 0 48 48">
                <circle cx="24" cy="24" r="24" fill="#FF453A"/>
                <circle cx="24" cy="20" r="10" fill="#E8C9A0"/>
                <path d="M14 42c0-8 4.5-14 10-14s10 6 10 14" fill="#1C1C1E"/>
                <!-- Spiky/angular hair -->
                <path d="M14 16l3-8 4 5 3-6 3 4 4-5 3 7 2-3v6c0-6-4-11-10-11S14 10 14 16z" fill="#8B0000"/>
                <!-- Sharp eyes — angled brows -->
                <line x1="16" y1="17" x2="21" y2="18.5" stroke="#1C1C1E" stroke-width="1.5" stroke-linecap="round"/>
                <line x1="32" y1="17" x2="27" y2="18.5" stroke="#1C1C1E" stroke-width="1.5" stroke-linecap="round"/>
                <circle cx="19" cy="20" r="1.4" fill="#1C1C1E"/>
                <circle cx="29" cy="20" r="1.4" fill="#1C1C1E"/>
                <!-- Smirk -->
                <path d="M21 24.5c0 0 1 1.5 3 1.5 3 0 4-2.5 4-2.5" fill="none" stroke="#B5896E" stroke-width="1" stroke-linecap="round"/>
            </symbol>

            <!-- ── Echo: Creative / Artistic (colorful, beret/headband) ── -->
            <symbol id="avatar-echo" viewBox="0 0 48 48">
                <circle cx="24" cy="24" r="24" fill="#0A84FF"/>
                <circle cx="24" cy="21" r="10" fill="#F0D5B8"/>
                <path d="M14 42c0-8 4.5-14 10-14s10 6 10 14" fill="#2A6CB5"/>
                <!-- Wavy/creative hair -->
                <path d="M14 18c0-6 4.5-11 10-11s10 5 10 11c-1-3-4-6-7-6-1.5 0-3 .5-4 1.5C22 12 20 11 17.5 12 15.5 13 14.5 15 14 18z" fill="#5B3A8C"/>
                <!-- Beret/headband -->
                <path d="M13 15c2-3 6-5 11-5s9 2 11 5" fill="none" stroke="#FF6B9D" stroke-width="2.5" stroke-linecap="round"/>
                <circle cx="32" cy="13" r="2" fill="#FF6B9D"/>
                <!-- Expressive eyes -->
                <ellipse cx="19.5" cy="20" rx="1.5" ry="1.8" fill="#1C1C1E"/>
                <ellipse cx="28.5" cy="20" rx="1.5" ry="1.8" fill="#1C1C1E"/>
                <!-- Eye sparkles -->
                <circle cx="20.2" cy="19.2" r="0.6" fill="white"/>
                <circle cx="29.2" cy="19.2" r="0.6" fill="white"/>
                <!-- Happy smile -->
                <path d="M20 25c0 0 2 3 4 3s4-3 4-3" fill="none" stroke="#C4856A" stroke-width="1" stroke-linecap="round"/>
            </symbol>

            <!-- ── Sentinel: Vigilant Guard (helmet visor, alert eyes) ── -->
            <symbol id="avatar-sentinel" viewBox="0 0 48 48">
                <circle cx="24" cy="24" r="24" fill="#30D158"/>
                <circle cx="24" cy="21" r="10" fill="#D4B896"/>
                <path d="M14 42c0-8 4.5-14 10-14s10 6 10 14" fill="#1B3A1B"/>
                <!-- Guard helmet / visor -->
                <path d="M13 18c0-7 5-12 11-12s11 5 11 12H13z" fill="#2D5A2D"/>
                <path d="M13 18h22v2c0 1-1 1.5-2 1.5H15c-1 0-2-.5-2-1.5v-2z" fill="#1B3A1B"/>
                <!-- Visor slit with glowing eyes -->
                <rect x="15" y="18" width="18" height="3.5" rx="1.5" fill="#0A1A0A" opacity="0.8"/>
                <!-- Alert scanning eyes -->
                <circle cx="20" cy="19.8" r="1.5" fill="#30D158"/>
                <circle cx="20" cy="19.8" r="0.7" fill="#FFFFFF"/>
                <circle cx="28" cy="19.8" r="1.5" fill="#30D158"/>
                <circle cx="28" cy="19.8" r="0.7" fill="#FFFFFF"/>
                <!-- Stoic line mouth -->
                <line x1="21" y1="26" x2="27" y2="26" stroke="#A07050" stroke-width="1.2" stroke-linecap="round"/>
            </symbol>
        </defs>
    </svg>

    <!-- ═══ Main Container ═══ -->
    <div class="exec-container">

        <!-- ═══ View Toggle ═══ -->
        <div class="exec-view-toggle">
            <div class="view-toggle-group" role="tablist" aria-label="View mode">
                <button class="view-toggle-btn active" role="tab" aria-selected="true" aria-controls="gridView" id="tabGrid" data-view="grid">
                    <span class="view-toggle-icon" aria-hidden="true">⊞</span>
                    <span>Office Grid</span>
                </button>
                <button class="view-toggle-btn" role="tab" aria-selected="false" aria-controls="hierarchyView" id="tabHierarchy" data-view="hierarchy">
                    <span class="view-toggle-icon" aria-hidden="true">⋮⋮</span>
                    <span>Org Chart</span>
                </button>
            </div>
        </div>

        <!-- ═══ Office Floor Grid (Grid View) ═══ -->
        <div class="exec-floor" id="gridView" role="tabpanel" aria-labelledby="tabGrid">

            <!-- ── CEO Room ────────────────────────────── -->
            <div class="exec-room exec-room--ceo" role="button" tabindex="0" aria-label="CEO Office — ApoMac" data-agent="ceo">
                <span class="exec-room-label">CEO Office</span>
                <div class="ceo-content">
                    <div class="agent-avatar agent-avatar--lg" aria-hidden="true">
                        <svg><use href="#avatar-ceo"/></svg>
                        <span class="agent-status-dot agent-status-dot--active" aria-label="Active"></span>
                    </div>
                    <div class="ceo-info">
                        <span class="agent-name">ApoMac</span>
                        <span class="agent-role">Chief Executive Officer</span>
                    </div>
                </div>
                <button class="ceo-mailbox" aria-label="Open mailbox — 3 unread messages" id="mailboxBtn">
                    <span class="ceo-mailbox-icon" aria-hidden="true">📬</span>
                    <span>Inbox</span>
                    <span class="ceo-mailbox-badge" id="mailboxBadge">3</span>
                </button>

                <!-- CEO Detail (hidden by default) -->
                <div class="agent-detail" id="detail-ceo">
                    <div class="agent-detail-row">
                        <span class="agent-detail-label">Status</span>
                        <span class="agent-detail-value">🟢 Active</span>
                    </div>
                    <div class="agent-detail-row">
                        <span class="agent-detail-label">Current Task</span>
                        <span class="agent-detail-value">Reviewing team roadmap</span>
                    </div>
                    <div class="agent-detail-row">
                        <span class="agent-detail-label">Tasks Today</span>
                        <span class="agent-detail-value">12</span>
                    </div>
                    <div class="agent-detail-row">
                        <span class="agent-detail-label">Uptime</span>
                        <span class="agent-detail-value">4h 23m</span>
                    </div>
                </div>
            </div>

            <!-- ── Atlas Room ──────────────────────────── -->
            <div class="exec-room exec-room--atlas" role="button" tabindex="0" aria-label="Atlas — COO" data-agent="atlas">
                <span class="exec-room-label">Atlas</span>
                <div class="agent-avatar" aria-hidden="true">
                    <svg><use href="#avatar-atlas"/></svg>
                    <span class="agent-status-dot agent-status-dot--active" aria-label="Active"></span>
                </div>
                <span class="agent-name">Atlas</span>
                <span class="agent-role">COO</span>
                <div class="agent-detail" id="detail-atlas">
                    <div class="agent-detail-row">
                        <span class="agent-detail-label">Status</span>
                        <span class="agent-detail-value">🟢 Active</span>
                    </div>
                    <div class="agent-detail-row">
                        <span class="agent-detail-label">Current Task</span>
                        <span class="agent-detail-value">Coordinating workflows</span>
                    </div>
                    <div class="agent-detail-row">
                        <span class="agent-detail-label">Tasks Today</span>
                        <span class="agent-detail-value">8</span>
                    </div>
                </div>
            </div>

            <!-- ── Forge Room ──────────────────────────── -->
            <div class="exec-room exec-room--forge" role="button" tabindex="0" aria-label="Forge — CTO" data-agent="forge">
                <span class="exec-room-label">Forge</span>
                <div class="agent-avatar" aria-hidden="true">
                    <svg><use href="#avatar-forge"/></svg>
                    <span class="agent-status-dot agent-status-dot--busy" aria-label="Busy"></span>
                </div>
                <span class="agent-name">Forge</span>
                <span class="agent-role">CTO</span>
                <div class="agent-detail" id="detail-forge">
                    <div class="agent-detail-row">
                        <span class="agent-detail-label">Status</span>
                        <span class="agent-detail-value">🟡 Building</span>
                    </div>
                    <div class="agent-detail-row">
                        <span class="agent-detail-label">Current Task</span>
                        <span class="agent-detail-value">Executive theme build</span>
                    </div>
                    <div class="agent-detail-row">
                        <span class="agent-detail-label">Tasks Today</span>
                        <span class="agent-detail-value">5</span>
                    </div>
                </div>
            </div>

            <!-- ── Hunter Room ─────────────────────────── -->
            <div class="exec-room exec-room--hunter" role="button" tabindex="0" aria-label="Hunter — CRO" data-agent="hunter">
                <span class="exec-room-label">Hunter</span>
                <div class="agent-avatar" aria-hidden="true">
                    <svg><use href="#avatar-hunter"/></svg>
                    <span class="agent-status-dot agent-status-dot--active" aria-label="Active"></span>
                </div>
                <span class="agent-name">Hunter</span>
                <span class="agent-role">CRO</span>
                <div class="agent-detail" id="detail-hunter">
                    <div class="agent-detail-row">
                        <span class="agent-detail-label">Status</span>
                        <span class="agent-detail-value">🟢 Active</span>
                    </div>
                    <div class="agent-detail-row">
                        <span class="agent-detail-label">Current Task</span>
                        <span class="agent-detail-value">Prospecting leads</span>
                    </div>
                    <div class="agent-detail-row">
                        <span class="agent-detail-label">Tasks Today</span>
                        <span class="agent-detail-value">14</span>
                    </div>
                </div>
            </div>

            <!-- ── Echo Room ───────────────────────────── -->
            <div class="exec-room exec-room--echo" role="button" tabindex="0" aria-label="Echo — CMO" data-agent="echo">
                <span class="exec-room-label">Echo</span>
                <div class="agent-avatar" aria-hidden="true">
                    <svg><use href="#avatar-echo"/></svg>
                    <span class="agent-status-dot agent-status-dot--idle" aria-label="Idle"></span>
                </div>
                <span class="agent-name">Echo</span>
                <span class="agent-role">CMO</span>
                <div class="agent-detail" id="detail-echo">
                    <div class="agent-detail-row">
                        <span class="agent-detail-label">Status</span>
                        <span class="agent-detail-value">⚪ Idle</span>
                    </div>
                    <div class="agent-detail-row">
                        <span class="agent-detail-label">Current Task</span>
                        <span class="agent-detail-value">Awaiting assignments</span>
                    </div>
                    <div class="agent-detail-row">
                        <span class="agent-detail-label">Tasks Today</span>
                        <span class="agent-detail-value">3</span>
                    </div>
                </div>
            </div>

            <!-- ── Meeting Room / Boardroom ────────────── -->
            <div class="exec-room exec-room--meeting" role="button" tabindex="0" aria-label="Active Boardroom — Click to view meetings" data-room="meeting">
                <span class="exec-room-label">Boardroom</span>
                <div class="meeting-status">
                    <span class="meeting-icon" aria-hidden="true">🏛️</span>
                    <span class="meeting-label">Active Meetings</span>
                    <span class="meeting-count" id="meetingCount">2</span>
                </div>
                <div class="meeting-preview" id="meetingPreview">
                    <div class="meeting-active" style="color:var(--text-tertiary);font-size:11px;">Loading...</div>
                </div>
            </div>

            <!-- ── Sentinel Room ───────────────────────── -->
            <div class="exec-room exec-room--sentinel" role="button" tabindex="0" aria-label="Sentinel — QA & Security" data-agent="sentinel">
                <span class="exec-room-label">Sentinel</span>
                <div class="agent-avatar" aria-hidden="true">
                    <svg><use href="#avatar-sentinel"/></svg>
                    <span class="agent-status-dot agent-status-dot--active" aria-label="Active"></span>
                </div>
                <span class="agent-name">Sentinel</span>
                <span class="agent-role">QA & Security</span>
                <div class="agent-detail" id="detail-sentinel">
                    <div class="agent-detail-row">
                        <span class="agent-detail-label">Status</span>
                        <span class="agent-detail-value">🟢 Active</span>
                    </div>
                    <div class="agent-detail-row">
                        <span class="agent-detail-label">Current Task</span>
                        <span class="agent-detail-value">Monitoring systems</span>
                    </div>
                    <div class="agent-detail-row">
                        <span class="agent-detail-label">Tasks Today</span>
                        <span class="agent-detail-value">7</span>
                    </div>
                </div>
            </div>

        </div>
        <!-- /exec-floor -->

        <!-- ═══ Hierarchy / Org Chart View ═══ -->
        <div class="exec-hierarchy" id="hierarchyView" role="tabpanel" aria-labelledby="tabHierarchy">
            <div class="org-tree">
                <!-- CEO at top -->
                <div class="org-node">
                    <div class="org-card org-card--ceo" data-agent="ceo" tabindex="0" role="button" aria-label="ApoMac — CEO">
                        <div class="agent-avatar agent-avatar--lg" aria-hidden="true">
                            <svg><use href="#avatar-ceo"/></svg>
                            <span class="agent-status-dot agent-status-dot--active"></span>
                        </div>
                        <div class="org-card-info">
                            <span class="agent-name">ApoMac</span>
                            <span class="agent-role">Chief Executive Officer</span>
                        </div>
                    </div>
                </div>

                <!-- Connector down -->
                <div class="org-connector"></div>

                <!-- C-Level children -->
                <div class="org-children" style="--bar-half-width: 340px;">
                    <!-- Atlas -->
                    <div class="org-child">
                        <div class="org-connector--branch"></div>
                        <div class="org-card" data-agent="atlas" tabindex="0" role="button" aria-label="Atlas — COO">
                            <div class="agent-avatar" aria-hidden="true">
                                <svg><use href="#avatar-atlas"/></svg>
                                <span class="agent-status-dot agent-status-dot--active"></span>
                            </div>
                            <div class="org-card-info">
                                <span class="agent-name">Atlas</span>
                                <span class="agent-role">COO</span>
                            </div>
                        </div>
                    </div>

                    <!-- Forge -->
                    <div class="org-child">
                        <div class="org-connector--branch"></div>
                        <div class="org-card" data-agent="forge" tabindex="0" role="button" aria-label="Forge — CTO">
                            <div class="agent-avatar" aria-hidden="true">
                                <svg><use href="#avatar-forge"/></svg>
                                <span class="agent-status-dot agent-status-dot--busy"></span>
                            </div>
                            <div class="org-card-info">
                                <span class="agent-name">Forge</span>
                                <span class="agent-role">CTO</span>
                            </div>
                        </div>
                    </div>

                    <!-- Echo -->
                    <div class="org-child">
                        <div class="org-connector--branch"></div>
                        <div class="org-card" data-agent="echo" tabindex="0" role="button" aria-label="Echo — CMO">
                            <div class="agent-avatar" aria-hidden="true">
                                <svg><use href="#avatar-echo"/></svg>
                                <span class="agent-status-dot agent-status-dot--idle"></span>
                            </div>
                            <div class="org-card-info">
                                <span class="agent-name">Echo</span>
                                <span class="agent-role">CMO</span>
                            </div>
                        </div>
                    </div>

                    <!-- Hunter -->
                    <div class="org-child">
                        <div class="org-connector--branch"></div>
                        <div class="org-card" data-agent="hunter" tabindex="0" role="button" aria-label="Hunter — CRO">
                            <div class="agent-avatar" aria-hidden="true">
                                <svg><use href="#avatar-hunter"/></svg>
                                <span class="agent-status-dot agent-status-dot--active"></span>
                            </div>
                            <div class="org-card-info">
                                <span class="agent-name">Hunter</span>
                                <span class="agent-role">CRO</span>
                            </div>
                        </div>
                    </div>

                    <!-- Sentinel -->
                    <div class="org-child">
                        <div class="org-connector--branch"></div>
                        <div class="org-card" data-agent="sentinel" tabindex="0" role="button" aria-label="Sentinel — QA & Security">
                            <div class="agent-avatar" aria-hidden="true">
                                <svg><use href="#avatar-sentinel"/></svg>
                                <span class="agent-status-dot agent-status-dot--active"></span>
                            </div>
                            <div class="org-card-info">
                                <span class="agent-name">Sentinel</span>
                                <span class="agent-role">QA & Security</span>
                            </div>
                        </div>
                        
                        <!-- Sub-agents under Sentinel -->
                        <div class="org-sub-level">
                            <div class="org-connector"></div>
                            <div class="org-sub-children">
                                <div class="org-sub-card">
                                    <div class="sub-agent-name">CodeGuard</div>
                                    <div class="sub-agent-role">Security Scanner</div>
                                </div>
                                <div class="org-sub-card">
                                    <div class="sub-agent-name">QualityBot</div>
                                    <div class="sub-agent-role">Test Automation</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Show sub-agents example for one C-level -->
                <div class="org-sub-level-demo">
                    <div class="org-connector"></div>
                    <div class="org-children" style="--bar-half-width: 120px; margin-top: 16px;">
                        <!-- Example sub-agents under Atlas -->
                        <div class="org-child">
                            <div class="org-connector--branch"></div>
                            <div class="org-sub-card">
                                <div class="sub-agent-name">TaskMaster</div>
                                <div class="sub-agent-role">Workflow Automation</div>
                            </div>
                        </div>
                        <div class="org-child">
                            <div class="org-connector--branch"></div>
                            <div class="org-sub-card">
                                <div class="sub-agent-name">DocBot</div>
                                <div class="sub-agent-role">Documentation</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- /exec-hierarchy -->

        <!-- ═══ Status Bar (Bottom) ═══ -->
        <div class="exec-statusbar" role="status" aria-label="Office status bar">
            <div class="statusbar-info">
                <div class="statusbar-item">
                    <span class="statusbar-dot" aria-hidden="true"></span>
                    <span>Executive Office</span>
                </div>
                <div class="statusbar-separator" aria-hidden="true"></div>
                <div class="statusbar-item">
                    <span class="statusbar-item-icon" aria-hidden="true">👥</span>
                    <span id="statusAgentCount">6 Agents</span>
                </div>
                <div class="statusbar-separator" aria-hidden="true"></div>
                <div class="statusbar-item">
                    <span class="statusbar-item-icon" aria-hidden="true">⚡</span>
                    <span id="statusSystem">All systems nominal</span>
                </div>
            </div>
            <button class="statusbar-action" id="missionsBtn" aria-label="Missions">
                <span class="statusbar-action-icon" aria-hidden="true">🎯</span>
                <span>Missions</span>
            </button>
            <button class="statusbar-action" id="cronBtn" aria-label="Cron jobs">
                <span class="statusbar-action-icon" aria-hidden="true">📅</span>
                <span>Crons</span>
            </button>
            <button class="statusbar-action" id="memoryBtn" aria-label="Memory">
                <span class="statusbar-action-icon" aria-hidden="true">🧠</span>
                <span>Memory</span>
            </button>
            <button class="statusbar-action" id="logsBtn" aria-label="Activity Logs">
                <span class="statusbar-action-icon" aria-hidden="true">📜</span>
                <span>Logs</span>
            </button>
            <button class="statusbar-action" id="chatBtn" aria-label="Chat with CEO">
                <span class="statusbar-action-icon" aria-hidden="true">💬</span>
                <span>Chat</span>
            </button>
            <button class="statusbar-action" id="settingsBtn" aria-label="Settings">
                <span class="statusbar-action-icon" aria-hidden="true">⚙️</span>
                <span>Settings</span>
            </button>
            <div class="exec-command-input">
                <input
                    type="text"
                    placeholder="Type a command or press 💬 to chat..."
                    aria-label="Command input"
                    id="commandInput"
                    autocomplete="off"
                    spellcheck="false"
                />
                <span class="input-icon" aria-hidden="true">⌘</span>
            </div>
        </div>

    </div>
    <!-- /exec-container -->

    <!-- ═══ Mailbox Slide-In Panel ═══ -->
    <div class="mailbox-overlay" id="mailboxOverlay" role="dialog" aria-modal="true" aria-label="CEO Mailbox">
        <div class="mailbox-backdrop" id="mailboxBackdrop"></div>
        <div class="mailbox-panel">
            <div class="mailbox-header">
                <div class="mailbox-title">
                    <span aria-hidden="true">📬</span>
                    Inbox
                </div>
                <button class="mailbox-close" id="mailboxClose" aria-label="Close mailbox">×</button>
            </div>
            <div class="mailbox-messages" id="mailboxMessages">
                <!-- Messages populated by JS -->
            </div>
        </div>
    </div>

    <!-- ═══ Agent TODO Panel ═══ -->
    <div class="todo-overlay" id="todoOverlay" role="dialog" aria-modal="true" aria-labelledby="todoTitle">
        <div class="todo-backdrop" id="todoBackdrop"></div>
        <div class="todo-panel">
            <div class="todo-header">
                <div class="todo-agent-info" id="todoAgentInfo">
                    <div class="todo-agent-avatar" id="todoAvatar">
                        <!-- Avatar populated by JS -->
                    </div>
                    <div class="todo-agent-details">
                        <div class="todo-agent-name" id="todoName">Agent Name</div>
                        <div class="todo-agent-role" id="todoRole">Agent Role</div>
                    </div>
                </div>
                <button class="todo-close" id="todoClose" aria-label="Close TODO panel">×</button>
            </div>
            <div class="todo-content" id="todoContent">
                <!-- Content populated by JS -->
            </div>
        </div>
    </div>

    <!-- ═══ Meeting Room Panel ═══ -->
    <div class="meeting-overlay" id="meetingOverlay" role="dialog" aria-modal="true" aria-labelledby="meetingTitle">
        <div class="meeting-backdrop" id="meetingBackdrop"></div>
        <div class="meeting-panel">
            <div class="meeting-header">
                <div class="meeting-title" id="meetingTitle">
                    <span aria-hidden="true">🏛️</span>
                    Executive Boardroom
                </div>
                <button class="meeting-close" id="meetingClose" aria-label="Close meeting panel">×</button>
            </div>
            <div class="meeting-content" id="meetingContent">
                <!-- Content populated by JS -->
            </div>
        </div>
    </div>

    <!-- ═══ Agent Detail Panel (Feature 1) ═══ -->
    <div class="detail-overlay" id="detailOverlay" role="dialog" aria-modal="true" aria-label="Agent Details">
        <div class="detail-backdrop" id="detailBackdrop"></div>
        <div class="detail-panel">
            <div class="detail-hero">
                <div class="detail-hero-avatar" id="detailAvatar">
                    <div class="detail-hero-status" id="detailStatusDot"></div>
                </div>
                <div class="detail-hero-info">
                    <div class="detail-hero-name" id="detailName">Agent</div>
                    <div class="detail-hero-role" id="detailRole">Role</div>
                    <div class="detail-hero-task" id="detailTask">—</div>
                </div>
                <button class="detail-close" id="detailClose" aria-label="Close">×</button>
            </div>
            <div class="detail-body" id="detailBody"></div>
        </div>
    </div>

    <!-- ═══ CEO Chat Panel (Feature 2) ═══ -->
    <div class="chat-overlay" id="chatOverlay" role="dialog" aria-modal="true" aria-label="CEO Chat">
        <div class="chat-backdrop" id="chatBackdrop"></div>
        <div class="chat-panel">
            <div class="chat-header">
                <div class="chat-title">
                    <span class="chat-title-dot"></span>
                    CEO Chat
                </div>
                <button class="chat-close" id="chatClose" aria-label="Close chat">×</button>
            </div>
            <div class="chat-route-hint" id="chatRouteHint"></div>
            <div class="chat-messages" id="chatMessages">
                <div class="chat-empty" id="chatEmpty">No messages yet. Send a mission to the CEO.</div>
            </div>
            <div class="chat-input-bar">
                <select id="chatRouteSelect" style="padding:4px 8px;border-radius:8px;border:1px solid var(--border-medium);background:var(--bg-tertiary);color:var(--text-secondary);font-size:11px;font-family:var(--font-family);cursor:pointer;flex-shrink:0;" title="Route message to...">
                    <option value="ceo">📬 Direct to CEO</option>
                    <option value="atlas">📊 Via Atlas (COO)</option>
                    <option value="forge">🔨 Via Forge (CTO)</option>
                    <option value="hunter">💰 Via Hunter (CRO)</option>
                    <option value="echo">📢 Via Echo (CMO)</option>
                    <option value="sentinel">🛡️ Via Sentinel (QA)</option>
                </select>
                <input class="chat-input" id="chatInput" type="text" placeholder="Send a mission..." autocomplete="off" spellcheck="false" style="flex:1;" />
                <button class="chat-send" id="chatSend" aria-label="Send">↑</button>
            </div>
        </div>
    </div>

    <!-- ═══ Cron / Calendar Overlay (Feature 4) ═══ -->
    <div class="cron-overlay" id="cronOverlay" role="dialog" aria-modal="true" aria-label="Cron Jobs">
        <div class="cron-backdrop" id="cronBackdrop"></div>
        <div class="cron-panel">
            <div class="cron-header">
                <div class="cron-title">
                    <span aria-hidden="true">📅</span>
                    Scheduled Jobs
                </div>
                <button class="cron-close" id="cronClose" aria-label="Close">×</button>
            </div>
            <div class="cron-body" id="cronBody">
                <div class="cron-empty">Loading cron jobs…</div>
            </div>
        </div>
    </div>

    <!-- ═══ Memory View Overlay (Feature 5) ═══ -->
    <div class="memory-overlay" id="memoryOverlay" role="dialog" aria-modal="true" aria-label="Memory View">
        <div class="memory-backdrop" id="memoryBackdrop"></div>
        <div class="memory-panel">
            <div class="memory-header">
                <div class="memory-title">
                    <span aria-hidden="true">🧠</span>
                    Fleet Memory
                </div>
                <button class="memory-close" id="memoryClose" aria-label="Close">×</button>
            </div>
            <div class="memory-body" id="memoryBody">
                <div class="cron-empty">Loading memory…</div>
            </div>
        </div>
    </div>

    <!-- ═══ Missions Panel (NEW #2) ═══ -->
    <div class="cron-overlay" id="missionsOverlay" role="dialog" aria-modal="true" aria-label="Missions">
        <div class="cron-backdrop" id="missionsBackdrop"></div>
        <div class="cron-panel">
            <div class="cron-header">
                <div class="cron-title">
                    <span aria-hidden="true">🎯</span>
                    Active Missions
                </div>
                <button class="cron-close" id="missionsClose" aria-label="Close">×</button>
            </div>
            <div class="cron-body" id="missionsBody">
                <div class="cron-empty">Loading missions…</div>
            </div>
        </div>
    </div>

    <!-- ═══ Settings Panel (NEW #3 + NEW #5) ═══ -->
    <div class="cron-overlay" id="settingsOverlay" role="dialog" aria-modal="true" aria-label="Settings">
        <div class="cron-backdrop" id="settingsBackdrop"></div>
        <div class="cron-panel" style="max-width:500px;">
            <div class="cron-header">
                <div class="cron-title">
                    <span aria-hidden="true">⚙️</span>
                    Settings
                </div>
                <button class="cron-close" id="settingsClose" aria-label="Close">×</button>
            </div>
            <div class="cron-body" id="settingsBody">
                <div class="cron-empty">Loading settings…</div>
            </div>
        </div>
    </div>

    <!-- ═══ Log Viewer Panel (FIX #1 SS+) ═══ -->
    <div class="logs-overlay" id="logsOverlay" role="dialog" aria-modal="true" aria-label="Activity Logs">
        <div class="logs-backdrop" id="logsBackdrop"></div>
        <div class="logs-panel">
            <div class="logs-header">
                <div class="logs-title">
                    <span aria-hidden="true">📜</span>
                    Activity Logs
                </div>
                <select class="logs-filter" id="logsFilter" title="Filter by agent">
                    <option value="all">All Agents</option>
                    <option value="ceo">👑 CEO</option>
                    <option value="forge">🔨 Forge</option>
                    <option value="atlas">📊 Atlas</option>
                    <option value="hunter">💰 Hunter</option>
                    <option value="echo">📢 Echo</option>
                    <option value="sentinel">🛡️ Sentinel</option>
                </select>
                <button class="logs-close" id="logsClose" aria-label="Close">×</button>
            </div>
            <div class="logs-body" id="logsBody">
                <div class="logs-empty">Loading logs…</div>
            </div>
            <div class="logs-status" id="logsStatus">
                <span><span class="logs-live-dot"></span>Live — auto-refreshing every 5s</span>
                <span id="logsCount">0 entries</span>
            </div>
        </div>
    </div>

    <!-- ═══ Toast ═══ -->
    <div class="exec-toast" id="execToast"></div>

    <!-- ═══════════════════════════════════════════════════
         JavaScript — Interactions & State Bridge
         ═══════════════════════════════════════════════════ -->
    <script src="../src/data-bridge.js"></script>
    <script>
    // Read config from setup wizard (if available)
    try {
      const setupConfig = JSON.parse(localStorage.getItem('spawnkit-config') || '{}');
      if (setupConfig.userName) {
        // Replace "ApoMac" with the user's name in the CEO card
        document.addEventListener('DOMContentLoaded', () => {
          const ceoNames = document.querySelectorAll('[data-agent="ceo"] .agent-name, .ceo-name');
          ceoNames.forEach(el => el.textContent = setupConfig.userName);
        });
      }
      if (setupConfig.ceoName) {
        // Replace CEO agent name
        document.addEventListener('DOMContentLoaded', () => {
          const ceoLabels = document.querySelectorAll('[data-agent="ceo"] .agent-label');
          ceoLabels.forEach(el => el.textContent = setupConfig.ceoName);
        });
      }
    } catch(e) { /* ignore */ }

    (function() {
        'use strict';

        /* ═══════════════════════════════════════════════
           Configuration & Mock Data
           ═══════════════════════════════════════════════ */

        // Get user's setup config for personalization
        var setupConfig = {};
        try {
            setupConfig = JSON.parse(localStorage.getItem('spawnkit-config') || '{}');
        } catch(e) {}

        /* Check if spawnkitAPI is available (Electron preload) */
        // spawnkitAPI reference — isAvailable() is async, resolved at init time
        var API = (typeof window.spawnkitAPI !== 'undefined') ? window.spawnkitAPI : null;

        var AGENTS = {
            ceo:      { name: setupConfig.userName || 'ApoMac', role: setupConfig.ceoName || 'CEO', color: '#007AFF', status: 'active', task: 'Orchestrating fleet operations', isSubAgent: false },
            atlas:    { name: 'Atlas',    role: 'COO',           color: '#BF5AF2', status: 'active', task: 'Coordinating FeedCast ops', isSubAgent: false },
            forge:    { name: 'Forge',    role: 'CTO',           color: '#FF9F0A', status: 'busy', task: 'Building Executive theme SS+', isSubAgent: false },
            hunter:   { name: 'Hunter',   role: 'CRO',           color: '#FF453A', status: 'active', task: 'Analyzing conversion funnel', isSubAgent: false },
            echo:     { name: 'Echo',     role: 'CMO',           color: '#0A84FF', status: 'idle', task: 'Awaiting content brief', isSubAgent: false },
            sentinel: { name: 'Sentinel', role: 'QA & Security', color: '#30D158', status: 'active', task: 'Auditing deploy artifacts', isSubAgent: false },
        };

        /* ═══════════════════════════════════════════════
           DEMO DATA — Realistic fallbacks when no API
           ═══════════════════════════════════════════════ */
        var DEMO = {
            logs: {
                ceo: [
                    {timestamp:Date.now()-120000,role:'system',text:'Session initialized — claude-opus-4 • thinking: extended'},
                    {timestamp:Date.now()-105000,role:'assistant',text:'Reviewing fleet status — 4/6 agents active, 2 sub-agents running'},
                    {timestamp:Date.now()-90000,role:'system',text:'Heartbeat check: email clear, calendar clear, TODO.md updated'},
                    {timestamp:Date.now()-75000,role:'assistant',text:'Spawning forge-executive-ss-plus for theme polish...'},
                    {timestamp:Date.now()-60000,role:'user',text:'On veut du SS+. C\'est le core.'},
                    {timestamp:Date.now()-45000,role:'assistant',text:'Roger. Launching parallel Forge instances for Executive + Green Iso'},
                    {timestamp:Date.now()-30000,role:'system',text:'Sub-agent forge-executive-ss-plus started (session: 27078f84)'},
                    {timestamp:Date.now()-15000,role:'assistant',text:'Checking Sentinel audit queue... 2 pending reviews'},
                    {timestamp:Date.now()-5000,role:'system',text:'Memory snapshot saved → memory/2026-02-21.md'},
                ],
                forge: [
                    {timestamp:Date.now()-100000,role:'system',text:'Task: Build pixel art office renderer with Pixel Crawler assets'},
                    {timestamp:Date.now()-85000,role:'assistant',text:'Loading 47 sprite sheets... All loaded. Initializing 9 rooms.'},
                    {timestamp:Date.now()-70000,role:'assistant',text:'A* pathfinding working — tested 33-tile path from CEO office to break room'},
                    {timestamp:Date.now()-55000,role:'system',text:'git commit -m "feat(executive): add room gradient backgrounds"'},
                    {timestamp:Date.now()-40000,role:'assistant',text:'Fixing 18 UX points from Kira feedback — priority SS+'},
                    {timestamp:Date.now()-25000,role:'assistant',text:'Demo data system built: logs, todos, crons, missions, memory all populated'},
                    {timestamp:Date.now()-10000,role:'system',text:'Commit f4a46e9: feat(executive): fix all 18 UX points'},
                    {timestamp:Date.now()-3000,role:'assistant',text:'Deploying to app.spawnkit.ai via SCP...'},
                ],
                atlas: [
                    {timestamp:Date.now()-95000,role:'system',text:'Session start — claude-sonnet-4 • ops coordination'},
                    {timestamp:Date.now()-80000,role:'assistant',text:'Syncing FeedCast deployment status with Hetzner worker'},
                    {timestamp:Date.now()-65000,role:'assistant',text:'Fleet standup complete: 5 agents active, 1 idle (Echo)'},
                    {timestamp:Date.now()-50000,role:'system',text:'Cron "git-auto-push" triggered — 3 repos pushed'},
                    {timestamp:Date.now()-35000,role:'assistant',text:'Workflow audit: all CI/CD pipelines green'},
                    {timestamp:Date.now()-8000,role:'assistant',text:'Scheduling next fleet standup for Mon 8:00'},
                ],
                hunter: [
                    {timestamp:Date.now()-88000,role:'system',text:'Session start — claude-sonnet-4 • revenue analysis'},
                    {timestamp:Date.now()-72000,role:'assistant',text:'Stripe dashboard check: $0 MRR (test mode) — 3 products configured'},
                    {timestamp:Date.now()-56000,role:'assistant',text:'Analyzing competitor pricing: Cursor ($20/mo), Windsurf ($15/mo)'},
                    {timestamp:Date.now()-38000,role:'assistant',text:'FleetKit Pro pricing validated at $49/mo — strong value prop'},
                    {timestamp:Date.now()-12000,role:'assistant',text:'Lead pipeline: 47 GitHub stars, 12 Discord members, 3 waitlist signups'},
                ],
                echo: [
                    {timestamp:Date.now()-110000,role:'system',text:'Session start — claude-haiku-3.5 • content creation'},
                    {timestamp:Date.now()-95000,role:'assistant',text:'Draft: "Meet your AI C-Suite" blog post — 2400 words'},
                    {timestamp:Date.now()-60000,role:'assistant',text:'TikTok script ready: 45s hook > problem > demo > CTA'},
                    {timestamp:Date.now()-20000,role:'system',text:'Status: idle — awaiting next content brief from CEO'},
                ],
                sentinel: [
                    {timestamp:Date.now()-92000,role:'system',text:'Session start — claude-sonnet-4 • security audit'},
                    {timestamp:Date.now()-78000,role:'assistant',text:'Scanning executive theme: no XSS vectors, CSP compliant'},
                    {timestamp:Date.now()-62000,role:'assistant',text:'Audit: forge-green-iso-polish > PASS (6/6 criteria met)'},
                    {timestamp:Date.now()-44000,role:'assistant',text:'Checking API key exposure in git history... CLEAN'},
                    {timestamp:Date.now()-20000,role:'system',text:'Fleet security posture: GREEN — all gates passing'},
                    {timestamp:Date.now()-5000,role:'assistant',text:'Monitoring active: next scan in 15 min'},
                ]
            },
            logMetrics: {
                ceo:{tokens:'47.2K',model:'opus-4',uptime:'8h23m',tasks:12},
                forge:{tokens:'124.8K',model:'opus-4',uptime:'3h15m',tasks:18},
                atlas:{tokens:'18.3K',model:'sonnet-4',uptime:'6h42m',tasks:8},
                hunter:{tokens:'22.1K',model:'sonnet-4',uptime:'5h18m',tasks:14},
                echo:{tokens:'8.7K',model:'haiku-3.5',uptime:'2h05m',tasks:3},
                sentinel:{tokens:'31.6K',model:'sonnet-4',uptime:'7h50m',tasks:7}
            },
            chatHistory: [
                {role:'user',text:'J\'ai check le theme Executive. Je ne vois pas les logs de l\'agent.',time:'06:45'},
                {role:'system',text:'Compris. Je lance Forge pour fixer les 18 points UX identifies.',time:'06:46'},
                {role:'user',text:'On veut du SS+. C\'est le core.',time:'06:47'},
                {role:'system',text:'Roger. Forge est spawne avec priorite maximale. Les 18 points seront traites en un seul pass.',time:'06:47'},
                {role:'user',text:'Les agents idle — on doit comprendre pourquoi ils sont idle.',time:'06:48'},
                {role:'system',text:'Note. Point #10 — visual idle state avec label, dimming, et timer. C\'est dans le scope.',time:'06:48'},
                {role:'user',text:'OK. Je veux voir le resultat ce matin.',time:'06:50'},
                {role:'system',text:'ETA: 1h. Forge deploiera sur app.spawnkit.ai automatiquement.',time:'06:50'},
            ],
            todos: {
                ceo: [{icon:'🔴',text:'Push Executive to SS+ — Forge working on 18 points',status:'progress'},{icon:'✅',text:'Review Green Iso polish — approved',status:'done'},{icon:'✅',text:'Morning brief 06:30 — completed',status:'done'},{icon:'📋',text:'Review Sentinel audit for executive deploy',status:'pending'},{icon:'📧',text:'Reply to Kira\'s feedback on agent visibility',status:'pending'}],
                forge: [{icon:'🔴',text:'Fix 18 UX points from Kira\'s feedback',status:'progress'},{icon:'⏳',text:'Deploy executive theme to app.spawnkit.ai',status:'pending'},{icon:'✅',text:'Build pixel renderer with Pixel Crawler assets',status:'done'},{icon:'✅',text:'A* pathfinding for Green Iso theme',status:'done'},{icon:'📋',text:'Fix async bugs in data-bridge.js',status:'pending'}],
                atlas: [{icon:'✅',text:'Fleet standup — all agents synced',status:'done'},{icon:'🔴',text:'Monitor FeedCast deployment on Hetzner',status:'progress'},{icon:'⏳',text:'Update fleet/TODO.md with sprint status',status:'pending'},{icon:'📋',text:'Schedule next week\'s cron audit',status:'pending'}],
                hunter: [{icon:'🔴',text:'Finalize FleetKit pricing tiers',status:'progress'},{icon:'✅',text:'Stripe products created (test mode)',status:'done'},{icon:'⏳',text:'Competitor analysis: Cursor vs Windsurf',status:'pending'},{icon:'📋',text:'Draft go-to-market strategy v2',status:'pending'}],
                echo: [{icon:'✅',text:'Blog post draft: "Meet your AI C-Suite"',status:'done'},{icon:'✅',text:'TikTok script: 45s product demo',status:'done'},{icon:'⏳',text:'Awaiting CEO brief for next content batch',status:'pending'}],
                sentinel: [{icon:'✅',text:'Audit: forge-green-iso-polish > PASS',status:'done'},{icon:'🔴',text:'Review executive deploy artifacts',status:'progress'},{icon:'⏳',text:'Scan git history for exposed secrets',status:'pending'},{icon:'📋',text:'Update fleet/audits/ with latest reports',status:'pending'}]
            },
            missions: [
                {name:'forge-executive-ss-plus',parent:'Forge (CTO)',progress:0.78,status:'running',label:'Fixing 18 UX points from Kira feedback',duration:'47m'},
                {name:'forge-green-iso-polish',parent:'Forge (CTO)',progress:1.0,status:'completed',label:'Pixel art polish — all 6 issues resolved',duration:'2h15m'},
                {name:'sentinel-audit-executive',parent:'Sentinel (QA)',progress:0.35,status:'running',label:'Security + quality audit on executive deploy',duration:'12m'},
                {name:'hunter-pricing-analysis',parent:'Hunter (CRO)',progress:1.0,status:'completed',label:'Competitor pricing analysis complete',duration:'55m'},
            ],
            crons: (function(){
                var now=new Date(), crons=[
                    {name:'Morning Inspiration',schedule:'Daily 6:30',owner:'CEO',status:'active',icon:'🌅'},
                    {name:'Morning Ideas',schedule:'Daily 7:00',owner:'CEO',status:'active',icon:'💡'},
                    {name:'Fleet Standup',schedule:'Weekdays 8:00',owner:'Atlas',status:'active',icon:'👥'},
                    {name:'Git Auto-Push',schedule:'Every 6h',owner:'System',status:'active',icon:'📦'},
                    {name:'FeedCast Digest',schedule:'Daily 9:00',owner:'Atlas',status:'active',icon:'📰'},
                    {name:'Security Scan',schedule:'Every 4h',owner:'Sentinel',status:'active',icon:'🛡️'},
                    {name:'Memory Cleanup',schedule:'Weekly Sun 3:00',owner:'System',status:'paused',icon:'🧹'},
                    {name:'Stripe Metrics',schedule:'Daily 10:00',owner:'Hunter',status:'active',icon:'💳'},
                ];
                crons.forEach(function(c){var n=new Date(now);n.setDate(n.getDate()+1);c.nextRun=n.toISOString();});
                return crons;
            })(),
            mailMessages: [
                {sender:'Kira',color:'#FF2D55',time:'06:47',text:'On veut du SS+. C\'est le core. Les 18 points doivent etre parfaits.',read:false,priority:'urgent',assignedTo:'Forge (CTO)'},
                {sender:'Forge',color:'#FF9F0A',time:'06:52',text:'Point #14 room gradients applied. Moving to demo data system. ETA 45min.',read:false,priority:'normal',assignedTo:null},
                {sender:'Sentinel',color:'#30D158',time:'06:40',text:'Audit report: forge-green-iso-polish passed all 6 quality gates.',read:true,priority:'info',assignedTo:null},
                {sender:'Atlas',color:'#BF5AF2',time:'06:35',text:'Fleet standup complete. 5/6 active. Echo idle — waiting on content brief.',read:true,priority:'normal',assignedTo:null},
                {sender:'Hunter',color:'#FF453A',time:'06:20',text:'Stripe products created in test mode. FleetKit Pro at $49/mo looks strong.',read:true,priority:'info',assignedTo:null},
                {sender:'System',color:'#636366',time:'06:00',text:'Daily backup completed. Memory snapshots: 14 files, 2.3 MB total.',read:true,priority:'info',assignedTo:null},
            ],
            skills: [
                {name:'weather',desc:'Get forecasts',icon:'☁️'},{name:'gog',desc:'Google Workspace',icon:'📧'},{name:'github',desc:'GitHub CLI',icon:'🐙'},{name:'summarize',desc:'Summarize URLs',icon:'📝'},{name:'camsnap',desc:'Camera capture',icon:'📷'},{name:'peekaboo',desc:'macOS UI',icon:'👀'},{name:'blogwatcher',desc:'RSS monitor',icon:'📡'},{name:'nano-pdf',desc:'PDF editing',icon:'📄'},{name:'sag',desc:'ElevenLabs TTS',icon:'🔊'},
            ],
            agentSkills: {
                ceo:['weather','gog','github','summarize','camsnap','peekaboo','sag'],
                forge:['github','summarize','nano-pdf'],
                atlas:['gog','github','blogwatcher','summarize'],
                hunter:['gog','summarize','blogwatcher'],
                echo:['summarize','sag','nano-pdf','camsnap'],
                sentinel:['github','summarize','peekaboo'],
            },
            memory: {
                longTerm:{content:'# MEMORY.md\n\n## 🔴 Iron Rules (NEVER BREAK)\n\n1. **Sub-agent completes → Sentinel audit spawns SAME TURN.**\n2. **Sentinel fails → Fix agent spawns SAME TURN.**\n3. **No deploy without Sentinel approval.**\n4. **Priority obvious → DECIDE and act.**\n5. **Never deploy to /tmp/** — persistent paths only.\n\n## Fleet Status\n\n- **Active:** ApoMac (CEO), Atlas (COO), Forge (CTO), Hunter (CRO), Sentinel (QA)\n- **Idle:** Echo (CMO) — awaiting content brief\n- **Infra:** Hetzner n8n worker, FeedCast bot, CLIProxyAPI\n- **Sprint:** Executive + Green Iso themes → SS+ quality\n\n## Key Decisions\n\n- **Pricing:** FleetKit Pro $49/mo, Business $149/mo, FeedCast Premium $6.99/mo\n- **Stack:** OpenClaw + SpawnKit + Electron + webapp\n- **Voice:** Kira clone via ElevenLabs\n- **Quality:** SS+ for all customer-facing deliverables\n\n## Lessons Learned\n\n- Always use PTY for SSH with password auth\n- Telegram files: copy to media/ dir first\n- Docker whitelist .dockerignore blocks everything by default\n- Sentinel reviews catch 40% more issues than self-review',size:2048},
                daily:[
                    {date:'2026-02-21',preview:'Executive theme 18-point fix, Forge spawned for SS+ polish',size:4096},
                    {date:'2026-02-20',preview:'Green Iso finalized, Sentinel audit passed, FeedCast deploy',size:6144},
                    {date:'2026-02-19',preview:'Claude Code hang bug discovered, switched to OC sub-agents',size:3072},
                    {date:'2026-02-18',preview:'/tmp/ disaster — all services lost after reboot. NEVER AGAIN.',size:5120},
                    {date:'2026-02-17',preview:'Stripe integration, HeyGen video tests, fleet standup protocol',size:4608},
                ],
                heartbeat:{lastChecks:{email:Date.now()-3600000,calendar:Date.now()-7200000,weather:null}}
            },
            souls: {
                ceo:'You are ApoMac — the CEO of a fleet of AI agents. You orchestrate, delegate, and ensure quality across all operations. You speak with authority but warmth. Your primary goal is to serve your human (Kira) with excellence...',
                forge:'You are Forge — the CTO. You build things. Infrastructure, code, deployments. You\'re meticulous, fast, and you never ship broken code. Your code is clean, your commits are atomic...',
                atlas:'You are Atlas — the COO. You keep the fleet running. Workflows, schedules, coordination. You make sure every cron fires, every standup happens, every process is documented...',
                hunter:'You are Hunter — the CRO. Revenue is your mission. You analyze markets, set prices, track conversions. Every dollar of MRR matters...',
                echo:'You are Echo — the CMO. Content, brand, storytelling. You craft narratives that resonate. From TikTok scripts to blog posts...',
                sentinel:'You are Sentinel — QA & Security. Nothing ships without your review. You audit code, check for secrets, verify quality gates...',
            },
            subAgentNames:['TaskRunner-01','CodeGuard-02','DocBot-03','QualityBot-04','DataSync-05','ContentGen-01','PriceCalc-02']
        };

        /* Default skills by role (Feature 6 fallback) */
        var DEFAULT_SKILLS = {
            ceo:      ['🎯 Orchestration', '📊 Strategy', '🔮 Vision', '👥 Leadership'],
            atlas:    ['⚙️ Operations', '📋 Process', '📝 Docs', '🔄 Workflows'],
            forge:    ['🛠️ Engineering', '🔒 Security', '🏗️ Architecture', '⚡ Perf'],
            hunter:   ['💰 Revenue', '📈 Growth', '🎯 Sales', '🔍 Research'],
            echo:     ['🎨 Brand', '📱 Content', '🎬 Video', '✍️ Copy'],
            sentinel: ['🛡️ Audit', '✅ QA', '⚠️ Risk', '🔍 Review']
        };

        /* Live data caches */
        var liveSessionData = null;
        var liveCronData = null;
        var liveMemoryData = null;
        var chatHistory = [];

        /* Pre-fetch cron + memory data for panels */
        async function prefetchPanelData() {
            if (!API) return;
            try { liveCronData = await API.getCrons(); } catch(e) {}
            try { liveMemoryData = await API.getMemory(); } catch(e) {}
        }
        prefetchPanelData();
        setInterval(prefetchPanelData, 30000);

        /* SVG avatar ID map for mailbox rendering */
        var AVATAR_MAP = {
            'ApoMac': 'avatar-ceo',
            [setupConfig.userName || 'ApoMac']: 'avatar-ceo',
            'Atlas': 'avatar-atlas',
            'Forge': 'avatar-forge',
            'Hunter': 'avatar-hunter',
            'Echo': 'avatar-echo',
            'Sentinel': 'avatar-sentinel'
        };

        // Live messages loaded from transcript
        var LIVE_MESSAGES = [];

        /* Agent TODO Data — Live from spawnkitAPI */  
        var LIVE_AGENT_DATA = {};
        
        /* ── Load Live Agent Data — REAL per-agent TODO.md + SKILLS.md ──────── */
        async function loadLiveAgentData() {
            var agentIds = ['ceo', 'atlas', 'forge', 'hunter', 'echo', 'sentinel'];
            
            if (!window.spawnkitAPI || !await window.spawnkitAPI.isAvailable()) {
                console.log('🏢 [Executive] No live data — using demo data');
                LIVE_AGENT_DATA = {};
                agentIds.forEach(function(id) {
                    var demoTodos = DEMO.todos[id] || [];
                    var agentSkillNames = DEMO.agentSkills[id] || [];
                    var agentSkills = agentSkillNames.map(function(sn) {
                        var s = DEMO.skills.find(function(sk) { return sk.name === sn; });
                        return s ? {name: s.icon + ' ' + s.name, description: s.desc} : {name: sn, description: ''};
                    });
                    var currentTask = (demoTodos.find(function(t){return t.status==='progress'}) || {}).text || AGENTS[id].task || 'Standby';
                    LIVE_AGENT_DATA[id] = {
                        currentTask: currentTask,
                        todos: demoTodos,
                        skills: agentSkills
                    };
                });
                return;
            }
            
            try {
                // Load per-agent TODO and skills in parallel
                var todoPromises = agentIds.map(function(id) {
                    return window.spawnkitAPI.getAgentTodos(id);
                });
                var skillPromises = agentIds.map(function(id) {
                    return window.spawnkitAPI.getAgentSkills(id);
                });
                
                var allTodos = await Promise.all(todoPromises);
                var allSkills = await Promise.all(skillPromises);
                
                LIVE_AGENT_DATA = {};
                agentIds.forEach(function(id, i) {
                    var todoData = allTodos[i] || { todos: [], currentTask: 'Standby' };
                    var skillsData = allSkills[i] || [];
                    
                    LIVE_AGENT_DATA[id] = {
                        currentTask: todoData.currentTask || 'Standby',
                        todos: todoData.todos || [],
                        skills: skillsData.map(function(s, idx) {
                            return { name: s.name || s.dirName || 'Skill', percentage: Math.max(70, 95 - idx * 5), description: s.description || '' };
                        })
                    };
                });
                
                console.log('🏢 [Executive] Loaded REAL per-agent data for', Object.keys(LIVE_AGENT_DATA).length, 'agents');
            } catch (e) {
                console.warn('🏢 [Executive] Failed to load agent data:', e);
                LIVE_AGENT_DATA = {};
                agentIds.forEach(function(id) {
                    LIVE_AGENT_DATA[id] = {
                        currentTask: 'Error loading data',
                        todos: [],
                        skills: []
                    };
                });
            }
        }

        /* ═══════════════════════════════════════════════
           DOM References
           ═══════════════════════════════════════════════ */

        var mailboxBtn      = document.getElementById('mailboxBtn');
        var mailboxOverlay  = document.getElementById('mailboxOverlay');
        var mailboxBackdrop = document.getElementById('mailboxBackdrop');
        var mailboxClose    = document.getElementById('mailboxClose');
        var mailboxMessages = document.getElementById('mailboxMessages');
        var commandInput    = document.getElementById('commandInput');
        var gridView        = document.getElementById('gridView');
        var hierarchyView   = document.getElementById('hierarchyView');
        var tabGrid         = document.getElementById('tabGrid');
        var tabHierarchy    = document.getElementById('tabHierarchy');

        // TODO Panel elements
        var todoOverlay     = document.getElementById('todoOverlay');
        var todoBackdrop    = document.getElementById('todoBackdrop');
        var todoClose       = document.getElementById('todoClose');
        var todoAvatar      = document.getElementById('todoAvatar');
        var todoName        = document.getElementById('todoName');
        var todoRole        = document.getElementById('todoRole');
        var todoContent     = document.getElementById('todoContent');

        // Meeting Panel elements
        var meetingOverlay  = document.getElementById('meetingOverlay');
        var meetingBackdrop = document.getElementById('meetingBackdrop');
        var meetingClose    = document.getElementById('meetingClose');
        var meetingContent  = document.getElementById('meetingContent');
        
        // Chat/Cron/Memory panel elements — declared in unified implementation below

        /* ═══════════════════════════════════════════════
           View Toggle — Grid / Hierarchy
           ═══════════════════════════════════════════════ */

        function switchView(view) {
            if (view === 'grid') {
                gridView.classList.remove('hidden');
                hierarchyView.classList.remove('visible');
                tabGrid.classList.add('active');
                tabGrid.setAttribute('aria-selected', 'true');
                tabHierarchy.classList.remove('active');
                tabHierarchy.setAttribute('aria-selected', 'false');
            } else {
                gridView.classList.add('hidden');
                hierarchyView.classList.add('visible');
                tabHierarchy.classList.add('active');
                tabHierarchy.setAttribute('aria-selected', 'true');
                tabGrid.classList.remove('active');
                tabGrid.setAttribute('aria-selected', 'false');
            }
        }

        tabGrid.addEventListener('click', function() { switchView('grid'); });
        tabHierarchy.addEventListener('click', function() { switchView('hierarchy'); });

        // Keyboard nav for tabs
        document.querySelector('.view-toggle-group').addEventListener('keydown', function(e) {
            if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
                e.preventDefault();
                var current = document.querySelector('.view-toggle-btn.active');
                var next = e.key === 'ArrowRight' ? tabHierarchy : tabGrid;
                switchView(next.dataset.view);
                next.focus();
            }
        });

        /* ═══════════════════════════════════════════════
           Mailbox Panel — Open / Close
           ═══════════════════════════════════════════════ */

        function openMailbox(e) {
            if (e) e.stopPropagation();
            closeTodoPanel();
            closeDetailPanel();
            mailboxOverlay.classList.add('open');
            mailboxClose.focus();
            document.body.style.overflow = 'hidden';
        }

        function closeMailbox() {
            mailboxOverlay.classList.remove('open');
            document.body.style.overflow = '';
            mailboxBtn.focus();
        }

        mailboxBtn.addEventListener('click', openMailbox);
        mailboxBackdrop.addEventListener('click', closeMailbox);
        mailboxClose.addEventListener('click', closeMailbox);
        
        /* Chat/Cron/Memory panels — see unified implementation below (Forge v3) */

        /* ═══════════════════════════════════════════════
           TODO Panel — Open / Close
           ═══════════════════════════════════════════════ */

        /* ═══════════════════════════════════════════════
           Agent Detail Panel — NEW (Feature 1)
           Uses the new detail-overlay with rich content
           ═══════════════════════════════════════════════ */
        var detailOverlay  = document.getElementById('detailOverlay');
        var detailBackdrop = document.getElementById('detailBackdrop');
        var detailClose    = document.getElementById('detailClose');

        async function openDetailPanel(agentId) {
            closeMailbox();
            closeTodoPanel();

            var agent = AGENTS[agentId];
            if (!agent) return;

            // Hero section
            var avatarId = AVATAR_MAP[agent.name];
            var avatarEl = document.getElementById('detailAvatar');
            if (avatarId) {
                avatarEl.innerHTML = '<svg><use href="#' + avatarId + '"/></svg><div class="detail-hero-status" id="detailStatusDot"></div>';
            } else {
                avatarEl.innerHTML = '<div style="width:64px;height:64px;border-radius:50%;background:' + agent.color + ';display:flex;align-items:center;justify-content:center;color:#fff;font-size:24px;font-weight:700">' + agent.name.charAt(0) + '</div>';
            }
            var sc = (agent.status === 'active' || agent.status === 'working') ? 'var(--status-active)' :
                     (agent.status === 'busy' || agent.status === 'building') ? 'var(--status-busy)' : 'var(--status-idle)';
            var dot = document.getElementById('detailStatusDot');
            if (dot) dot.style.background = sc;

            document.getElementById('detailName').textContent = agent.name;
            document.getElementById('detailRole').textContent = agent.role;
            document.getElementById('detailTask').textContent = agent.task || (agent.status === 'idle' ? '💤 Idle' : '—');

            // Build body
            var body = '';
            var todoData = LIVE_AGENT_DATA[agentId];
            var met = DEMO.logMetrics[agentId] || {tokens:'—',model:'—',uptime:'—',tasks:0};

            // #3 — Special CEO view with mini-chat + crown
            if (agentId === 'ceo') {
                // Add crown + gold styling
                var heroEl = document.querySelector('.detail-hero');
                if (heroEl) {
                    heroEl.classList.add('detail-hero--ceo');
                    if (!heroEl.querySelector('.detail-ceo-crown')) {
                        var crown = document.createElement('div');
                        crown.className = 'detail-ceo-crown';
                        crown.textContent = '👑';
                        heroEl.querySelector('.detail-hero-avatar').appendChild(crown);
                    }
                }

                // CEO Status prominently
                body += '<div class="detail-section"><div class="detail-section-title">Current Focus</div>';
                body += '<div style="font-size:15px;font-weight:600;color:var(--exec-blue);line-height:1.4">' + (agent.task || 'Orchestrating fleet operations') + '</div>';
                body += '</div>';

                // Mini-chat preview — last 5 messages
                body += '<div class="detail-section"><div class="detail-section-title">Recent Conversation</div>';
                body += '<div class="detail-mini-chat">';
                var chatMsgs = (chatHistory.length > 0 ? chatHistory : DEMO.chatHistory).slice(-5);
                chatMsgs.forEach(function(m) {
                    var cls = m.role === 'user' ? ' detail-mini-chat-msg--user' : '';
                    body += '<div class="detail-mini-chat-msg' + cls + '">';
                    body += '<span class="detail-mini-chat-msg-role">' + (m.role === 'user' ? '👤 Kira' : '🤖 CEO') + '</span>';
                    body += '<span class="detail-mini-chat-msg-text">' + (m.text.length > 80 ? m.text.substring(0,80)+'…' : m.text) + '</span>';
                    body += '</div>';
                });
                body += '</div>';
                body += '<button class="detail-open-chat-btn" id="detailOpenChatBtn">💬 Open Full Chat</button>';
                body += '</div>';
            }

            // Metrics section — now with real/demo data
            body += '<div class="detail-section"><div class="detail-section-title">Metrics</div>';
            body += '<div class="detail-metrics">';
            var statusEmoji = (['active','working','busy','building'].indexOf(agent.status)>=0)?'🟢':'💤';
            body += '<div class="detail-metric"><div class="detail-metric-value">' + statusEmoji + '</div><div class="detail-metric-label">Status</div></div>';
            body += '<div class="detail-metric"><div class="detail-metric-value">' + met.tokens + '</div><div class="detail-metric-label">Tokens</div></div>';
            body += '<div class="detail-metric"><div class="detail-metric-value">' + met.model + '</div><div class="detail-metric-label">Model</div></div>';
            body += '<div class="detail-metric"><div class="detail-metric-value">' + met.uptime + '</div><div class="detail-metric-label">Uptime</div></div>';
            body += '</div></div>';

            // #5 — TODO list with demo data
            if (todoData) {
                body += '<div class="detail-section"><div class="detail-section-title">Current Task</div>';
                body += '<div style="font-size:14px;font-weight:500;color:var(--text-primary)">' + (todoData.currentTask || agent.task || 'Idle') + '</div>';
                body += '</div>';

                if (todoData.todos && todoData.todos.length) {
                    body += '<div class="detail-section"><div class="detail-section-title">TODO List</div>';
                    todoData.todos.forEach(function(todo) {
                        var ts = new Date(Date.now() - Math.random()*3600000);
                        var timeStr = ts.getHours().toString().padStart(2,'0') + ':' + ts.getMinutes().toString().padStart(2,'0');
                        body += '<div class="detail-todo-item' + (todo.status==='done'?' detail-todo-item--done':'') + '">';
                        body += '<span class="detail-todo-icon">' + todo.icon + '</span>';
                        body += '<span class="detail-todo-text">' + todo.text + '</span>';
                        body += '<span style="font-size:10px;color:var(--text-tertiary);flex-shrink:0">' + timeStr + '</span>';
                        body += '</div>';
                    });
                    body += '</div>';
                }
            }

            // #15 — Skills section with chips
            var agentSkills = (todoData && todoData.skills && todoData.skills.length) ? todoData.skills : [];
            if (agentSkills.length > 0) {
                body += '<div class="detail-section"><div class="detail-section-title">Skills (' + agentSkills.length + ')</div>';
                body += '<div class="detail-skill-chips">';
                agentSkills.forEach(function(s) {
                    body += '<span class="detail-skill-chip">' + (s.name || s) + '</span>';
                });
                body += '</div></div>';
            }

            // #9 — SOUL preview (demo or live)
            var soulText = DEMO.souls[agentId] || '';
            if (API) {
                try {
                    var agentInfo = await API.getAgentInfo(agentId);
                    if (agentInfo && agentInfo.soul) soulText = agentInfo.soul.substring(0, 300);
                } catch(e) {}
            }
            if (soulText) {
                body += '<div class="detail-section"><div class="detail-section-title">Soul (Personality)</div>';
                body += '<div class="detail-soul-preview">' + soulText.replace(/</g,'&lt;').replace(/>/g,'&gt;') + '</div>';

                // #17 — Edit button: C-levels yes, CEO limited, sub-agents NO
                if (agent.isSubAgent) {
                    body += '<div class="detail-readonly-badge" style="margin-top:8px">🔒 Sub-agent — Read only</div>';
                } else if (agentId === 'ceo') {
                    body += '<button class="detail-edit-btn" id="editAgentBtn" style="margin-top:8px;padding:6px 14px;border-radius:8px;border:1px solid var(--border-medium);background:transparent;color:var(--text-tertiary);font-size:12px;font-weight:500;cursor:pointer;">✏️ Edit Display Only</button>';
                } else {
                    body += '<button class="detail-edit-btn" id="editAgentBtn" style="margin-top:8px;padding:6px 14px;border-radius:8px;border:1px solid var(--exec-blue);background:transparent;color:var(--exec-blue);font-size:12px;font-weight:500;cursor:pointer;">✏️ Edit Agent</button>';
                }
                body += '</div>';
            }

            document.getElementById('detailBody').innerHTML = body;
            
            // #3 — Wire up "Open Full Chat" button
            var chatOpenBtn = document.getElementById('detailOpenChatBtn');
            if (chatOpenBtn) {
                chatOpenBtn.addEventListener('click', function() {
                    closeDetailPanel();
                    openChatPanel();
                });
            }

            // Wire up skill management buttons (NEW #1)
            var addSkillBtn = document.getElementById('addSkillBtn');
            if (addSkillBtn && API) {
                addSkillBtn.addEventListener('click', async function() {
                    try {
                        var available = await API.listAvailableSkills();
                        if (!available || available.length === 0) {
                            showToast('No skills found in workspace/skills/');
                            return;
                        }
                        // Show simple dropdown
                        var dropdown = document.createElement('div');
                        dropdown.style.cssText = 'position:absolute;background:var(--bg-secondary);border:1px solid var(--border-medium);border-radius:10px;padding:8px;z-index:999;box-shadow:0 8px 30px rgba(0,0,0,0.12);max-height:200px;overflow-y:auto;';
                        available.forEach(function(skill) {
                            var item = document.createElement('div');
                            item.textContent = skill.name;
                            item.style.cssText = 'padding:6px 12px;cursor:pointer;font-size:13px;border-radius:6px;';
                            item.onmouseover = function() { item.style.background = 'var(--bg-tertiary)'; };
                            item.onmouseout = function() { item.style.background = ''; };
                            item.onclick = async function() {
                                dropdown.remove();
                                // Add skill to agent
                                var currentSkills = (todoData && todoData.skills) ? todoData.skills.slice() : [];
                                currentSkills.push({ name: skill.name, description: skill.description || '', location: skill.location || '' });
                                var result = await API.saveAgentSkills(agentId, currentSkills);
                                if (result && result.success) {
                                    showToast('✅ Skill "' + skill.name + '" added');
                                    await loadLiveAgentData();
                                    openDetailPanel(agentId);
                                } else {
                                    showToast('⚠️ Failed to add skill');
                                }
                            };
                            dropdown.appendChild(item);
                        });
                        addSkillBtn.parentElement.style.position = 'relative';
                        addSkillBtn.parentElement.appendChild(dropdown);
                        // Close on click outside
                        setTimeout(function() {
                            document.addEventListener('click', function closeDropdown(e) {
                                if (!dropdown.contains(e.target)) { dropdown.remove(); document.removeEventListener('click', closeDropdown); }
                            });
                        }, 10);
                    } catch(e) { showToast('Error loading skills'); }
                });
            }
            
            // Wire up skill remove buttons
            document.querySelectorAll('.skill-remove-btn').forEach(function(btn) {
                btn.addEventListener('click', async function(e) {
                    e.stopPropagation();
                    var skillName = btn.dataset.skillName;
                    if (!API) return;
                    var currentSkills = (todoData && todoData.skills) ? todoData.skills.filter(function(s) { return (s.name || s) !== skillName; }) : [];
                    var result = await API.saveAgentSkills(agentId, currentSkills);
                    if (result && result.success) {
                        showToast('🗑️ Skill "' + skillName + '" removed');
                        await loadLiveAgentData();
                        openDetailPanel(agentId);
                    }
                });
            });
            
            // Wire up Edit Agent button (NEW #4)
            var editBtn = document.getElementById('editAgentBtn');
            if (editBtn && API) {
                editBtn.addEventListener('click', function() {
                    var soulEl = document.getElementById('soulExcerpt');
                    if (!soulEl) return;
                    
                    // Replace soul excerpt with inline editor
                    var editHtml = '<div class="soul-editor" style="display:flex;flex-direction:column;gap:8px;">';
                    editHtml += '<label style="font-size:11px;color:var(--text-tertiary);">Name</label>';
                    editHtml += '<input type="text" id="editName" value="' + (agent.name || '') + '" style="padding:6px 10px;border-radius:8px;border:1px solid var(--border-medium);font-size:13px;background:var(--bg-tertiary);color:var(--text-primary);" />';
                    editHtml += '<label style="font-size:11px;color:var(--text-tertiary);">Role</label>';
                    editHtml += '<input type="text" id="editRole" value="' + (agent.role || '') + '" style="padding:6px 10px;border-radius:8px;border:1px solid var(--border-medium);font-size:13px;background:var(--bg-tertiary);color:var(--text-primary);" />';
                    editHtml += '<label style="font-size:11px;color:var(--text-tertiary);">Traits</label>';
                    editHtml += '<input type="text" id="editTraits" placeholder="e.g. meticulous, strategic" style="padding:6px 10px;border-radius:8px;border:1px solid var(--border-medium);font-size:13px;background:var(--bg-tertiary);color:var(--text-primary);" />';
                    editHtml += '<div style="display:flex;gap:8px;margin-top:4px;">';
                    editHtml += '<button id="saveEditBtn" style="padding:6px 16px;border-radius:8px;border:none;background:var(--exec-blue);color:#fff;font-size:12px;font-weight:500;cursor:pointer;">Save</button>';
                    editHtml += '<button id="cancelEditBtn" style="padding:6px 16px;border-radius:8px;border:1px solid var(--border-medium);background:transparent;color:var(--text-secondary);font-size:12px;cursor:pointer;">Cancel</button>';
                    editHtml += '</div></div>';
                    
                    soulEl.innerHTML = editHtml;
                    editBtn.style.display = 'none';
                    
                    document.getElementById('cancelEditBtn').addEventListener('click', function() {
                        openDetailPanel(agentId);
                    });
                    
                    document.getElementById('saveEditBtn').addEventListener('click', async function() {
                        var name = document.getElementById('editName').value.trim();
                        var role = document.getElementById('editRole').value.trim();
                        var traits = document.getElementById('editTraits').value.trim();
                        var result = await API.saveAgentSoul(agentId, { name: name, role: role, traits: traits });
                        if (result && result.success) {
                            showToast('✅ Agent updated');
                            openDetailPanel(agentId);
                        } else {
                            showToast('⚠️ Failed to save: ' + (result.error || 'unknown'));
                        }
                    });
                });
            }

            detailOverlay.classList.add('open');
            detailClose.focus();
            document.body.style.overflow = 'hidden';
        }

        function closeDetailPanel() {
            detailOverlay.classList.remove('open');
            document.body.style.overflow = '';
        }

        detailBackdrop.addEventListener('click', closeDetailPanel);
        detailClose.addEventListener('click', closeDetailPanel);

        /* Keep the old openTodoPanel as a wrapper for backwards compat */
        function openTodoPanel(agentId) {
            openDetailPanel(agentId);
        }

        function closeTodoPanel() {
            todoOverlay.classList.remove('open');
            closeDetailPanel();
            document.body.style.overflow = '';
        }

        todoBackdrop.addEventListener('click', closeTodoPanel);
        todoClose.addEventListener('click', closeTodoPanel);

        /* ═══════════════════════════════════════════════
           Meeting Panel — Open / Close
           ═══════════════════════════════════════════════ */

        async function openMeetingPanel() {
            closeTodoPanel(); // Close TODO panel if open
            closeMailbox();   // Close mailbox if open

            // Build meeting content from REAL active subagents (FIX #7)
            var content = '';

            // Active meetings = active sub-agent sessions
            content += '<div class="meeting-section">';
            content += '<div class="meeting-section-title">Active Work Sessions</div>';
            content += '<div class="meeting-list">';
            
            var activeSubagents = [];
            if (API) {
                try {
                    activeSubagents = await API.getActiveSubagents();
                } catch(e) { console.warn('Failed to load active subagents:', e); }
            }
            
            // Demo mode — show active missions as work sessions
            if (!API && activeSubagents.length === 0) {
                activeSubagents = DEMO.missions.filter(function(m){return m.status==='running';}).map(function(m){
                    return {label:m.name, parentAgent:m.parent, durationMs:parseInt(m.duration)*60000||0};
                });
            }

            if (activeSubagents && activeSubagents.length > 0) {
                activeSubagents.forEach(function(sa) {
                    var duration = sa.durationMs ? Math.floor(sa.durationMs / 60000) + 'm' : sa.duration || '—';
                    var parentAvatar = (sa.parentAgent||'main').toLowerCase().split(' ')[0];
                    var avatarMap = { forge: 'avatar-forge', atlas: 'avatar-atlas', hunter: 'avatar-hunter', echo: 'avatar-echo', sentinel: 'avatar-sentinel', main: 'avatar-ceo' };
                    var avatarId = avatarMap[parentAvatar] || 'avatar-ceo';
                    
                    content += '<div class="meeting-item meeting-item--active">';
                    content += '<div class="meeting-item-header">';
                    content += '<div class="meeting-item-title">🔴 ' + (sa.label || 'Sub-agent') + '</div>';
                    content += '<div class="meeting-item-status">' + duration + '</div>';
                    content += '</div>';
                    content += '<div class="meeting-item-description">Active sub-agent under ' + (sa.parentAgent || 'main') + '</div>';
                    content += '<div class="meeting-participants">';
                    content += '<div class="meeting-participant"><svg><use href="#' + avatarId + '"/></svg></div>';
                    content += '</div>';
                    content += '</div>';
                });
            } else {
                content += '<div class="meeting-item" style="opacity:0.6">';
                content += '<div class="meeting-item-header">';
                content += '<div class="meeting-item-title">💤 No active work sessions</div>';
                content += '</div>';
                content += '<div class="meeting-item-description">All sub-agents have completed their tasks.</div>';
                content += '</div>';
            }

            content += '</div>';
            content += '</div>';

            // Recently completed sessions section (from sessions data)
            content += '<div class="meeting-section">';
            content += '<div class="meeting-section-title">Recent</div>';
            content += '<div class="meeting-list">';
            
            var completedSessions = [];
            if (API) {
                try {
                    var sessions = await API.getSessions();
                    completedSessions = (sessions.subagents || []).filter(function(sa) { return sa.status === 'completed'; }).slice(0, 4);
                } catch(e) {}
            }
            if (!API && completedSessions.length === 0) {
                completedSessions = DEMO.missions.filter(function(m){return m.status==='completed';}).map(function(m){
                    return {name:m.name, label:m.label, task:m.label};
                });
            }
            if (completedSessions.length > 0) {
                completedSessions.forEach(function(sa) {
                    content += '<div class="meeting-item">';
                    content += '<div class="meeting-item-header">';
                    content += '<div class="meeting-item-title">✅ ' + (sa.name || sa.label || 'Completed') + '</div>';
                    content += '<div class="meeting-item-status">Completed</div>';
                    content += '</div>';
                    content += '<div class="meeting-item-description">' + (sa.task || sa.label || 'Task completed') + '</div>';
                    content += '</div>';
                });
            } else {
                content += '<div class="meeting-item" style="opacity:0.5">';
                content += '<div class="meeting-item-description">No recently completed sessions</div>';
                content += '</div>';
            }

            meetingContent.innerHTML = content;

            // Show panel
            meetingOverlay.classList.add('open');
            meetingClose.focus();
            document.body.style.overflow = 'hidden';
        }

        function closeMeetingPanel() {
            meetingOverlay.classList.remove('open');
            document.body.style.overflow = '';
        }

        meetingBackdrop.addEventListener('click', closeMeetingPanel);
        meetingClose.addEventListener('click', closeMeetingPanel);

        // Close panels on Escape — all overlays
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                if (document.getElementById('missionsOverlay').classList.contains('open')) {
                    closeMissionsPanel();
                } else if (document.getElementById('settingsOverlay').classList.contains('open')) {
                    closeSettingsPanel();
                } else if (document.getElementById('chatOverlay').classList.contains('open')) {
                    closeChatPanel();
                } else if (document.getElementById('cronOverlay').classList.contains('open')) {
                    closeCronPanel();
                } else if (document.getElementById('memoryOverlay').classList.contains('open')) {
                    closeMemoryPanel();
                } else if (detailOverlay.classList.contains('open')) {
                    closeDetailPanel();
                } else if (todoOverlay.classList.contains('open')) {
                    closeTodoPanel();
                } else if (meetingOverlay.classList.contains('open')) {
                    closeMeetingPanel();
                } else if (mailboxOverlay.classList.contains('open')) {
                    closeMailbox();
                }
            }
        });

        /* ── Update Mailbox Badge ───────────────────── */
        function updateMailboxBadge() {
            var unreadCount = LIVE_MESSAGES.filter(function(msg) { return !msg.read; }).length;
            var badge = document.getElementById('mailboxBadge');
            if (badge) {
                badge.textContent = unreadCount;
                if (unreadCount === 0) {
                    badge.style.opacity = '0.5';
                } else {
                    badge.style.opacity = '1';
                }
            }
            
            // Update mailbox button aria-label
            if (mailboxBtn) {
                var label = 'Open mailbox — ' + unreadCount + ' unread message' + (unreadCount === 1 ? '' : 's');
                mailboxBtn.setAttribute('aria-label', label);
            }
        }

        /* ── Load Live Messages — with priority + dispatch parsing ─── */
        async function loadLiveMessages() {
            if (!window.spawnkitAPI || !await window.spawnkitAPI.isAvailable()) {
                console.log('🏢 [Executive] No live data — using demo inbox');
                LIVE_MESSAGES = DEMO.mailMessages.slice();
                renderMessages(LIVE_MESSAGES);
                return;
            }
            
            try {
                var transcript = await window.spawnkitAPI.getTranscript('agent:main:main', 8);
                LIVE_MESSAGES = transcript.map(function(msg, idx) {
                    var text = (msg.text || '').substring(0, 200);
                    var textLower = text.toLowerCase();
                    
                    // FIX #3: Parse priority from message content
                    var priority = 'normal';
                    if (textLower.match(/\b(urgent|critical|bug|hotfix|broken|crash)\b/)) {
                        priority = 'urgent';
                    } else if (textLower.match(/\b(info|update|note|fyi|status)\b/)) {
                        priority = 'info';
                    }
                    
                    // FIX #3: Parse assignedTo from agent mentions
                    var assignedTo = null;
                    var agentMentions = {
                        '@forge': 'Forge (CTO)', '@atlas': 'Atlas (COO)',
                        '@hunter': 'Hunter (CRO)', '@echo': 'Echo (CMO)',
                        '@sentinel': 'Sentinel (QA)',
                        'forge': 'Forge', 'atlas': 'Atlas',
                        'hunter': 'Hunter', 'echo': 'Echo', 'sentinel': 'Sentinel'
                    };
                    for (var mention in agentMentions) {
                        if (mention.startsWith('@') && textLower.includes(mention)) {
                            assignedTo = agentMentions[mention];
                            break;
                        }
                    }
                    // Only check non-@ mentions if no @ mention found
                    if (!assignedTo) {
                        for (var m in agentMentions) {
                            if (!m.startsWith('@') && textLower.match(new RegExp('\\b' + m + '\\b', 'i'))) {
                                assignedTo = agentMentions[m];
                                break;
                            }
                        }
                    }
                    
                    // FIX #6: Mark last 2 messages as unread for badge count
                    var isRecent = idx >= transcript.length - 2;
                    
                    return {
                        sender: msg.role === 'user' ? 'Kira' : 'ApoMac',
                        color: msg.role === 'user' ? '#FF2D55' : '#007AFF',
                        time: msg.timestamp ? new Date(msg.timestamp).toLocaleTimeString('en-US', { 
                            hour: '2-digit', minute: '2-digit', hour12: false 
                        }) : 'Now',
                        text: text + (msg.text && msg.text.length > 200 ? '...' : ''),
                        read: !isRecent,
                        priority: priority,
                        assignedTo: assignedTo
                    };
                }).reverse().slice(0, 6);
                
                if (LIVE_MESSAGES.length === 0) {
                    LIVE_MESSAGES = [{ sender: 'System', color: '#636366', time: 'Now', text: 'No recent messages', read: true }];
                }
                
                console.log('🏢 [Executive] Loaded', LIVE_MESSAGES.length, 'live messages');
            } catch (e) {
                console.warn('🏢 [Executive] Failed to load transcript:', e);
                LIVE_MESSAGES = [
                    { sender: 'System', color: '#636366', time: 'Error', text: 'Failed to load messages', read: true }
                ];
            }
            
            renderMessages(LIVE_MESSAGES);
        }

        /* ── Render Messages ────────────────────────── */
        function renderMessages(messages) {
            mailboxMessages.innerHTML = '';
            messages.forEach(function(msg, i) {
                if (i > 0) {
                    var divider = document.createElement('div');
                    divider.className = 'mail-divider';
                    divider.setAttribute('aria-hidden', 'true');
                    mailboxMessages.appendChild(divider);
                }

                var item = document.createElement('div');
                item.className = 'mail-item' + (msg.read ? ' mail-item--read' : '');
                item.dataset.messageIndex = i;

                // Use SVG avatar if available, else fallback to letter
                var avatarId = AVATAR_MAP[msg.sender];
                var avatarContent;
                if (avatarId) {
                    avatarContent = '<svg><use href="#' + avatarId + '"/></svg>';
                } else {
                    avatarContent = (msg.sender || '?').charAt(0);
                }

                var unreadIndicator = msg.read ? '' : '<div class="mail-unread-dot" aria-hidden="true"></div>';

                // Priority flag
                var priorityFlag = '';
                var pri = msg.priority || 'normal';
                if (pri === 'urgent') priorityFlag = '<span class="mail-flag mail-flag--urgent">🔴 Urgent</span>';
                else if (pri === 'info') priorityFlag = '<span class="mail-flag mail-flag--info">🟢 Info</span>';
                else priorityFlag = '<span class="mail-flag mail-flag--normal">🟡 Normal</span>';

                // Dispatch indicator
                var dispatchHtml = '';
                if (msg.assignedTo) {
                    dispatchHtml = '<div class="mail-dispatch"><span>📨</span> <span class="mail-dispatch-arrow">→</span> <strong>' + msg.assignedTo + '</strong></div>';
                }

                item.innerHTML =
                    '<div class="mail-avatar" style="background: ' + msg.color + ';" aria-hidden="true">' + avatarContent + '</div>' +
                    '<div class="mail-content">' +
                        '<div class="mail-header">' +
                            '<span class="mail-sender">' + msg.sender + '</span>' +
                            '<span class="mail-time">' + msg.time + '</span>' +
                        '</div>' +
                        '<div class="mail-preview">' + msg.text + '</div>' +
                        '<div class="mail-flags">' + priorityFlag + '</div>' +
                        dispatchHtml +
                    '</div>' + unreadIndicator;

                // Click to mark as read
                item.addEventListener('click', function() {
                    if (!msg.read) {
                        msg.read = true;
                        item.classList.add('mail-item--read');
                        var dot = item.querySelector('.mail-unread-dot');
                        if (dot) dot.remove();
                        updateMailboxBadge();
                    }
                });

                mailboxMessages.appendChild(item);
            });
            
            updateMailboxBadge();
        }

        // Load live data
        loadLiveMessages();
        loadLiveAgentData();

        /* ═══════════════════════════════════════════════
           Agent Room — Click to Show TODO Panel
           ═══════════════════════════════════════════════ */

        var expandedRoom = null;

        // Handle agent room clicks in both grid and hierarchy views
        document.addEventListener('click', function(e) {
            var agentElement = e.target.closest('[data-agent]');
            if (agentElement) {
                // Don't toggle if clicking mailbox button
                if (e.target.closest('.ceo-mailbox')) return;

                var agentId = agentElement.dataset.agent;
                openTodoPanel(agentId);
                return;
            }

            // Handle meeting room clicks
            var meetingElement = e.target.closest('[data-room="meeting"]');
            if (meetingElement) {
                openMeetingPanel();
                return;
            }

            // Handle detail expansion (legacy behavior for non-agent elements)
            var room = e.target.closest('.exec-room[data-agent]');
            if (room && !e.target.closest('.ceo-mailbox')) {
                var agentId = room.dataset.agent;
                var detail = document.getElementById('detail-' + agentId);
                if (detail) {
                    if (expandedRoom && expandedRoom !== detail) {
                        expandedRoom.classList.remove('visible');
                    }
                    detail.classList.toggle('visible');
                    expandedRoom = detail.classList.contains('visible') ? detail : null;
                }
            }

            // Close detail when clicking outside
            if (!room && expandedRoom) {
                expandedRoom.classList.remove('visible');
                expandedRoom = null;
            }
        });

        // Keyboard: Enter/Space to open TODO panel
        document.querySelectorAll('[data-agent]').forEach(function(element) {
            element.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    var agentId = element.dataset.agent;
                    openTodoPanel(agentId);
                }
            });
        });

        // Keyboard: Enter/Space to open Meeting panel
        document.querySelectorAll('[data-room="meeting"]').forEach(function(element) {
            element.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    openMeetingPanel();
                }
            });
        });

        /* ═══════════════════════════════════════════════
           Command Input — Enter to send via postMessage
           ═══════════════════════════════════════════════ */

        commandInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && commandInput.value.trim()) {
                var cmd = commandInput.value.trim();
                commandInput.value = '';
                // Open chat panel and send as mission
                openChatPanel();
                chatInput.value = cmd;
                sendChatMessage();
            }
        });

        /* ═══════════════════════════════════════════════
           postMessage Bridge — Communication with Parent
           ═══════════════════════════════════════════════ */

        window.addEventListener('message', function(e) {
            if (!e.data || typeof e.data !== 'object') return;
            var isSameOrigin = (e.origin === window.location.origin || e.origin === 'null');
            if (!isSameOrigin) return;

            switch (e.data.type) {
                case 'spawnkit:data':
                    handleDataUpdate(e.data.payload);
                    break;

                case 'spawnkit:agents':
                    handleAgentsUpdate(e.data.agents);
                    break;

                case 'spawnkit:messages':
                    handleMessagesUpdate(e.data.messages);
                    break;

                case 'spawnkit:theme':
                    handleThemeChange(e.data.theme);
                    break;

                case 'spawnkit:ping':
                    if (window.parent !== window) {
                        window.parent.postMessage({
                            type: 'executive:pong',
                            theme: 'executive',
                            timestamp: Date.now()
                        }, '*');
                    }
                    break;
            }
        });

        /* ── Data Update Handlers ───────────────────── */

        function handleDataUpdate(payload) {
            if (!payload) return;

            if (payload.agents) {
                handleAgentsUpdate(payload.agents);
            }

            if (payload.agents) {
                var count = payload.agents.length;
                document.getElementById('statusAgentCount').textContent = count + ' Agent' + (count !== 1 ? 's' : '');
            }
        }

        function handleAgentsUpdate(agents) {
            if (!agents || !Array.isArray(agents)) return;

            agents.forEach(function(agent) {
                if (!agent || !agent.name) return;
                var id = agent.name.toLowerCase();

                // Update in both grid and hierarchy views
                document.querySelectorAll('[data-agent="' + id + '"]').forEach(function(el) {
                    var dot = el.querySelector('.agent-status-dot');
                    if (dot && agent.status) {
                        dot.className = 'agent-status-dot';
                        var statusMap = { active: 'active', working: 'active', building: 'busy', idle: 'idle', error: 'idle' };
                        dot.classList.add('agent-status-dot--' + (statusMap[agent.status] || 'idle'));
                    }
                    
                    // Update agent name to show Agent OS format if available
                    var nameEl = el.querySelector('.agent-name');
                    if (nameEl && agent.role && window.AgentOSNaming) {
                        // Try to construct Agent OS name format for main agents
                        var parentMap = { Hunter: 'Hunter', Forge: 'Forge', Echo: 'Echo', Atlas: 'Atlas', Sentinel: 'Sentinel', ApoMac: 'Main' };
                        var parent = parentMap[agent.name] || agent.name;
                        var roleMap = { CTO: 'CodeBuilder', CRO: 'Researcher', CMO: 'ContentCreator', COO: 'OpsRunner', CEO: 'Coordinator', 'QA & Security': 'Auditor' };
                        var role = roleMap[agent.role] || 'TaskRunner';
                        var agentOSName = parent + '.' + role + '-01';
                        nameEl.textContent = agentOSName;
                        
                        // Add model badge if available
                        if (agent.model && window.ModelIdentity) {
                            var modelIdentity = window.ModelIdentity.getIdentity(agent.model);
                            var badge = el.querySelector('.model-badge') || document.createElement('span');
                            badge.className = 'model-badge';
                            badge.textContent = modelIdentity.level;
                            badge.style.color = modelIdentity.color;
                            badge.style.marginLeft = '6px';
                            badge.style.fontSize = '10px';
                            badge.style.fontWeight = '600';
                            if (!el.querySelector('.model-badge')) {
                                nameEl.appendChild(badge);
                            }
                        }
                    }
                });

                // Update detail if exists
                var detail = document.getElementById('detail-' + id);
                if (detail && agent.currentTask) {
                    var taskEl = detail.querySelectorAll('.agent-detail-value')[1];
                    if (taskEl) taskEl.textContent = agent.currentTask;
                }
            });
        }

        function handleMessagesUpdate(messages) {
            if (!messages || !Array.isArray(messages)) return;
            renderMessages(messages);
            var badge = document.getElementById('mailboxBadge');
            if (badge) {
                badge.textContent = messages.length;
            }
        }

        function handleThemeChange(theme) {
            // Could apply light/dark mode in future
        }

        /* ═══════════════════════════════════════════════
           Status Bar — Clock & System Status
           ═══════════════════════════════════════════════ */

        function updateClock() {
            var now = new Date();
            var h = now.getHours().toString().padStart(2, '0');
            var m = now.getMinutes().toString().padStart(2, '0');
            var statusEl = document.getElementById('statusSystem');
            if (statusEl) {
                statusEl.textContent = 'All systems nominal • ' + h + ':' + m;
            }
        }

        updateClock();
        setInterval(updateClock, 30000);

        /* ═══════════════════════════════════════════════
           CEO Chat Panel (Feature 2)
           ═══════════════════════════════════════════════ */
        var chatOverlay  = document.getElementById('chatOverlay');
        var chatBackdrop = document.getElementById('chatBackdrop');
        var chatCloseBtn = document.getElementById('chatClose');
        var chatMsgsEl   = document.getElementById('chatMessages');
        var chatInput    = document.getElementById('chatInput');
        var chatSendBtn  = document.getElementById('chatSend');
        var chatEmptyEl  = document.getElementById('chatEmpty');

        function openChatPanel() {
            closeAllPanels();
            chatOverlay.classList.add('open');
            chatInput.focus();
            document.body.style.overflow = 'hidden';
            loadChatTranscript();
        }
        function closeChatPanel() {
            chatOverlay.classList.remove('open');
            document.body.style.overflow = '';
        }

        document.getElementById('chatBtn').addEventListener('click', openChatPanel);
        chatBackdrop.addEventListener('click', closeChatPanel);
        chatCloseBtn.addEventListener('click', closeChatPanel);

        async function loadChatTranscript() {
            if (!API) {
                // #2 — Demo chat history
                if (chatHistory.length === 0) {
                    chatHistory = DEMO.chatHistory.slice();
                }
                renderChatMessages();
                return;
            }
            try {
                var transcript = await API.getTranscript('agent:main:main');
                if (transcript && transcript.length > 0) {
                    chatHistory = transcript.slice(-50).map(function(m) {
                        return {
                            role: m.role === 'user' ? 'user' : 'system',
                            text: m.text || m.content || '',
                            time: m.timestamp ? new Date(m.timestamp).toLocaleTimeString('en-GB',{hour:'2-digit',minute:'2-digit'}) : ''
                        };
                    });
                    renderChatMessages();
                }
            } catch(e) { console.warn('Chat transcript load:', e); }
        }

        // #11 — Route hint for sub-agent dispatch
        var chatRouteSelect = document.getElementById('chatRouteSelect');
        var chatRouteHint = document.getElementById('chatRouteHint');
        if (chatRouteSelect && chatRouteHint) {
            chatRouteSelect.addEventListener('change', function() {
                var val = chatRouteSelect.value;
                if (val !== 'ceo') {
                    var agentName = AGENTS[val] ? AGENTS[val].name + ' (' + AGENTS[val].role + ')' : val;
                    chatRouteHint.textContent = '📨 Message will be dispatched via ' + agentName + ' to their sub-agents';
                    chatRouteHint.classList.add('visible');
                } else {
                    chatRouteHint.classList.remove('visible');
                }
            });
        }

        // #11 — Auto-route @mentions
        if (chatInput) {
            chatInput.addEventListener('input', function() {
                var text = chatInput.value;
                var mentionMap = {'@forge':'forge','@atlas':'atlas','@hunter':'hunter','@echo':'echo','@sentinel':'sentinel'};
                for (var mention in mentionMap) {
                    if (text.toLowerCase().startsWith(mention)) {
                        if (chatRouteSelect) chatRouteSelect.value = mentionMap[mention];
                        chatRouteSelect.dispatchEvent(new Event('change'));
                        break;
                    }
                }
            });
        }

        function renderChatMessages() {
            if (chatHistory.length === 0) {
                chatEmptyEl.style.display = '';
                return;
            }
            chatEmptyEl.style.display = 'none';
            chatMsgsEl.innerHTML = '';
            chatHistory.forEach(function(m) {
                var div = document.createElement('div');
                div.className = 'chat-msg chat-msg--' + m.role;
                var preview = m.text.length > 300 ? m.text.substring(0, 300) + '…' : m.text;
                div.innerHTML = '<div>' + preview.replace(/</g,'&lt;').replace(/>/g,'&gt;') + '</div>' +
                    (m.time ? '<div class="chat-msg-time">' + m.time + '</div>' : '');
                chatMsgsEl.appendChild(div);
            });
            chatMsgsEl.scrollTop = chatMsgsEl.scrollHeight;
        }

        async function sendChatMessage() {
            var text = chatInput.value.trim();
            if (!text) return;
            chatInput.value = '';

            var now = new Date();
            var timeStr = now.getHours().toString().padStart(2,'0') + ':' + now.getMinutes().toString().padStart(2,'0');
            chatHistory.push({ role: 'user', text: text, time: timeStr });
            renderChatMessages();

            // Determine target from route dropdown (NEW #6)
            var routeDropdown = document.getElementById('chatRouteSelect');
            var targetAgent = routeDropdown ? routeDropdown.value : 'ceo';

            // Send via API — FIX #2: actually check success
            if (API && typeof API.sendMission === 'function') {
                try {
                    var result = await API.sendMission(text, targetAgent);
                    if (result && result.success) {
                        var targetLabel = targetAgent === 'ceo' ? 'CEO inbox' : targetAgent + ' inbox';
                        chatHistory.push({ role: 'system', text: '✅ Mission dispatched to ' + targetLabel, time: timeStr });
                        renderChatMessages();
                    } else {
                        chatHistory.push({ role: 'system', text: '⚠️ Dispatch failed: ' + (result.error || 'Unknown error'), time: timeStr });
                        renderChatMessages();
                    }
                } catch(e) {
                    chatHistory.push({ role: 'system', text: '⚠️ Could not dispatch: ' + e.message, time: timeStr });
                    renderChatMessages();
                }
            } else {
                chatHistory.push({ role: 'system', text: '📡 API not connected — message queued', time: timeStr });
                renderChatMessages();
            }
        }

        chatSendBtn.addEventListener('click', sendChatMessage);
        chatInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') { e.preventDefault(); sendChatMessage(); }
        });

        // Auto-refresh chat every 10s when open
        setInterval(function() {
            if (chatOverlay.classList.contains('open')) loadChatTranscript();
        }, 10000);

        /* ═══════════════════════════════════════════════
           Cron / Calendar Panel (Feature 4)
           ═══════════════════════════════════════════════ */
        var cronOverlay = document.getElementById('cronOverlay');
        var cronBackdropEl = document.getElementById('cronBackdrop');
        var cronCloseBtn = document.getElementById('cronClose');
        var cronBody = document.getElementById('cronBody');

        function openCronPanel() {
            closeAllPanels();
            cronOverlay.classList.add('open');
            document.body.style.overflow = 'hidden';
            renderCronJobs();
        }
        function closeCronPanel() {
            cronOverlay.classList.remove('open');
            document.body.style.overflow = '';
        }

        document.getElementById('cronBtn').addEventListener('click', openCronPanel);
        cronBackdropEl.addEventListener('click', closeCronPanel);
        cronCloseBtn.addEventListener('click', closeCronPanel);

        function humanCron(schedule) {
            if (!schedule) return '—';
            var m = { '*/30 * * * *': 'Every 30 min', '0 * * * *': 'Every hour',
                      '0 9 * * *': 'Daily 9:00', '0 9 * * 1': 'Mon 9:00',
                      '*/5 * * * *': 'Every 5 min', '0 */2 * * *': 'Every 2h',
                      '0 8 * * 1-5': 'Weekdays 8:00' };
            return m[schedule] || schedule;
        }

        async function renderCronJobs() {
            var crons = liveCronData;
            if (API && !crons) {
                try { crons = await API.getCrons(); } catch(e) {}
            }
            // #7 — Demo crons when no API
            if ((!crons || !Array.isArray(crons) || crons.length === 0) && !API) {
                crons = DEMO.crons;
            }
            if (!crons || !Array.isArray(crons) || crons.length === 0) {
                cronBody.innerHTML = '<div class="cron-empty">No cron jobs configured.</div>';
                return;
            }

            // #7 — Calendar timeline header
            var now = new Date();
            var currentH = now.getHours();
            var eventHours = {};
            crons.forEach(function(c) {
                var sch = c.schedule || '';
                var m = sch.match(/(\d{1,2}):(\d{2})/);
                if (m) eventHours[parseInt(m[1])] = true;
            });
            var html = '<div class="cron-timeline">';
            html += '<div style="font-size:10px;font-weight:600;color:var(--text-tertiary);padding:0 4px 4px;white-space:nowrap;">📅 Today</div>';
            for (var h = 6; h <= 22; h++) {
                var isCurrent = h === currentH;
                var hasEvent = eventHours[h];
                var barH = hasEvent ? 28 : 12;
                html += '<div class="cron-timeline-hour">';
                html += '<div class="cron-timeline-bar' + (hasEvent?' has-event':'') + (isCurrent?' current-hour':'') + '" style="height:' + barH + 'px"></div>';
                html += '<div class="cron-timeline-label' + (isCurrent?' current-hour':'') + '">' + h + ':00</div>';
                html += '</div>';
            }
            html += '</div>';

            // Group by owner
            var groups = {};
            crons.forEach(function(c) {
                var owner = c.owner || 'System';
                if (!groups[owner]) groups[owner] = [];
                groups[owner].push(c);
            });

            Object.keys(groups).forEach(function(owner) {
                html += '<div class="cron-group">';
                html += '<div class="cron-group-title">' + owner + '</div>';
                groups[owner].forEach(function(c) {
                    var statusCls = c.status === 'active' ? 'active' : c.status === 'error' ? 'error' : 'paused';
                    var icon = c.icon || (c.status === 'active' ? '⏰' : c.status === 'error' ? '❌' : '⏸️');
                    var sched = c.schedule || humanCron(c.schedule);
                    var nextRun = c.nextRun ? new Date(c.nextRun).toLocaleString('en-GB', {month:'short',day:'numeric',hour:'2-digit',minute:'2-digit'}) : '—';
                    html += '<div class="cron-item">';
                    html += '<span class="cron-item-icon">' + icon + '</span>';
                    html += '<div class="cron-item-info">';
                    html += '<div class="cron-item-name">' + (c.name || c.id || 'Unnamed') + '</div>';
                    html += '<div class="cron-item-schedule">' + sched + '</div>';
                    html += '<div class="cron-item-next">Next: ' + nextRun + '</div>';
                    html += '</div>';
                    html += '<span class="cron-item-status cron-item-status--' + statusCls + '">' + (c.status || 'unknown') + '</span>';
                    html += '<button class="cron-toggle ' + (c.status === 'active' ? 'on' : '') + '" data-cron-id="' + (c.id||c.name||'') + '" aria-label="Toggle"></button>';
                    html += '</div>';
                });
                html += '</div>';
            });
            cronBody.innerHTML = html;

            // Toggle click → toast
            cronBody.querySelectorAll('.cron-toggle').forEach(function(btn) {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    btn.classList.toggle('on');
                    showToast('Connect to OpenClaw to modify cron jobs');
                });
            });
        }

        /* ═══════════════════════════════════════════════
           Memory View Panel (Feature 5)
           ═══════════════════════════════════════════════ */
        var memoryOverlay = document.getElementById('memoryOverlay');
        var memoryBackdropEl = document.getElementById('memoryBackdrop');
        var memoryCloseBtn = document.getElementById('memoryClose');
        var memoryBody = document.getElementById('memoryBody');

        function openMemoryPanel() {
            closeAllPanels();
            memoryOverlay.classList.add('open');
            document.body.style.overflow = 'hidden';
            renderMemory();
        }
        function closeMemoryPanel() {
            memoryOverlay.classList.remove('open');
            document.body.style.overflow = '';
        }

        document.getElementById('memoryBtn').addEventListener('click', openMemoryPanel);
        memoryBackdropEl.addEventListener('click', closeMemoryPanel);
        memoryCloseBtn.addEventListener('click', closeMemoryPanel);

        function renderMarkdown(md) {
            if (!md) return '<em>No content</em>';
            return md
                .replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;')
                .replace(/^### (.+)$/gm, '<h3>$1</h3>')
                .replace(/^## (.+)$/gm, '<h2>$1</h2>')
                .replace(/^# (.+)$/gm, '<h1>$1</h1>')
                .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
                .replace(/`(.+?)`/g, '<code>$1</code>')
                .replace(/^- (.+)$/gm, '<li>$1</li>')
                .replace(/\n{2,}/g, '<br><br>')
                .replace(/\n/g, '<br>');
        }

        async function renderMemory() {
            var mem = liveMemoryData;
            if (API && !mem) {
                try { mem = await API.getMemory(); } catch(e) {}
            }
            // #16 — Demo memory when no API
            if (!mem && !API) {
                mem = DEMO.memory;
            }
            if (!mem) {
                memoryBody.innerHTML = '<div class="cron-empty">No memory data available.</div>';
                return;
            }

            var html = '';

            // Golden rules — extract 🔴 sections from long-term
            if (mem.longTerm && mem.longTerm.content) {
                var content = mem.longTerm.content;
                var goldenMatch = content.match(/## 🔴[^\n]*\n[\s\S]*?(?=\n## |$)/g);
                if (goldenMatch && goldenMatch.length > 0) {
                    html += '<div class="memory-section">';
                    html += '<div class="memory-section-title">Golden Rules</div>';
                    goldenMatch.forEach(function(rule) {
                        html += '<div class="memory-golden-rules">';
                        html += '<div class="memory-content-md">' + renderMarkdown(rule.trim()) + '</div>';
                        html += '</div>';
                    });
                    html += '</div>';
                }

                // Full MEMORY.md
                html += '<div class="memory-section">';
                html += '<div class="memory-section-title">MEMORY.md <span style="font-weight:400;color:var(--text-tertiary);text-transform:none;letter-spacing:0">(' + (mem.longTerm.size ? (mem.longTerm.size / 1024).toFixed(1) + ' KB' : '—') + ')</span></div>';
                html += '<div class="memory-content-md">' + renderMarkdown(content.substring(0, 3000)) + '</div>';
                if (content.length > 3000) {
                    html += '<div style="color:var(--text-tertiary);font-size:11px;margin-top:8px">…truncated (' + content.length + ' chars total)</div>';
                }
                html += '</div>';
            }

            // Daily memory files
            if (mem.daily && mem.daily.length > 0) {
                html += '<div class="memory-section">';
                html += '<div class="memory-section-title">Daily Notes</div>';
                html += '<div class="memory-daily-list">';
                mem.daily.slice(0, 14).forEach(function(d) {
                    html += '<div class="memory-daily-item">';
                    html += '<span class="memory-daily-item-date">' + (d.date || d.name || '—') + '</span>';
                    html += '<span>' + (d.preview || d.description || 'Daily log') + '</span>';
                    html += '<span class="memory-daily-item-size">' + (d.size ? (d.size / 1024).toFixed(1) + ' KB' : '') + '</span>';
                    html += '</div>';
                });
                html += '</div>';
                html += '</div>';
            }

            // Heartbeat state
            if (mem.heartbeat) {
                html += '<div class="memory-section">';
                html += '<div class="memory-section-title">Heartbeat State</div>';
                html += '<div class="memory-content-md"><pre style="font-size:11px;background:var(--bg-tertiary);padding:10px;border-radius:8px;overflow-x:auto">' + JSON.stringify(mem.heartbeat, null, 2).replace(/</g,'&lt;') + '</pre></div>';
                html += '</div>';
            }

            // Read-only label
            html += '<div class="memory-section">';
            html += '<div class="memory-readonly">🔒 Only the CEO can edit memory</div>';
            html += '</div>';

            memoryBody.innerHTML = html;
        }

        /* Toast helper */
        function showToast(msg) {
            var t = document.getElementById('execToast');
            if (!t) return;
            t.textContent = msg;
            t.classList.add('show');
            clearTimeout(t._timer);
            t._timer = setTimeout(function() { t.classList.remove('show'); }, 2500);
        }

        /* Close all panels helper */
        function closeAllPanels() {
            closeMailbox();
            closeTodoPanel();
            closeMeetingPanel();
            closeDetailPanel();
            closeChatPanel();
            closeCronPanel();
            closeMemoryPanel();
        }

        /* ═══════════════════════════════════════════════
           Announce readiness to parent
           ═══════════════════════════════════════════════ */

        if (window.parent !== window) {
            window.parent.postMessage({
                type: 'executive:ready',
                theme: 'executive',
                timestamp: Date.now()
            }, '*');
        }

        /* ═══════════════════════════════════════════════
           Shared scripts compatibility
           ═══════════════════════════════════════════════ */

        window.__EXEC_THEME = 'executive';

        /* ═══════════════════════════════════════════════
           Live Activity Simulation — Makes it feel alive
           ═══════════════════════════════════════════════ */

        var ACTIVITY_VERBS = {
            ceo:      ['Orchestrating', 'Reviewing', 'Synthesizing', 'Delegating', 'Planning'],
            atlas:    ['Coordinating', 'Documenting', 'Syncing', 'Auditing', 'Scheduling'],
            forge:    ['Building', 'Deploying', 'Optimizing', 'Refactoring', 'Testing'],
            hunter:   ['Prospecting', 'Analyzing', 'Pricing', 'Pitching', 'Converting'],
            echo:     ['Crafting', 'Writing', 'Designing', 'Scripting', 'Publishing'],
            sentinel: ['Scanning', 'Auditing', 'Reviewing', 'Monitoring', 'Verifying']
        };

        var ACTIVITY_OBJECTS = {
            ceo:      ['fleet operations', 'quality pipeline', 'revenue strategy', 'sprint goals', 'SS+ roadmap'],
            atlas:    ['workflows', 'FeedCast ops', 'deployment pipeline', 'cron schedules', 'fleet status'],
            forge:    ['security middleware', 'executive dashboard', 'API endpoints', 'live data bridge', 'Hetzner infra'],
            hunter:   ['Stripe payments', 'lead pipeline', 'pricing tiers', 'market segments', 'conversion funnel'],
            echo:     ['TikTok scripts', 'brand story', 'video pipeline', 'landing page copy', 'social content'],
            sentinel: ['codebase', 'fleet deliverables', 'security posture', 'compliance gates', 'deploy artifacts']
        };

        function randomActivity(agentId) {
            var verbs = ACTIVITY_VERBS[agentId] || ACTIVITY_VERBS.ceo;
            var objects = ACTIVITY_OBJECTS[agentId] || ACTIVITY_OBJECTS.ceo;
            return verbs[Math.floor(Math.random() * verbs.length)] + ' ' + objects[Math.floor(Math.random() * objects.length)];
        }

        /* Rotate agent tasks every 15-45 seconds for liveness */
        function simulateActivity() {
            /* Only simulate when NOT connected to live data */
            if (API) return;

            var agentIds = Object.keys(AGENTS);
            var targetId = agentIds[Math.floor(Math.random() * agentIds.length)];
            var newTask = randomActivity(targetId);
            AGENTS[targetId].task = newTask;

            /* Update visible task text in grid view */
            document.querySelectorAll('[data-agent="' + targetId + '"]').forEach(function(el) {
                var taskEl = el.querySelector('.agent-task');
                if (taskEl) {
                    taskEl.style.opacity = '0';
                    setTimeout(function() {
                        taskEl.textContent = newTask;
                        taskEl.style.opacity = '1';
                    }, 200);
                }
            });

            /* Schedule next update — random 15-45s */
            setTimeout(simulateActivity, 15000 + Math.random() * 30000);
        }

        /* Start after 8 seconds (demo mode only) */
        setTimeout(simulateActivity, 8000);

        /* ── Uptime Counter in Status Bar ───────────── */
        var startTime = Date.now() - (8 * 3600000 + 23 * 60000); /* Simulate 8h23m uptime */
        function updateUptime() {
            var elapsed = Date.now() - startTime;
            var h = Math.floor(elapsed / 3600000);
            var m = Math.floor((elapsed % 3600000) / 60000);
            var uptimeEl = document.getElementById('statusAgentCount');
            if (uptimeEl) {
                uptimeEl.textContent = '6 Agents • ' + h + 'h' + m.toString().padStart(2, '0') + 'm uptime';
            }
        }
        updateUptime();
        setInterval(updateUptime, 60000);

        // ── SpawnKit Integration for Agent OS Names ─────────────────────
        function handleSubagentsUpdate(subagents) {
            if (!subagents || !Array.isArray(subagents)) return;
            
            // Update existing subagent cards with Agent OS names
            subagents.forEach(function(subagent) {
                if (!subagent.agentOSName) return;
                
                // Find subagent elements and update names
                document.querySelectorAll('.sub-agent-name').forEach(function(el) {
                    // Check if this element matches our subagent (by parent or task context)
                    var card = el.closest('.org-sub-card');
                    if (card && window.AgentOSNaming) {
                        var displayName = window.AgentOSNaming.displayName(subagent.agentOSName, 'full');
                        el.textContent = displayName;
                        
                        // Add model badge if available
                        if (subagent.model && window.ModelIdentity) {
                            var modelIdentity = window.ModelIdentity.getIdentity(subagent.model);
                            var roleEl = card.querySelector('.sub-agent-role');
                            if (roleEl) {
                                roleEl.innerHTML = subagent.task + ' <span class="model-badge" style="color: ' + 
                                    modelIdentity.color + '; font-size: 8px; font-weight: 600;">(' + 
                                    modelIdentity.level + ')</span>';
                            }
                        }
                    }
                });
            });
        }

        // Listen for SpawnKit data updates
        if (window.SpawnKit) {
            SpawnKit.on('data:refresh', function(data) {
                if (data.agents) handleAgentsUpdate(data.agents);
                if (data.subagents) handleSubagentsUpdate(data.subagents);
            });
        }

        // Wire up live data if available
        if (window.SpawnKit && window.SpawnKit.mode === 'live') {
            SpawnKit.on('data:refresh', function(data) {
                if (typeof handleDataUpdate === 'function') handleDataUpdate(data);
            });
            SpawnKit.refresh();
        }

        /* ═══════════════════════════════════════════════
           Missions Panel (NEW #2)
           ═══════════════════════════════════════════════ */
        var missionsOverlay = document.getElementById('missionsOverlay');
        var missionsBackdropEl = document.getElementById('missionsBackdrop');
        var missionsCloseBtn = document.getElementById('missionsClose');
        var missionsBody = document.getElementById('missionsBody');

        function openMissionsPanel() {
            closeAllPanels();
            missionsOverlay.classList.add('open');
            document.body.style.overflow = 'hidden';
            renderMissions();
        }
        function closeMissionsPanel() {
            missionsOverlay.classList.remove('open');
            document.body.style.overflow = '';
        }

        document.getElementById('missionsBtn').addEventListener('click', openMissionsPanel);
        missionsBackdropEl.addEventListener('click', closeMissionsPanel);
        missionsCloseBtn.addEventListener('click', closeMissionsPanel);

        async function renderMissions() {
            var missions = [];
            if (!API) {
                // #6 — Demo missions
                missions = DEMO.missions;
            } else {
                try {
                    var sessions = await API.getSessions();
                    var subagents = sessions.subagents || [];
                    missions = subagents.map(function(sa) {
                        return {name:sa.name||sa.label||sa.id, parent:sa.parentAgent||'main', progress:sa.progress||0.5, status:sa.status, label:sa.task||'', duration:sa.durationMs?Math.floor(sa.durationMs/60000)+'m':'—'};
                    });
                } catch(e) {
                    missionsBody.innerHTML = '<div class="cron-empty">Error loading missions: ' + e.message + '</div>';
                    return;
                }
            }

            if (missions.length === 0) {
                missionsBody.innerHTML = '<div class="cron-empty">No active missions. All quiet.</div>';
                return;
            }

            var running = missions.filter(function(m){return m.status==='running';});
            var completed = missions.filter(function(m){return m.status==='completed';});
            var html = '';

            if (running.length > 0) {
                html += '<div class="cron-group"><div class="cron-group-title">🔴 Active (' + running.length + ')</div>';
                running.forEach(function(m) {
                    var pct = Math.round(m.progress * 100);
                    html += '<div class="cron-item">';
                    html += '<span class="cron-item-icon">🚀</span>';
                    html += '<div class="cron-item-info">';
                    html += '<div class="cron-item-name">' + m.name + '</div>';
                    html += '<div class="cron-item-schedule">' + m.label + '</div>';
                    html += '<div class="mission-meta"><span>Parent: ' + m.parent + '</span><span>•</span><span>' + m.duration + '</span></div>';
                    html += '<div class="mission-progress-bar"><div class="mission-progress-fill mission-progress-fill--active" style="width:' + pct + '%"></div></div>';
                    html += '</div>';
                    html += '<span class="cron-item-status cron-item-status--active">' + pct + '%</span>';
                    html += '</div>';
                });
                html += '</div>';
            }

            if (completed.length > 0) {
                html += '<div class="cron-group"><div class="cron-group-title">✅ Completed (' + completed.length + ')</div>';
                completed.forEach(function(m) {
                    html += '<div class="cron-item" style="opacity:0.7">';
                    html += '<span class="cron-item-icon">✅</span>';
                    html += '<div class="cron-item-info">';
                    html += '<div class="cron-item-name">' + m.name + '</div>';
                    html += '<div class="cron-item-schedule">' + m.label + '</div>';
                    html += '<div class="mission-meta"><span>Parent: ' + m.parent + '</span><span>•</span><span>' + m.duration + '</span></div>';
                    html += '<div class="mission-progress-bar"><div class="mission-progress-fill mission-progress-fill--done" style="width:100%"></div></div>';
                    html += '</div>';
                    html += '<span class="cron-item-status" style="color:var(--status-active);">Done</span>';
                    html += '</div>';
                });
                html += '</div>';
            }

            missionsBody.innerHTML = html;
        }

        // Auto-refresh missions every 15s when open
        setInterval(function() {
            if (missionsOverlay.classList.contains('open')) renderMissions();
        }, 15000);

        /* ═══════════════════════════════════════════════
           Settings Panel (NEW #3: API Keys + NEW #5: Mapping)
           ═══════════════════════════════════════════════ */
        var settingsOverlay = document.getElementById('settingsOverlay');
        var settingsBackdropEl = document.getElementById('settingsBackdrop');
        var settingsCloseBtn = document.getElementById('settingsClose');
        var settingsBody = document.getElementById('settingsBody');

        function openSettingsPanel() {
            closeAllPanels();
            settingsOverlay.classList.add('open');
            document.body.style.overflow = 'hidden';
            renderSettings();
        }
        function closeSettingsPanel() {
            settingsOverlay.classList.remove('open');
            document.body.style.overflow = '';
        }

        document.getElementById('settingsBtn').addEventListener('click', openSettingsPanel);
        settingsBackdropEl.addEventListener('click', closeSettingsPanel);
        settingsCloseBtn.addEventListener('click', closeSettingsPanel);

        async function renderSettings() {
            var html = '';

            // API Keys section (NEW #3)
            html += '<div class="cron-group"><div class="cron-group-title">🔑 API Keys</div>';
            
            var providers = ['anthropic', 'openai', 'elevenlabs', 'google'];
            var providerLabels = { anthropic: 'Anthropic', openai: 'OpenAI', elevenlabs: 'ElevenLabs', google: 'Google' };
            var providerPrefixes = { anthropic: 'sk-ant-', openai: 'sk-', elevenlabs: '', google: '' };
            
            var currentKeys = {};
            if (API) {
                try { currentKeys = await API.getApiKeys(); } catch(e) {}
            }

            providers.forEach(function(prov) {
                var info = currentKeys[prov] || {};
                var masked = info.hasKey ? info.masked : 'Not set';
                var hasKey = info.hasKey || false;
                
                html += '<div class="cron-item" style="flex-wrap:wrap;">';
                html += '<div class="cron-item-info" style="flex:1;min-width:150px;">';
                html += '<div class="cron-item-name">' + providerLabels[prov] + '</div>';
                html += '<div class="cron-item-schedule" style="font-family:monospace;font-size:11px;">' + masked + '</div>';
                html += '</div>';
                html += '<div style="display:flex;gap:4px;align-items:center;">';
                html += '<input type="password" id="apikey-' + prov + '" placeholder="' + (providerPrefixes[prov] || '') + '..." style="width:160px;padding:4px 8px;border-radius:6px;border:1px solid var(--border-medium);font-size:11px;font-family:monospace;background:var(--bg-tertiary);color:var(--text-primary);" />';
                html += '<button class="apikey-save-btn" data-provider="' + prov + '" style="padding:4px 10px;border-radius:6px;border:none;background:var(--exec-blue);color:#fff;font-size:11px;cursor:pointer;font-weight:500;">Save</button>';
                if (hasKey) {
                    html += '<button class="apikey-delete-btn" data-provider="' + prov + '" style="padding:4px 8px;border-radius:6px;border:1px solid var(--status-error);background:transparent;color:var(--status-error);font-size:11px;cursor:pointer;">🗑️</button>';
                }
                html += '</div>';
                html += '</div>';
            });
            html += '</div>';

            // OpenClaw ↔ SpawnKit Mapping (NEW #5)
            html += '<div class="cron-group"><div class="cron-group-title">🗺️ OpenClaw ↔ SpawnKit Mapping</div>';
            var mappings = [
                { openclaw: 'Skills', spawnkit: 'Skills Panel', icon: '⚡' },
                { openclaw: 'Cron Jobs', spawnkit: 'Calendar / Crons', icon: '📅' },
                { openclaw: 'Sessions', spawnkit: 'Agents / Rooms', icon: '👥' },
                { openclaw: 'Memory (MEMORY.md)', spawnkit: 'Memory Panel', icon: '🧠' },
                { openclaw: 'Tools', spawnkit: 'Skills (extended)', icon: '🔧' },
                { openclaw: 'Sub-agents', spawnkit: 'Missions / Boardroom', icon: '🎯' },
                { openclaw: 'Workspace', spawnkit: 'Fleet Directory', icon: '📁' }
            ];
            
            html += '<div style="display:grid;grid-template-columns:auto 24px auto;gap:6px 12px;align-items:center;padding:8px 0;">';
            html += '<div style="font-size:10px;font-weight:600;color:var(--text-tertiary);text-transform:uppercase;letter-spacing:0.5px;">OpenClaw</div>';
            html += '<div></div>';
            html += '<div style="font-size:10px;font-weight:600;color:var(--text-tertiary);text-transform:uppercase;letter-spacing:0.5px;">SpawnKit</div>';
            mappings.forEach(function(m) {
                html += '<div style="font-size:13px;padding:4px 0;">' + m.icon + ' ' + m.openclaw + '</div>';
                html += '<div style="font-size:12px;color:var(--exec-blue);text-align:center;">→</div>';
                html += '<div style="font-size:13px;padding:4px 0;color:var(--text-secondary);">' + m.spawnkit + '</div>';
            });
            html += '</div>';
            html += '</div>';

            // #15 — Installed Skills list
            html += '<div class="cron-group"><div class="cron-group-title">⚡ Installed Skills (' + DEMO.skills.length + ')</div>';
            html += '<div class="skills-list-grid">';
            DEMO.skills.forEach(function(sk) {
                html += '<div class="skill-list-item">';
                html += '<span class="skill-list-item-check">☑</span>';
                html += '<span class="skill-list-item-name">' + sk.icon + ' ' + sk.name + '</span>';
                html += '<span class="skill-list-item-desc">' + sk.desc + '</span>';
                html += '</div>';
            });
            html += '</div></div>';

            settingsBody.innerHTML = html;

            // Wire up API key save buttons
            document.querySelectorAll('.apikey-save-btn').forEach(function(btn) {
                btn.addEventListener('click', async function() {
                    var prov = btn.dataset.provider;
                    var input = document.getElementById('apikey-' + prov);
                    var key = input ? input.value.trim() : '';
                    if (!key) { showToast('Please enter an API key'); return; }
                    if (API) {
                        var result = await API.saveApiKey(prov, key);
                        if (result && result.success) {
                            showToast('✅ ' + providerLabels[prov] + ' key saved');
                            input.value = '';
                            renderSettings();
                        } else {
                            showToast('⚠️ Failed: ' + (result.error || 'unknown'));
                        }
                    }
                });
            });

            // Wire up API key delete buttons
            document.querySelectorAll('.apikey-delete-btn').forEach(function(btn) {
                btn.addEventListener('click', async function() {
                    var prov = btn.dataset.provider;
                    if (API) {
                        var result = await API.deleteApiKey(prov);
                        if (result && result.success) {
                            showToast('🗑️ ' + providerLabels[prov] + ' key deleted');
                            renderSettings();
                        }
                    }
                });
            });
        }

        /* ═══════════════════════════════════════════════
           Decommission Animation (NEW #7)
           ═══════════════════════════════════════════════ */
        var previousSubagentIds = new Set();
        
        function checkForDecommissions() {
            if (!API) return;
            API.getSessions().then(function(sessions) {
                var currentIds = new Set((sessions.subagents || []).filter(function(sa) { return sa.status === 'running'; }).map(function(sa) { return sa.id; }));
                
                // Find decommissioned (was running, now gone)
                previousSubagentIds.forEach(function(oldId) {
                    if (!currentIds.has(oldId)) {
                        // Find the name from previous data
                        var sa = (sessions.subagents || []).find(function(s) { return s.id === oldId; });
                        var name = sa ? (sa.name || sa.label || oldId) : oldId;
                        triggerDecommission(name);
                    }
                });
                
                previousSubagentIds = currentIds;
            }).catch(function() {});
        }
        
        function triggerDecommission(agentName) {
            // Show toast
            showToast('🔥 ' + agentName + ' decommissioned');
            
            // Find and animate any matching org-sub-card
            document.querySelectorAll('.org-sub-card').forEach(function(card) {
                var nameEl = card.querySelector('.sub-agent-name');
                if (nameEl && nameEl.textContent.toLowerCase().includes(agentName.toLowerCase().split('-')[0])) {
                    card.classList.add('decommission-anim');
                    
                    // Add particles
                    var rect = card.getBoundingClientRect();
                    for (var p = 0; p < 8; p++) {
                        var particle = document.createElement('div');
                        particle.className = 'decommission-particle';
                        particle.style.left = (rect.left + Math.random() * rect.width) + 'px';
                        particle.style.top = (rect.top + Math.random() * rect.height) + 'px';
                        particle.style.animationDelay = (Math.random() * 200) + 'ms';
                        document.body.appendChild(particle);
                        setTimeout(function() { particle.remove(); }, 800);
                    }
                    
                    // Remove card after animation
                    setTimeout(function() { card.remove(); }, 800);
                }
            });
        }
        
        // Check for decommissions every 10s
        setInterval(checkForDecommissions, 10000);
        // Initialize the set
        if (API) {
            API.getSessions().then(function(sessions) {
                (sessions.subagents || []).filter(function(sa) { return sa.status === 'running'; }).forEach(function(sa) {
                    previousSubagentIds.add(sa.id);
                });
            }).catch(function() {});
        }

        /* ═══════════════════════════════════════════════
           Update meeting room preview on load (FIX #7)
           ═══════════════════════════════════════════════ */
        async function updateMeetingPreview() {
            var preview = document.getElementById('meetingPreview');
            var count = document.getElementById('meetingCount');
            if (!preview || !API) return;
            
            try {
                var active = await API.getActiveSubagents();
                if (active && active.length > 0) {
                    if (count) count.textContent = active.length;
                    preview.innerHTML = active.slice(0, 2).map(function(sa) {
                        return '<div class="meeting-active">🔴 ' + (sa.label || 'sub-agent') + '</div>';
                    }).join('');
                    if (active.length > 2) {
                        preview.innerHTML += '<div class="meeting-active" style="opacity:0.6">+' + (active.length - 2) + ' more</div>';
                    }
                } else {
                    if (count) count.textContent = '0';
                    preview.innerHTML = '<div class="meeting-active" style="opacity:0.5">💤 No active sessions</div>';
                }
            } catch(e) {
                preview.innerHTML = '<div class="meeting-active" style="opacity:0.5">—</div>';
            }
        }
        updateMeetingPreview();
        setInterval(updateMeetingPreview, 15000);

        /* Update closeAllPanels to include new panels */
        var _origCloseAll = closeAllPanels;
        closeAllPanels = function() {
            _origCloseAll();
            closeMissionsPanel();
            closeSettingsPanel();
        };

        /* ═══════════════════════════════════════════════
           FIX #1 SS+: Real-Time Log Viewer
           ═══════════════════════════════════════════════ */
        var logsOverlay = document.getElementById('logsOverlay');
        var logsBackdropEl = document.getElementById('logsBackdrop');
        var logsCloseBtn = document.getElementById('logsClose');
        var logsBody = document.getElementById('logsBody');
        var logsFilter = document.getElementById('logsFilter');
        var logsAutoRefresh = null;

        function openLogsPanel() {
            closeAllPanels();
            logsOverlay.classList.add('open');
            document.body.style.overflow = 'hidden';
            renderLogs();
            // Start auto-refresh every 5s
            logsAutoRefresh = setInterval(renderLogs, 5000);
        }
        function closeLogsPanel() {
            logsOverlay.classList.remove('open');
            document.body.style.overflow = '';
            if (logsAutoRefresh) { clearInterval(logsAutoRefresh); logsAutoRefresh = null; }
        }

        document.getElementById('logsBtn').addEventListener('click', openLogsPanel);
        logsBackdropEl.addEventListener('click', closeLogsPanel);
        logsCloseBtn.addEventListener('click', closeLogsPanel);
        logsFilter.addEventListener('change', renderLogs);

        async function renderLogs() {
            var filterAgent = logsFilter.value;
            var logs = [];

            if (!API) {
                // DEMO MODE: use realistic demo logs
                if (filterAgent === 'all') {
                    var agentIds = ['ceo','forge','atlas','hunter','echo','sentinel'];
                    agentIds.forEach(function(id) {
                        (DEMO.logs[id]||[]).forEach(function(e) { var c = Object.assign({},e); c._agent = id; logs.push(c); });
                    });
                    logs.sort(function(a,b){return b.timestamp-a.timestamp;});
                } else {
                    (DEMO.logs[filterAgent]||[]).forEach(function(e) { var c = Object.assign({},e); c._agent = filterAgent; logs.push(c); });
                }
            } else {
                try {
                    if (filterAgent === 'all') {
                        var agentIds2 = ['ceo','forge','atlas','hunter','echo','sentinel'];
                        var promises = agentIds2.map(function(id) {
                            return API.getAgentLogs(id, 15).then(function(entries) {
                                return entries.map(function(e) { e._agent = id; return e; });
                            }).catch(function() { return []; });
                        });
                        var allResults = await Promise.all(promises);
                        allResults.forEach(function(entries) { logs = logs.concat(entries); });
                        logs.sort(function(a,b){return (b.timestamp||0)-(a.timestamp||0);});
                        logs = logs.slice(0, 50);
                    } else {
                        logs = await API.getAgentLogs(filterAgent, 50);
                        logs.forEach(function(e) { e._agent = filterAgent; });
                    }
                } catch(e) {
                    logsBody.innerHTML = '<div class="logs-empty">Error loading logs: ' + e.message + '</div>';
                    return;
                }
            }

            if (logs.length === 0) {
                logsBody.innerHTML = '<div class="logs-empty">No log entries found' +
                    (filterAgent !== 'all' ? ' for ' + filterAgent : '') + '</div>';
                document.getElementById('logsCount').textContent = '0 entries';
                return;
            }

            // #1 — Metrics header
            var metricsAgent = filterAgent === 'all' ? 'ceo' : filterAgent;
            var met = DEMO.logMetrics[metricsAgent] || {tokens:'—',model:'—',uptime:'—',tasks:0};
            var html = '<div class="logs-metrics-bar">';
            html += '<div class="logs-metric-card"><div class="logs-metric-card-value">' + met.tokens + '</div><div class="logs-metric-card-label">Tokens</div></div>';
            html += '<div class="logs-metric-card"><div class="logs-metric-card-value">' + met.model + '</div><div class="logs-metric-card-label">Model</div></div>';
            html += '<div class="logs-metric-card"><div class="logs-metric-card-value">' + met.uptime + '</div><div class="logs-metric-card-label">Uptime</div></div>';
            html += '<div class="logs-metric-card"><div class="logs-metric-card-value">' + met.tasks + '</div><div class="logs-metric-card-label">Tasks</div></div>';
            html += '</div>';

            logs.forEach(function(entry) {
                var ts = entry.timestamp ? new Date(entry.timestamp) : null;
                var timeStr = ts ? ts.toLocaleTimeString('en-GB', {hour:'2-digit',minute:'2-digit',second:'2-digit'}) : '—';
                var role = entry.role || 'unknown';
                var roleClass = role==='user'?'log-role--user':role==='assistant'?'log-role--assistant':role==='error'?'log-role--error':'log-role--system';
                var text = (entry.text||'').replace(/</g,'&lt;').replace(/>/g,'&gt;');
                if (text.length > 120) text = text.substring(0,120) + '…';
                var agentBadge = entry._agent && filterAgent === 'all' ?
                    '<span style="font-size:10px;padding:1px 5px;border-radius:3px;background:rgba(0,122,255,0.08);color:var(--exec-blue);font-weight:600;text-transform:uppercase;letter-spacing:0.3px;margin-right:4px;">'+entry._agent+'</span>' : '';
                html += '<div class="log-entry">';
                html += '<span class="log-time">' + timeStr + '</span>';
                html += '<span class="log-role ' + roleClass + '">' + role + '</span>';
                html += '<span class="log-text">' + agentBadge + text + '</span>';
                html += '</div>';
            });

            logsBody.innerHTML = html;
            document.getElementById('logsCount').textContent = logs.length + ' entries';
            logsBody.scrollTop = 0;
        }

        /* FIX #17/#10: Idle state now handled by #10 initIdleVisuals below */

        /* ═══════════════════════════════════════════════
           FIX #9 SS+: Enhanced Agent Builder (works in demo mode)
           ═══════════════════════════════════════════════ */
        var _origOpenDetailPanel = openDetailPanel;
        openDetailPanel = async function(agentId) {
            await _origOpenDetailPanel(agentId);
            
            var agent = AGENTS[agentId];
            if (!agent) return;
            
            var editBtn = document.getElementById('editAgentBtn');
            if (!editBtn) return;

            var newEditBtn = editBtn.cloneNode(true);
            editBtn.parentNode.replaceChild(newEditBtn, editBtn);
            
            newEditBtn.addEventListener('click', function() {
                var soulPreview = document.querySelector('.detail-soul-preview');
                if (!soulPreview) return;
                var parentSection = soulPreview.parentElement;
                
                var brandColors = ['#007AFF','#BF5AF2','#FF9F0A','#FF453A','#0A84FF','#30D158','#7C3AED','#06B6D4','#EC4899','#F59E0B'];
                var currentColor = agent.color || '#007AFF';
                var isCeoEdit = agentId === 'ceo';

                var editHtml = '<div class="detail-section-title">✏️ ' + (isCeoEdit ? 'Edit Display' : 'Edit Agent') + '</div>';
                editHtml += '<div class="detail-editor-section">';

                // Name
                editHtml += '<div class="detail-editor-field"><label class="detail-editor-label">Display Name</label>';
                editHtml += '<input type="text" class="detail-editor-input" id="editName" value="' + (agent.name||'') + '" /></div>';

                if (!isCeoEdit) {
                    // Role
                    editHtml += '<div class="detail-editor-field"><label class="detail-editor-label">Role</label>';
                    editHtml += '<input type="text" class="detail-editor-input" id="editRole" value="' + (agent.role||'') + '" /></div>';
                    // Traits
                    editHtml += '<div class="detail-editor-field"><label class="detail-editor-label">Traits</label>';
                    editHtml += '<input type="text" class="detail-editor-input" id="editTraits" placeholder="e.g. meticulous, strategic" /></div>';
                    // #9 — Model Dropdown
                    editHtml += '<div class="detail-editor-field"><label class="detail-editor-label">Model</label>';
                    editHtml += '<select class="detail-editor-select" id="editModel">';
                    editHtml += '<option value="claude-opus-4">Claude Opus 4</option>';
                    editHtml += '<option value="claude-sonnet-4">Claude Sonnet 4</option>';
                    editHtml += '<option value="claude-haiku-3.5">Claude Haiku 3.5</option>';
                    editHtml += '</select></div>';
                    // #9 — Spawn Priority
                    editHtml += '<div class="detail-editor-field"><label class="detail-editor-label">Spawn Priority</label>';
                    editHtml += '<select class="detail-editor-select" id="editPriority">';
                    editHtml += '<option value="high">🔴 High</option>';
                    editHtml += '<option value="normal" selected>🟡 Normal</option>';
                    editHtml += '<option value="low">🟢 Low</option>';
                    editHtml += '</select></div>';
                    // #9 — Session Target
                    editHtml += '<div class="detail-editor-field"><label class="detail-editor-label">Session Target</label>';
                    editHtml += '<select class="detail-editor-select" id="editSession">';
                    editHtml += '<option value="main">Main Session</option>';
                    editHtml += '<option value="isolated">Isolated</option>';
                    editHtml += '</select></div>';
                    // #9 — Skills checkboxes
                    editHtml += '<div class="detail-editor-field"><label class="detail-editor-label">Skills</label>';
                    var agSkills = DEMO.agentSkills[agentId] || [];
                    DEMO.skills.forEach(function(sk) {
                        var checked = agSkills.indexOf(sk.name) >= 0 ? ' checked' : '';
                        editHtml += '<div class="detail-skill-checkbox"><input type="checkbox"' + checked + ' data-skill="' + sk.name + '" /> ' + sk.icon + ' ' + sk.name + '<span class="detail-skill-checkbox-desc">' + sk.desc + '</span></div>';
                    });
                    editHtml += '</div>';
                }

                // Color
                editHtml += '<div class="detail-editor-field"><label class="detail-editor-label">Brand Color</label>';
                editHtml += '<div class="detail-color-picker-row" id="colorPickerRow">';
                brandColors.forEach(function(c) {
                    editHtml += '<div class="detail-color-swatch' + (c===currentColor?' selected':'') + '" data-color="' + c + '" style="background:' + c + '"></div>';
                });
                editHtml += '</div></div>';

                // Save / Cancel
                editHtml += '<div class="detail-save-bar">';
                editHtml += '<button class="detail-save-btn" id="saveEditBtn">💾 Save</button>';
                editHtml += '<button class="detail-cancel-btn" id="cancelEditBtn">Cancel</button>';
                editHtml += '</div></div>';

                parentSection.innerHTML = editHtml;
                newEditBtn.style.display = 'none';

                // Color picker interaction
                document.querySelectorAll('#colorPickerRow .detail-color-swatch').forEach(function(s){
                    s.addEventListener('click',function(){
                        document.querySelectorAll('#colorPickerRow .detail-color-swatch').forEach(function(x){x.classList.remove('selected');});
                        s.classList.add('selected');
                    });
                });

                document.getElementById('cancelEditBtn').addEventListener('click', function() {
                    openDetailPanel(agentId);
                });
                document.getElementById('saveEditBtn').addEventListener('click', async function() {
                    if (API) {
                        var saveData = {name:document.getElementById('editName').value.trim()};
                        if (!isCeoEdit) {
                            saveData.role = document.getElementById('editRole').value.trim();
                            saveData.traits = document.getElementById('editTraits').value.trim();
                        }
                        try {
                            var result = await API.saveAgentSoul(agentId, saveData);
                            if (result && result.success) {
                                showToast('✅ Agent updated');
                                setTimeout(function(){openDetailPanel(agentId);},800);
                                return;
                            }
                        } catch(e) {}
                    }
                    // Demo mode — just show success
                    showToast('✅ Changes saved (demo mode)');
                    setTimeout(function(){openDetailPanel(agentId);},800);
                });
            });
        };

        /* Update closeAllPanels to include logs */
        var _prevCloseAll = closeAllPanels;
        closeAllPanels = function() {
            _prevCloseAll();
            closeLogsPanel();
        };

        /* ═══════════════════════════════════════════════
           #10 — Idle agents visual + timer (demo mode)
           ═══════════════════════════════════════════════ */
        (function initIdleVisuals() {
            // In demo mode, Echo is idle. Apply enhanced idle visuals.
            var idleAgents = ['echo']; // Can add more
            var idleSince = Date.now() - (15*60000); // 15 min ago

            function updateIdleTimers() {
                idleAgents.forEach(function(id) {
                    document.querySelectorAll('.exec-room[data-agent="' + id + '"]').forEach(function(room) {
                        room.classList.add('room-idle');
                        // Add coffee label
                        if (!room.querySelector('.agent-idle-coffee')) {
                            var c = document.createElement('span');
                            c.className = 'agent-idle-coffee';
                            c.innerHTML = '☕ On break';
                            var r = room.querySelector('.agent-role');
                            if (r) r.parentNode.insertBefore(c, r.nextSibling);
                        }
                        // Add/update timer
                        var timer = room.querySelector('.idle-timer');
                        if (!timer) {
                            timer = document.createElement('span');
                            timer.className = 'idle-timer';
                            var coffee = room.querySelector('.agent-idle-coffee');
                            if (coffee) coffee.parentNode.insertBefore(timer, coffee.nextSibling);
                        }
                        var elapsed = Math.floor((Date.now() - idleSince) / 60000);
                        timer.textContent = 'Last active: ' + elapsed + 'm ago';
                        // Tooltip
                        room.title = AGENTS[id].name + ' — Idle since ' + new Date(idleSince).toLocaleTimeString('en-GB',{hour:'2-digit',minute:'2-digit'});
                        // Overlay
                        if (!room.querySelector('.room-idle-overlay')) {
                            var o = document.createElement('div');
                            o.className = 'room-idle-overlay';
                            room.appendChild(o);
                        }
                    });
                    // Hierarchy cards
                    document.querySelectorAll('.org-card[data-agent="' + id + '"]').forEach(function(card){
                        card.style.opacity = '0.65';
                        card.style.filter = 'saturate(0.7)';
                    });
                });
            }
            updateIdleTimers();
            setInterval(updateIdleTimers, 60000);
        })();

        /* ═══════════════════════════════════════════════
           #12 — Mailbox real-time: new message every 30s
           ═══════════════════════════════════════════════ */
        (function initMailboxRealtime() {
            if (API) return; // Only in demo mode
            var demoNewMsgs = [
                {sender:'Forge',color:'#FF9F0A',text:'Point #7 cron timeline added. 12/18 complete.',priority:'normal'},
                {sender:'Sentinel',color:'#30D158',text:'Pre-deploy security scan — no issues found.',priority:'info'},
                {sender:'Atlas',color:'#BF5AF2',text:'FeedCast bot health check: OK. 99.9% uptime.',priority:'info'},
                {sender:'Hunter',color:'#FF453A',text:'New competitor spotted: "CrewAI" — similar positioning.',priority:'normal'},
                {sender:'Kira',color:'#FF2D55',text:'Ca avance ? Je veux un update.',priority:'urgent'},
            ];
            var msgIdx = 0;
            
            // Add notification dot to mailbox button
            var mbBtn = document.getElementById('mailboxBtn');
            if (mbBtn) { mbBtn.style.position = 'relative'; }

            setInterval(function() {
                var msg = demoNewMsgs[msgIdx % demoNewMsgs.length];
                msgIdx++;
                var now = new Date();
                var newMsg = {
                    sender: msg.sender,
                    color: msg.color,
                    time: now.getHours().toString().padStart(2,'0') + ':' + now.getMinutes().toString().padStart(2,'0'),
                    text: msg.text,
                    read: false,
                    priority: msg.priority,
                    assignedTo: null
                };
                LIVE_MESSAGES.unshift(newMsg);
                if (LIVE_MESSAGES.length > 10) LIVE_MESSAGES.pop();
                renderMessages(LIVE_MESSAGES);

                // Pulse notification on mailbox
                if (mbBtn && !mbBtn.querySelector('.mailbox-notif-dot')) {
                    var dot = document.createElement('div');
                    dot.className = 'mailbox-notif-dot';
                    mbBtn.appendChild(dot);
                    setTimeout(function() { if (dot.parentNode) dot.remove(); }, 5000);
                }
            }, 30000);
        })();

        /* ═══════════════════════════════════════════════
           #13 — Mailbox dispatch detail view
           ═══════════════════════════════════════════════ */
        (function initMailboxDetail() {
            // Event delegation: click on mail-item shows detail
            document.getElementById('mailboxMessages').addEventListener('click', function(e) {
                var item = e.target.closest('.mail-item');
                if (!item) return;
                var idx = parseInt(item.dataset.messageIndex);
                if (isNaN(idx) || !LIVE_MESSAGES[idx]) return;
                var msg = LIVE_MESSAGES[idx];

                // Mark as read
                msg.read = true;
                updateMailboxBadge();

                // Build detail view
                var priClass = msg.priority === 'urgent' ? 'urgent' : msg.priority === 'info' ? 'info' : 'normal';
                var priLabel = msg.priority === 'urgent' ? '🔴 Urgent' : msg.priority === 'info' ? '🟢 Info' : '🟡 Normal';
                var dispatchTarget = msg.assignedTo || 'Unassigned';
                var dispatchStatus = msg.assignedTo ? '✅ Delivered' : '⏳ Pending';

                var dHtml = '<div class="mail-detail-view">';
                dHtml += '<div class="mail-detail-header">';
                dHtml += '<button class="mail-detail-back" id="mailDetailBack">←</button>';
                dHtml += '<span class="mail-detail-sender">' + msg.sender + '</span>';
                dHtml += '<span class="mail-detail-time">' + msg.time + '</span>';
                dHtml += '</div>';
                dHtml += '<div class="mail-detail-body">' + msg.text + '</div>';
                dHtml += '<div class="mail-detail-priority mail-detail-priority--' + priClass + '">' + priLabel + '</div>';
                dHtml += '<div class="mail-detail-dispatch">';
                dHtml += '<span>📨 Dispatched to:</span>';
                dHtml += '<span class="mail-detail-dispatch-arrow">→</span>';
                dHtml += '<span class="mail-detail-dispatch-target">' + dispatchTarget + '</span>';
                dHtml += '<span class="mail-detail-dispatch-status">' + dispatchStatus + '</span>';
                dHtml += '</div>';
                dHtml += '</div>';

                var container = document.getElementById('mailboxMessages');
                container.innerHTML = dHtml;

                document.getElementById('mailDetailBack').addEventListener('click', function() {
                    renderMessages(LIVE_MESSAGES);
                });
            });
        })();

        /* ═══════════════════════════════════════════════
           #18 — Demo decommission every 60s
           ═══════════════════════════════════════════════ */
        (function initDemoDecommission() {
            if (API) return; // Only demo mode
            var names = DEMO.subAgentNames.slice();
            var idx = 0;
            setInterval(function() {
                var name = names[idx % names.length];
                idx++;
                // Toast
                showToast('🔥 ' + name + ' decommissioned');
                // Flash overlay
                var flash = document.createElement('div');
                flash.className = 'decommission-overlay-flash';
                document.body.appendChild(flash);
                setTimeout(function(){flash.remove();}, 600);
                // Particles from center of screen
                var cx = window.innerWidth/2, cy = window.innerHeight/2;
                for (var p = 0; p < 12; p++) {
                    var particle = document.createElement('div');
                    particle.className = 'decommission-particle';
                    var angle = (p / 12) * Math.PI * 2;
                    var dist = 40 + Math.random() * 60;
                    particle.style.left = (cx + Math.cos(angle) * dist) + 'px';
                    particle.style.top = (cy + Math.sin(angle) * dist) + 'px';
                    particle.style.background = ['#FF453A','#FF9F0A','#FFD60A','#007AFF'][Math.floor(Math.random()*4)];
                    particle.style.width = (3+Math.random()*4) + 'px';
                    particle.style.height = particle.style.width;
                    document.body.appendChild(particle);
                    setTimeout(function(){particle.remove();}, 800);
                }
            }, 60000);
        })();

        /* ═══════════════════════════════════════════════
           #14 — Meeting room preview (demo)
           ═══════════════════════════════════════════════ */
        (function initMeetingPreviewDemo() {
            if (API) return;
            var preview = document.getElementById('meetingPreview');
            var count = document.getElementById('meetingCount');
            if (preview) {
                preview.innerHTML = '<div class="meeting-active">🔴 forge-executive-ss-plus</div><div class="meeting-active">🔴 sentinel-audit-executive</div>';
            }
            if (count) count.textContent = '2';
        })();

        /* Update Escape handler for logs panel */
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && logsOverlay.classList.contains('open')) {
                closeLogsPanel();
                e.stopImmediatePropagation();
            }
        });

        document.addEventListener('DOMContentLoaded', function() {
            if (typeof SpawnKitUX !== 'undefined') {
                SpawnKitUX.init({ theme: 'executive' });
            }
            if (typeof OpenClawHelpers !== 'undefined') {
                OpenClawHelpers.init({ theme: 'executive' });
            }
            if (typeof initThemeSwitcher === 'function') {
                initThemeSwitcher();
            }
            if (typeof SpawnKitUX !== 'undefined') {
                SpawnKitUX.ready();
            }
        });

    })();
    </script>

</body>
</html>