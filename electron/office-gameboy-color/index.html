<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpawnKit v2 - GameBoy Color Office</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        body {
            margin: 0;
            padding: 20px;
            background: #1a1a2e;
            color: #e2c275;
            font-family: 'Press Start 2P', 'Monaco', monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 1px 1px, #16213e 1px, transparent 0);
            background-size: 4px 4px;
        }
        
        h1 {
            margin-bottom: 20px;
            color: #e2c275;
            text-align: center;
            font-size: 16px;
            text-shadow: 2px 2px 0px #0f3460;
            border: 3px solid #53868b;
            padding: 10px 20px;
            background: #16213e;
        }
        
        #gameContainer {
            border: 4px solid #53868b;
            border-radius: 0;
            background: #1a1a2e;
            position: relative;
            box-shadow: 
                inset -2px -2px 0px #0f3460,
                inset 2px 2px 0px #53868b;
        }
        
        #gameContainer canvas {
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }
        
        #gameHUD {
            margin-top: 12px;
            font-size: 9px;
            color: #53868b;
            text-align: center;
            max-width: 800px;
            background: #1a1a2e;
            border: 3px solid #53868b;
            border-radius: 4px;
            padding: 10px 16px;
            font-family: 'Press Start 2P', monospace;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            box-shadow: 0 0 10px rgba(83, 134, 139, 0.3);
        }
        
        .hud-item {
            white-space: nowrap;
        }
        
        .hud-sep {
            color: #0f3460;
            font-size: 10px;
        }
        
        #missionPanel {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 220px;
            background: #16213e;
            border: 3px solid #53868b;
            padding: 10px;
            font-size: 8px;
            color: #e2c275;
            box-shadow: 
                inset -1px -1px 0px #1a1a2e,
                inset 1px 1px 0px #53868b;
        }
        
        #missionPanel h3 {
            margin: 0 0 10px 0;
            font-size: 10px;
            text-align: center;
            color: #e2c275;
        }
        
        .mission-item {
            margin: 8px 0;
            padding: 4px;
            background: #1a1a2e;
            border: 1px solid #53868b;
        }
        
        .progress-bar {
            width: 100%;
            height: 6px;
            background: #1a1a2e;
            border: 1px solid #53868b;
            margin-top: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: #e2c275;
            transition: width 0.5s ease;
        }
        
        /* ‚îÄ‚îÄ Pok√©mon HP Bar ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        .hp-bar {
            width: 100%;
            height: 4px;
            background: #1a1a2e;
            border: 1px solid #53868b;
            margin-top: 2px;
            overflow: hidden;
            position: relative;
        }
        .hp-bar::before {
            content: 'HP';
            position: absolute;
            left: -18px;
            top: -2px;
            font-size: 5px;
            color: #e2c275;
        }
        .hp-fill {
            height: 100%;
            transition: width 0.5s ease, background 0.5s ease;
        }
        .hp-fill.hp-green  { background: #5cb85c; }
        .hp-fill.hp-yellow { background: #d4a853; }
        .hp-fill.hp-orange { background: #cc7a30; }
        .hp-fill.hp-red    { background: #c0392b; }
        
        /* ‚îÄ‚îÄ Pok√©mon System Message Box ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        #pokemonSystemBox {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 80px;
            background: #1a1a2e;
            border-top: 4px solid #53868b;
            padding: 8px 12px;
            font-size: 10px;
            color: #e2c275;
            display: flex;
            align-items: flex-start;
            overflow: hidden;
            box-shadow: inset 0 2px 0 #16213e;
        }
        #pokemonSystemBox .poke-text {
            flex: 1;
            line-height: 1.6;
            white-space: pre-wrap;
        }
        #pokemonSystemBox .poke-scroll {
            align-self: flex-end;
            animation: pokeScroll 0.8s infinite;
            font-size: 12px;
            margin-left: 4px;
        }
        @keyframes pokeScroll {
            0%, 60% { opacity: 1; transform: translateY(0); }
            30% { opacity: 1; transform: translateY(3px); }
            100% { opacity: 0; }
        }
        
        /* ‚îÄ‚îÄ Wild Encounter Notification ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        #wildEncounter {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: #1a1a2e;
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            font-size: 14px;
            color: #e2c275;
            z-index: 999;
            text-align: center;
            line-height: 2;
        }
        #wildEncounter.show {
            display: flex;
            animation: wildFlash 0.6s ease-out;
        }
        @keyframes wildFlash {
            0% { opacity: 0; }
            15% { opacity: 1; background: #e2c275; color: #1a1a2e; }
            30% { background: #1a1a2e; color: #e2c275; }
            45% { background: #53868b; color: #1a1a2e; }
            60% { background: #1a1a2e; color: #e2c275; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <h1>SPAWNKIT GAMEBOY COLOR OFFICE</h1>
    
    <div style="position: relative;">
        <div id="gameContainer"></div>
        
        <div id="missionPanel">
            <h3 id="missionPanelTitle">QUEST BOARD</h3>
            <div id="currentMissions">
                <div class="mission-item">
                    <div>Status: Ready</div>
                    <div class="hp-bar">
                        <div class="hp-fill hp-green" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Pok√©mon-style system message box -->
        <div id="pokemonSystemBox">
            <span class="poke-text" id="pokeText">SPAWNKIT COLOR OFFICE is ready for battle!</span>
            <span class="poke-scroll">‚ñº</span>
        </div>
        
        <!-- Wild encounter overlay -->
        <div id="wildEncounter"></div>
    </div>
    
    <div id="gameHUD">
        <span class="hud-item" id="hudLevel">üéÆ LV.1</span>
        <span class="hud-sep">‚îÇ</span>
        <span class="hud-item" id="hudQuests">‚ö° 0 QUESTS</span>
        <span class="hud-sep">‚îÇ</span>
        <span class="hud-item" id="hudScore">üèÜ 0pts</span>
        <span class="hud-sep">‚îÇ</span>
        <span class="hud-item" id="hudStreak">üî• 0 streak</span>
        <span class="hud-sep">‚îÇ</span>
        <span class="hud-item" id="hudAgents">üë• 5 TEAM</span>
    </div>

    <!-- PixiJS v7 from CDN -->
    <script src="../lib/pixi.min.js"></script>
    
    <!-- SpawnKit v2 Visual Polish Layer -->
    <script src="../src/favicon.js"></script>
    <script src="../src/meta-tags.js"></script>
    <script src="../src/page-title.js"></script>
    
    <!-- SpawnKit v2 Theme Names (universe-consistent naming) -->
    <script src="../src/theme-names.js"></script>
    
    <!-- SpawnKit v2 Data Bridge -->
    <script src="../src/data-bridge.js"></script>
    
    <!-- SpawnKit v2 Sprites -->
    <script src="../src/sprites.js"></script>
    
    <!-- SpawnKit v2 Mission Controller (Pok√©mon-style gameplay core) -->
    <script src="../src/mission-controller.js"></script>
    
    <!-- Boot Sequence -->
    <script src="../src/boot-sequence.js"></script>
    
    <!-- Theme Switcher -->
    <script src="../src/theme-switcher.js"></script>
    
    <!-- Responsive & Transitions (after theme switcher for patching) -->
    <script src="../src/responsive.js"></script>
    <script src="../src/transitions.js"></script>
    
    <!-- Universal UX Layer -->
    <script src="../src/ux-layer.js"></script>
    <script src="../src/achievements.js"></script>
    
    <!-- OpenClaw Integration Layer -->
    <script src="../src/openclaw-helpers.js"></script>
    
    <!-- Click Affordances & Visual Buttons -->
    <script src="../src/click-affordances.js"></script>
    
    <!-- GameBoy Color Sound & Visual Effects -->
    <script src="gameboy-effects.js"></script>
    
    <!-- GameBoy Color Office engine -->
    <script src="gameboy-map.js"></script>
    <script src="gameboy-characters.js"></script>
    <script src="gameboy-state-bridge.js"></script>
    <script src="gameboy-mission-adapter.js"></script>
    <script src="gameboy-office.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            // Initialize UX Layer
            if (typeof SpawnKitUX !== 'undefined') {
                SpawnKitUX.init({ theme: 'gameboy-color' });
            }
            // Initialize OpenClaw Helpers
            if (typeof OpenClawHelpers !== 'undefined') {
                OpenClawHelpers.init({ theme: 'gameboy-color' });
            }
            
            const params = new URLSearchParams(window.location.search);
            const shouldBoot = params.has('boot') || !localStorage.getItem('spawnkit-booted-gameboy-color');
            
            if (shouldBoot && typeof SpawnKitBoot !== 'undefined') {
                // Create boot overlay
                const overlay = document.createElement('div');
                overlay.id = 'bootOverlay';
                overlay.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;z-index:9999;background:#1a1a2e;';
                document.body.prepend(overlay);
                
                try {
                    await SpawnKitBoot.play('gameboy-color', overlay, { 
                        soundEnabled: false, 
                        skipable: true 
                    });
                } catch(e) { console.warn('Boot skipped:', e); }
                
                localStorage.setItem('spawnkit-booted-gameboy-color', 'true');
                overlay.style.transition = 'opacity 0.5s';
                overlay.style.opacity = '0';
                setTimeout(() => overlay.remove(), 500);
            }
            
            initThemeSwitcher();
            
            // Signal UX layer that office is ready
            if (typeof SpawnKitUX !== 'undefined') {
                SpawnKitUX.ready();
            }
            
            // Update HUD with real data every 5 seconds
            function updateHUD() {
                try {
                    const data = typeof SpawnKit !== 'undefined' ? SpawnKit.data : null;
                    const ach = typeof SpawnKitAchievements !== 'undefined' ? SpawnKitAchievements : null;
                    
                    if (data) {
                        const activeMissions = (data.missions || []).filter(m => m.status === 'active').length;
                        const agents = (data.agents || []).length;
                        document.getElementById('hudQuests').textContent = '‚ö° ' + activeMissions + ' QUEST' + (activeMissions !== 1 ? 'S' : '');
                        document.getElementById('hudAgents').textContent = 'üë• ' + agents + ' TEAM';
                    }
                    if (ach) {
                        const stats = ach.getStats ? ach.getStats() : {};
                        const score = ach.getScore ? ach.getScore() : { score: 0, rank: 'ü•â' };
                        const streak = stats.streak || 0;
                        const level = Math.max(1, Math.floor(score.score / 50) + 1);
                        document.getElementById('hudLevel').textContent = 'üéÆ LV.' + level;
                        document.getElementById('hudScore').textContent = 'üèÜ ' + score.score + 'pts';
                        document.getElementById('hudStreak').textContent = 'üî• ' + streak + ' streak';
                    }
                } catch(e) {}
            }
            updateHUD();
            setInterval(updateHUD, 5000);
        });
    </script>

    <!-- SpawnKit Shared Panels Integration -->
    <script src="../src/spawnkit-panels.js"></script>
    <script src="../src/fleet-client.js"></script>
    <script src="../src/fleet-bootstrap.js"></script>
    <script>
        // Initialize SpawnKit Panels for GameBoy theme
        SpawnKitPanels.init({ theme: 'gameboy' });

        // Wire GameBoy interactions to panels
        document.addEventListener('click', function(e) {
            // Agent sprite click ‚Üí detail panel
            var sprite = e.target.closest('.agent-sprite');
            if (sprite && sprite.dataset.agent) {
                SpawnKitPanels.openAgentDetail(sprite.dataset.agent);
                return;
            }

            // GameBoy-specific interactions
            var clickedElement = e.target.closest('[data-panel]');
            if (clickedElement) {
                var panelType = clickedElement.dataset.panel;
                switch(panelType) {
                    case 'logs':
                        SpawnKitPanels.openLogsOverlay();
                        break;
                    case 'chat':
                        SpawnKitPanels.openChatOverlay();
                        break;
                    case 'cron':
                        SpawnKitPanels.openCronOverlay();
                        break;
                    case 'memory':
                        SpawnKitPanels.openMemoryOverlay();
                        break;
                    case 'missions':
                        SpawnKitPanels.openMissionsOverlay();
                        break;
                    case 'cockpit':
                        SpawnKitPanels.openCockpitOverlay();
                        break;
                }
            }
        });

        // GameBoy bonus interactions
        function addGameBoyInteractions() {
            // Speech bubbles on agents when they get tasks
            function showSpeechBubble(agentElement, text) {
                var bubble = document.createElement('div');
                bubble.style.cssText = `
                    position: absolute;
                    top: -30px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: #0f380f;
                    color: #9bbc0f;
                    padding: 4px 8px;
                    border: 2px solid #9bbc0f;
                    border-radius: 8px;
                    font-size: 8px;
                    font-family: 'Press Start 2P', monospace;
                    white-space: nowrap;
                    z-index: 100;
                    animation: gameboyBubble 3s ease-out forwards;
                `;
                bubble.textContent = text;
                agentElement.style.position = 'relative';
                agentElement.appendChild(bubble);
                setTimeout(() => bubble.remove(), 3000);
            }

            // Screen shake on decommission
            window.GameBoyShake = function() {
                document.body.style.animation = 'gameboyShake 0.5s ease-in-out';
                setTimeout(() => document.body.style.animation = '', 500);
            };

            // Add CSS for GameBoy animations
            var style = document.createElement('style');
            style.textContent = `
                @keyframes gameboyBubble {
                    0% { opacity: 0; transform: translateX(-50%) translateY(10px); }
                    10% { opacity: 1; transform: translateX(-50%) translateY(0); }
                    90% { opacity: 1; transform: translateX(-50%) translateY(0); }
                    100% { opacity: 0; transform: translateX(-50%) translateY(-10px); }
                }
                @keyframes gameboyShake {
                    0%, 100% { transform: translateX(0); }
                    10%, 30%, 50%, 70%, 90% { transform: translateX(-2px); }
                    20%, 40%, 60%, 80% { transform: translateX(2px); }
                }
            `;
            document.head.appendChild(style);

            // Listen for mission updates to show speech bubbles
            setInterval(function() {
                var agents = SpawnKitPanels.getAgents();
                Object.keys(agents).forEach(function(agentId) {
                    var agent = agents[agentId];
                    if (agent.status === 'busy' || agent.status === 'active') {
                        var agentElements = document.querySelectorAll('[data-agent="' + agentId + '"]');
                        agentElements.forEach(function(el) {
                            if (!el.querySelector('.speech-bubble') && Math.random() < 0.1) {
                                var tasks = ['BUILDING...', 'ANALYZING...', 'DEPLOYING...', 'OPTIMIZING...', 'TESTING...'];
                                showSpeechBubble(el, tasks[Math.floor(Math.random() * tasks.length)]);
                            }
                        });
                    }
                });
            }, 5000);
        }

        // Initialize GameBoy interactions
        addGameBoyInteractions();

        // Add panel trigger buttons to HUD
        function addPanelButtons() {
            var hud = document.getElementById('gameHUD');
            if (hud) {
                var buttonsHtml = `
                    <div class="hud-sep">|</div>
                    <span class="hud-item" style="cursor: pointer;" data-panel="logs">üìú LOGS</span>
                    <div class="hud-sep">|</div>
                    <span class="hud-item" style="cursor: pointer;" data-panel="chat">üí¨ CHAT</span>
                    <div class="hud-sep">|</div>
                    <span class="hud-item" style="cursor: pointer;" data-panel="missions">üéØ QUESTS</span>
                `;
                hud.insertAdjacentHTML('beforeend', buttonsHtml);
            }

            // Add a main menu in top-left corner
            var menuButton = document.createElement('div');
            menuButton.style.cssText = `
                position: absolute;
                top: 10px;
                left: 10px;
                background: #0f380f;
                color: #9bbc0f;
                border: 2px solid #9bbc0f;
                padding: 8px 12px;
                font-family: 'Press Start 2P', monospace;
                font-size: 8px;
                cursor: pointer;
                user-select: none;
                z-index: 50;
            `;
            menuButton.textContent = '‚ò∞ MENU';
            menuButton.dataset.panel = 'cockpit';
            document.body.appendChild(menuButton);
        }

        // Initialize panel buttons
        addPanelButtons();

        // GameBoy theme customization
        console.log('üéÆ GameBoy Color theme loaded with all 18 SpawnKit features!');
    </script>
</body>
</html>
