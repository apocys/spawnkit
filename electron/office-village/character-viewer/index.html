<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kenney Mini Characters â€” Isometric Viewer</title>
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #0d0f14;
    --panel: #161a24;
    --panel2: #1e2433;
    --border: #2a3045;
    --accent: #6c8ef7;
    --accent2: #a78bfa;
    --text: #e2e8f0;
    --text2: #8b95b0;
    --btn: #252d42;
    --btn-hover: #2e3850;
    --btn-active: #3d4f7c;
    --green: #4ade80;
    --red: #f87171;
  }

  html, body {
    width: 100%; height: 100%;
    background: var(--bg);
    color: var(--text);
    font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
    font-size: 14px;
    overflow: hidden;
  }

  #app {
    display: flex;
    width: 100%; height: 100%;
  }

  /* â”€â”€ Sidebar â”€â”€ */
  #sidebar {
    width: 260px;
    min-width: 220px;
    background: var(--panel);
    border-right: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    overflow: hidden;
    z-index: 10;
    flex-shrink: 0;
  }

  #sidebar-header {
    padding: 18px 16px 14px;
    border-bottom: 1px solid var(--border);
  }

  #sidebar-header h1 {
    font-size: 15px;
    font-weight: 700;
    color: var(--text);
    letter-spacing: 0.02em;
  }

  #sidebar-header p {
    font-size: 11px;
    color: var(--text2);
    margin-top: 3px;
  }

  #sidebar-body {
    padding: 14px 14px;
    flex: 1;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 16px;
  }

  .ctrl-group {
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .ctrl-label {
    font-size: 10px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--text2);
  }

  select {
    width: 100%;
    background: var(--panel2);
    border: 1px solid var(--border);
    color: var(--text);
    padding: 7px 10px;
    border-radius: 6px;
    font-size: 13px;
    cursor: pointer;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%238b95b0' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 10px center;
    padding-right: 28px;
    transition: border-color 0.15s;
  }
  select:hover { border-color: var(--accent); }
  select:focus { outline: none; border-color: var(--accent); }

  /* Direction buttons */
  .dir-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 6px;
  }

  .dir-btn {
    background: var(--btn);
    border: 1px solid var(--border);
    color: var(--text);
    padding: 8px 6px;
    border-radius: 6px;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.15s;
    text-align: center;
    letter-spacing: 0.03em;
  }
  .dir-btn:hover { background: var(--btn-hover); border-color: var(--accent); }
  .dir-btn.active { background: var(--btn-active); border-color: var(--accent); color: var(--accent); }

  /* Playback row */
  .playback-row {
    display: flex;
    gap: 8px;
    align-items: center;
  }

  #play-pause {
    flex-shrink: 0;
    width: 40px; height: 40px;
    background: var(--accent);
    border: none;
    border-radius: 50%;
    color: white;
    font-size: 16px;
    cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    transition: background 0.15s, transform 0.1s;
    box-shadow: 0 2px 8px rgba(108,142,247,0.35);
  }
  #play-pause:hover { background: #7ea1ff; transform: scale(1.05); }
  #play-pause.paused { background: var(--btn); box-shadow: none; border: 1px solid var(--border); }

  .speed-wrap {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 4px;
  }
  .speed-header {
    display: flex;
    justify-content: space-between;
    font-size: 10px;
    color: var(--text2);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.08em;
  }

  input[type=range] {
    -webkit-appearance: none;
    width: 100%;
    height: 4px;
    background: var(--border);
    border-radius: 2px;
    outline: none;
    cursor: pointer;
  }
  input[type=range]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 14px; height: 14px;
    border-radius: 50%;
    background: var(--accent);
    cursor: pointer;
    box-shadow: 0 0 0 3px rgba(108,142,247,0.2);
    transition: box-shadow 0.15s;
  }
  input[type=range]::-webkit-slider-thumb:hover {
    box-shadow: 0 0 0 5px rgba(108,142,247,0.3);
  }

  /* Separator */
  .sep {
    height: 1px;
    background: var(--border);
  }

  /* Orbit hint */
  .hint {
    font-size: 11px;
    color: var(--text2);
    line-height: 1.5;
  }
  .hint strong { color: var(--text); }

  /* Sidebar footer */
  #sidebar-footer {
    padding: 12px 14px;
    border-top: 1px solid var(--border);
    font-size: 11px;
    color: var(--text2);
    text-align: center;
  }

  /* â”€â”€ Canvas area â”€â”€ */
  #canvas-wrap {
    flex: 1;
    position: relative;
    overflow: hidden;
  }

  canvas {
    display: block;
    width: 100% !important;
    height: 100% !important;
  }

  /* Overlay HUD */
  #hud {
    position: absolute;
    top: 0; left: 0; right: 0;
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    padding: 16px 20px;
    pointer-events: none;
  }

  #hud-left {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  #char-name {
    font-size: 20px;
    font-weight: 700;
    color: var(--text);
    text-shadow: 0 2px 8px rgba(0,0,0,0.7);
    letter-spacing: 0.02em;
  }

  #anim-name {
    font-size: 13px;
    color: var(--accent);
    font-weight: 600;
    text-shadow: 0 1px 4px rgba(0,0,0,0.7);
    text-transform: uppercase;
    letter-spacing: 0.08em;
  }

  #hud-right {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 4px;
  }

  #status-dot {
    width: 8px; height: 8px;
    border-radius: 50%;
    background: var(--green);
    display: inline-block;
    margin-right: 6px;
    box-shadow: 0 0 6px var(--green);
  }
  #status-dot.paused { background: var(--red); box-shadow: 0 0 6px var(--red); }

  #status-text {
    font-size: 11px;
    color: var(--text2);
    text-shadow: 0 1px 4px rgba(0,0,0,0.7);
    font-weight: 600;
  }

  #loading-overlay {
    position: absolute;
    inset: 0;
    background: rgba(13,15,20,0.92);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 14px;
    z-index: 100;
    transition: opacity 0.4s;
  }
  #loading-overlay.hidden {
    opacity: 0;
    pointer-events: none;
  }

  .spinner {
    width: 40px; height: 40px;
    border: 3px solid var(--border);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }
  @keyframes spin { to { transform: rotate(360deg); } }

  #loading-text {
    font-size: 14px;
    color: var(--text2);
    font-weight: 500;
  }

  /* Mobile adjustments */
  @media (max-width: 600px) {
    #sidebar { width: 200px; min-width: 180px; }
    #char-name { font-size: 15px; }
  }
</style>
</head>
<body>
<div id="app">
  <!-- Sidebar -->
  <div id="sidebar">
    <div id="sidebar-header">
      <h1>ğŸ® Mini Characters</h1>
      <p>Kenney.nl â€” Isometric Viewer</p>
    </div>
    <div id="sidebar-body">

      <div class="ctrl-group">
        <div class="ctrl-label">Character</div>
        <select id="char-select">
          <option value="character-male-a">ğŸ‘¦ Male A</option>
          <option value="character-male-b">ğŸ‘¦ Male B</option>
          <option value="character-male-c">ğŸ‘¦ Male C</option>
          <option value="character-male-d">ğŸ‘¦ Male D</option>
          <option value="character-male-e">ğŸ‘¦ Male E</option>
          <option value="character-male-f">ğŸ‘¦ Male F</option>
          <option value="character-female-a">ğŸ‘§ Female A</option>
          <option value="character-female-b">ğŸ‘§ Female B</option>
          <option value="character-female-c">ğŸ‘§ Female C</option>
          <option value="character-female-d">ğŸ‘§ Female D</option>
          <option value="character-female-e">ğŸ‘§ Female E</option>
          <option value="character-female-f">ğŸ‘§ Female F</option>
        </select>
      </div>

      <div class="ctrl-group">
        <div class="ctrl-label">Animation</div>
        <select id="anim-select">
          <option value="idle">idle</option>
          <option value="walk">walk</option>
          <option value="sprint">sprint</option>
          <option value="jump">jump</option>
          <option value="fall">fall</option>
          <option value="crouch">crouch</option>
          <option value="sit">sit</option>
          <option value="drive">drive</option>
          <option value="die">die</option>
          <option value="pick-up">pick-up</option>
          <option value="emote-yes">emote-yes</option>
          <option value="emote-no">emote-no</option>
          <option value="holding-right">holding-right</option>
          <option value="holding-left">holding-left</option>
          <option value="holding-both">holding-both</option>
          <option value="holding-right-shoot">holding-right-shoot</option>
          <option value="holding-left-shoot">holding-left-shoot</option>
          <option value="holding-both-shoot">holding-both-shoot</option>
          <option value="attack-melee-right">attack-melee-right</option>
          <option value="attack-melee-left">attack-melee-left</option>
          <option value="attack-kick-right">attack-kick-right</option>
          <option value="attack-kick-left">attack-kick-left</option>
          <option value="interact-right">interact-right</option>
          <option value="interact-left">interact-left</option>
          <option value="wheelchair-sit">wheelchair-sit</option>
          <option value="wheelchair-look-left">wheelchair-look-left</option>
          <option value="wheelchair-look-right">wheelchair-look-right</option>
          <option value="wheelchair-move-forward">wheelchair-move-forward</option>
          <option value="wheelchair-move-back">wheelchair-move-back</option>
          <option value="wheelchair-move-left">wheelchair-move-left</option>
          <option value="wheelchair-move-right">wheelchair-move-right</option>
          <option value="static">static</option>
        </select>
      </div>

      <div class="sep"></div>

      <div class="ctrl-group">
        <div class="ctrl-label">View Direction</div>
        <div class="dir-grid">
          <button class="dir-btn" data-angle="45">â†— NE</button>
          <button class="dir-btn" data-angle="135">â†˜ SE</button>
          <button class="dir-btn active" data-angle="225">â†™ SW</button>
          <button class="dir-btn" data-angle="315">â†– NW</button>
        </div>
      </div>

      <div class="ctrl-group">
        <div class="ctrl-label">Orbit Angle</div>
        <input type="range" id="orbit-slider" min="0" max="360" value="225" step="1">
      </div>

      <div class="sep"></div>

      <div class="ctrl-group">
        <div class="ctrl-label">Playback</div>
        <div class="playback-row">
          <button id="play-pause" title="Play / Pause">â–¶</button>
          <div class="speed-wrap">
            <div class="speed-header">
              <span>Speed</span>
              <span id="speed-val">1.0Ã—</span>
            </div>
            <input type="range" id="speed-slider" min="0.1" max="3" value="1" step="0.05">
          </div>
        </div>
      </div>

      <div class="sep"></div>

      <div class="ctrl-group">
        <div class="ctrl-label">Orbit Controls</div>
        <div class="hint">
          <strong>Drag</strong> to orbit &nbsp;Â·&nbsp; <strong>Scroll</strong> to zoom<br>
          <strong>Right-drag</strong> to pan
        </div>
      </div>

    </div>
    <div id="sidebar-footer">Kenney Mini Characters Pack</div>
  </div>

  <!-- 3D canvas -->
  <div id="canvas-wrap">
    <div id="hud">
      <div id="hud-left">
        <div id="char-name">Male A</div>
        <div id="anim-name">IDLE</div>
      </div>
      <div id="hud-right">
        <div id="status-text"><span id="status-dot"></span>Playing</div>
      </div>
    </div>
    <div id="loading-overlay">
      <div class="spinner"></div>
      <div id="loading-text">Loading characterâ€¦</div>
    </div>
  </div>
</div>

<!-- Three.js from CDN -->
<script type="importmap">
{
  "imports": {
    "three": "https://unpkg.com/three@0.163.0/build/three.module.js",
    "three/addons/": "https://unpkg.com/three@0.163.0/examples/jsm/"
  }
}
</script>

<script type="module">
import * as THREE from 'three';
import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

// â”€â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let scene, renderer, camera, controls;
let mixer = null;
let currentAction = null;
let currentModel = null;
let clock = new THREE.Clock();
let isPlaying = true;
let animSpeed = 1.0;
let currentAnimName = 'idle';

// Camera rig angles
let azimuthDeg = 225; // camera orbit angle
const elevationDeg = 35; // fixed elevation
const camDist = 8; // distance from target

// â”€â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function init() {
  const wrap = document.getElementById('canvas-wrap');

  // Renderer
  renderer = new THREE.WebGLRenderer({ antialias: true });
  renderer.setPixelRatio(window.devicePixelRatio);
  renderer.setSize(wrap.clientWidth, wrap.clientHeight);
  renderer.shadowMap.enabled = true;
  renderer.shadowMap.type = THREE.PCFSoftShadowMap;
  renderer.outputColorSpace = THREE.SRGBColorSpace;
  renderer.toneMapping = THREE.ACESFilmicToneMapping;
  renderer.toneMappingExposure = 1.1;
  wrap.appendChild(renderer.domElement);

  // Scene
  scene = new THREE.Scene();
  scene.background = new THREE.Color(0x0d0f14);
  scene.fog = new THREE.Fog(0x0d0f14, 20, 60);

  // Orthographic Camera
  const aspect = wrap.clientWidth / wrap.clientHeight;
  const frustumH = 2.8;
  camera = new THREE.OrthographicCamera(
    -frustumH * aspect, frustumH * aspect,
    frustumH, -frustumH,
    0.01, 200
  );
  updateCameraPosition();

  // Orbit Controls (for free drag)
  controls = new OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true;
  controls.dampingFactor = 0.07;
  controls.target.set(0, 0.7, 0);
  controls.minZoom = 0.3;
  controls.maxZoom = 4;
  controls.update();

  // Keep orbit slider in sync when user drags
  controls.addEventListener('change', () => {
    // derive azimuth from camera position for slider sync
    const dx = camera.position.x - controls.target.x;
    const dz = camera.position.z - controls.target.z;
    let a = Math.atan2(dx, dz) * 180 / Math.PI;
    if (a < 0) a += 360;
    azimuthDeg = a;
    document.getElementById('orbit-slider').value = Math.round(a);
  });

  // Lights
  const ambient = new THREE.AmbientLight(0xd0d8f0, 0.9);
  scene.add(ambient);

  const sun = new THREE.DirectionalLight(0xfff4e0, 2.2);
  sun.position.set(5, 10, 5);
  sun.castShadow = true;
  sun.shadow.mapSize.set(2048, 2048);
  sun.shadow.camera.near = 0.5;
  sun.shadow.camera.far = 50;
  sun.shadow.camera.left = -5;
  sun.shadow.camera.right = 5;
  sun.shadow.camera.top = 5;
  sun.shadow.camera.bottom = -5;
  sun.shadow.bias = -0.001;
  scene.add(sun);

  // Fill light (cool, opposite)
  const fill = new THREE.DirectionalLight(0x8090c0, 0.5);
  fill.position.set(-4, 3, -6);
  scene.add(fill);

  // Ground
  buildGround();

  // Load initial character
  loadCharacter('character-male-a', 'idle');

  // Events
  window.addEventListener('resize', onResize);
  setupUI();

  // Render loop
  renderer.setAnimationLoop(render);
}

// â”€â”€â”€ Ground with Grid â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildGround() {
  // Solid ground disc
  const groundGeo = new THREE.CircleGeometry(6, 64);
  const groundMat = new THREE.MeshStandardMaterial({
    color: 0x161a24,
    roughness: 0.9,
    metalness: 0.05,
  });
  const ground = new THREE.Mesh(groundGeo, groundMat);
  ground.rotation.x = -Math.PI / 2;
  ground.receiveShadow = true;
  scene.add(ground);

  // Grid helper
  const grid = new THREE.GridHelper(10, 20, 0x2a3045, 0x1e2433);
  grid.position.y = 0.002;
  scene.add(grid);

  // Subtle rim ring
  const rimGeo = new THREE.RingGeometry(5.9, 6.1, 64);
  const rimMat = new THREE.MeshBasicMaterial({ color: 0x2a3045, side: THREE.DoubleSide });
  const rim = new THREE.Mesh(rimGeo, rimMat);
  rim.rotation.x = -Math.PI / 2;
  rim.position.y = 0.003;
  scene.add(rim);
}

// â”€â”€â”€ Camera â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateCameraPosition() {
  const elRad = elevationDeg * Math.PI / 180;
  const azRad = azimuthDeg * Math.PI / 180;
  const target = controls ? controls.target : new THREE.Vector3(0, 0.7, 0);

  camera.position.set(
    target.x + camDist * Math.sin(azRad) * Math.cos(elRad),
    target.y + camDist * Math.sin(elRad),
    target.z + camDist * Math.cos(azRad) * Math.cos(elRad)
  );
  camera.lookAt(target);
}

// â”€â”€â”€ Load Character â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const loader = new GLTFLoader();
const modelCache = {};

function loadCharacter(charId, animName) {
  showLoading(true, `Loading ${charId}â€¦`);

  if (modelCache[charId]) {
    swapModel(modelCache[charId], animName);
    return;
  }

  loader.load(
    `models/${charId}.glb`,
    (gltf) => {
      // Apply flat-ish shading to all meshes
      gltf.scene.traverse((node) => {
        if (node.isMesh) {
          node.castShadow = true;
          node.receiveShadow = true;
          if (node.material) {
            // keep texture, tweak material
            node.material.roughness = 0.85;
            node.material.metalness = 0.05;
            // subtle flat shading for Kenney look
            node.material.flatShading = false;
            node.material.needsUpdate = true;
          }
        }
      });
      modelCache[charId] = gltf;
      swapModel(gltf, animName);
    },
    undefined,
    (err) => {
      console.error('GLTF load error:', err);
      showLoading(false);
      document.getElementById('loading-text').textContent = 'Error loading model!';
    }
  );
}

function swapModel(gltf, animName) {
  // Remove old model
  if (currentModel) {
    scene.remove(currentModel);
    if (mixer) { mixer.stopAllAction(); mixer = null; }
  }

  // Clone so we can reuse cached gltf for multiple characters
  const clone = cloneGLTF(gltf);
  currentModel = clone.scene;

  // Center & place
  const box = new THREE.Box3().setFromObject(currentModel);
  const cy = box.min.y;
  currentModel.position.y = -cy;

  scene.add(currentModel);

  // Mixer
  mixer = new THREE.AnimationMixer(currentModel);
  playAnimation(animName, gltf.animations);

  showLoading(false);
}

// Simple GLTF scene cloner (reuses geometries/materials, clones scene graph)
function cloneGLTF(gltf) {
  const clonedScene = gltf.scene.clone(true);
  // Remap skinned mesh skeletons
  const skinnedMeshes = [];
  gltf.scene.traverse(n => { if (n.isSkinnedMesh) skinnedMeshes.push(n); });
  const clonedSkinnedMeshes = [];
  clonedScene.traverse(n => { if (n.isSkinnedMesh) clonedSkinnedMeshes.push(n); });

  // Return an object shaped like gltf but with cloned scene
  return { scene: clonedScene, animations: gltf.animations };
}

// â”€â”€â”€ Animation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function playAnimation(name, animations) {
  if (!mixer) return;
  const clips = animations || (currentModel._gltfAnimations || []);
  const clip = THREE.AnimationClip.findByName(clips, name);
  if (!clip) {
    console.warn('Animation not found:', name);
    return;
  }

  const newAction = mixer.clipAction(clip);

  if (currentAction && currentAction !== newAction) {
    newAction.reset();
    newAction.setEffectiveTimeScale(animSpeed);
    newAction.setEffectiveWeight(1);
    currentAction.crossFadeTo(newAction, 0.25, true);
    newAction.play();
  } else {
    newAction.reset();
    newAction.setEffectiveTimeScale(animSpeed);
    newAction.play();
  }

  currentAction = newAction;
  currentAnimName = name;
  updateHUD();
}

// â”€â”€â”€ UI Setup â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setupUI() {
  // Character select
  const charSel = document.getElementById('char-select');
  charSel.addEventListener('change', () => {
    const charId = charSel.value;
    loadCharacter(charId, currentAnimName);
    document.getElementById('char-name').textContent = charSel.options[charSel.selectedIndex].text.replace(/^.+ /, '');
  });

  // Animation select
  const animSel = document.getElementById('anim-select');
  animSel.addEventListener('change', () => {
    const animName = animSel.value;
    // Need to re-find animations from cached gltf
    const charId = charSel.value;
    const gltf = modelCache[charId];
    if (gltf) playAnimation(animName, gltf.animations);
    currentAnimName = animName;
    updateHUD();
  });

  // Direction buttons
  document.querySelectorAll('.dir-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.dir-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      azimuthDeg = parseFloat(btn.dataset.angle);
      document.getElementById('orbit-slider').value = azimuthDeg;
      updateCameraPosition();
      controls.update();
    });
  });

  // Orbit slider
  const orbitSlider = document.getElementById('orbit-slider');
  orbitSlider.addEventListener('input', () => {
    azimuthDeg = parseFloat(orbitSlider.value);
    document.querySelectorAll('.dir-btn').forEach(b => b.classList.remove('active'));
    updateCameraPosition();
    controls.update();
  });

  // Play/Pause
  const ppBtn = document.getElementById('play-pause');
  ppBtn.addEventListener('click', () => {
    isPlaying = !isPlaying;
    ppBtn.textContent = isPlaying ? 'â–¶' : 'â¸';
    ppBtn.classList.toggle('paused', !isPlaying);
    document.getElementById('status-dot').classList.toggle('paused', !isPlaying);
    document.querySelector('#status-text').innerHTML =
      `<span id="status-dot" class="${isPlaying ? '' : 'paused'}"></span>${isPlaying ? 'Playing' : 'Paused'}`;
    if (currentAction) {
      if (isPlaying) {
        currentAction.paused = false;
        clock.getDelta(); // reset delta after pause gap
      } else {
        currentAction.paused = true;
      }
    }
  });

  // Speed slider
  const speedSlider = document.getElementById('speed-slider');
  speedSlider.addEventListener('input', () => {
    animSpeed = parseFloat(speedSlider.value);
    document.getElementById('speed-val').textContent = animSpeed.toFixed(1) + 'Ã—';
    if (currentAction) currentAction.setEffectiveTimeScale(animSpeed);
  });
}

// â”€â”€â”€ HUD update â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateHUD() {
  document.getElementById('anim-name').textContent = currentAnimName.toUpperCase();
}

// â”€â”€â”€ Loading overlay â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showLoading(show, msg) {
  const el = document.getElementById('loading-overlay');
  const txt = document.getElementById('loading-text');
  if (show) {
    el.classList.remove('hidden');
    if (msg) txt.textContent = msg;
  } else {
    el.classList.add('hidden');
  }
}

// â”€â”€â”€ Resize â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function onResize() {
  const wrap = document.getElementById('canvas-wrap');
  const w = wrap.clientWidth;
  const h = wrap.clientHeight;
  const aspect = w / h;
  const frustumH = 2.8;
  camera.left   = -frustumH * aspect;
  camera.right  =  frustumH * aspect;
  camera.top    =  frustumH;
  camera.bottom = -frustumH;
  camera.updateProjectionMatrix();
  renderer.setSize(w, h);
}

// â”€â”€â”€ Render loop â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function render() {
  const dt = clock.getDelta();
  if (mixer && isPlaying) mixer.update(dt);
  controls.update();
  renderer.render(scene, camera);
}

// Boot
init();
</script>
</body>
</html>
