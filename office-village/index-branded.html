<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SpawnKit â€” Village Office</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
/* ============================================================
   iOS Brand Design System â€” Village Theme Integration  
   FeedCast Orange (#f56300) accent with natural village aesthetics
   ============================================================ */

:root {
  /* --- iOS Typography --- */
  --font-display: 'Inter', -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;
  --font-body: 'Inter', -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'Segoe UI', Roboto, sans-serif;

  /* --- iOS Color System (Warm/Natural Theme) --- */
  --color-bg-primary: #1a1a2e;
  --color-bg-secondary: #16213e;
  --color-bg-tertiary: #0f3460;
  --color-surface: #16213e;
  --color-text-primary: #f5f5f7;
  --color-text-secondary: #86868b;
  --color-text-tertiary: #636366;
  --color-border: rgba(245, 99, 0, 0.2);
  --color-border-light: rgba(245, 99, 0, 0.1);
  --color-nav-bg: rgba(26, 26, 46, 0.72);
  --color-nav-border: rgba(245, 99, 0, 0.3);

  /* --- FeedCast Brand Colors (Village = Orange Theme) --- */
  --color-accent: #f56300;
  --color-accent-hover: #ff6d0a;
  --color-accent-active: #e55a00;
  --color-accent-light: rgba(245, 99, 0, 0.1);

  /* --- Village Specific Colors --- */
  --village-green: #5f8a5f;
  --village-brown: #8b6f47;
  --village-blue: #4a90e2;
  --village-warm: #ffa726;

  /* --- Semantic Colors --- */
  --color-success: #5f8a5f;
  --color-error: #ff453a;
  --color-warning: var(--village-warm);
  --color-info: var(--village-blue);

  /* --- Spacing --- */
  --space-1: 4px;
  --space-2: 8px;
  --space-3: 12px;
  --space-4: 16px;
  --space-5: 20px;
  --space-6: 24px;

  /* --- Border Radius --- */
  --radius-sm: 8px;
  --radius-md: 12px;
  --radius-lg: 16px;
  --radius-pill: 980px;

  /* --- iOS Animations --- */
  --ease-out: cubic-bezier(0.25, 0.46, 0.45, 0.94);
  --ease-apple: cubic-bezier(0.4, 0, 0.2, 1);
  --ease-spring: cubic-bezier(0.25, 1, 0.5, 1);
  --duration-fast: 150ms;
  --duration-normal: 300ms;

  /* --- Shadows --- */
  --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.3);
  --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.3);
  --shadow-lg: 0 8px 40px rgba(0, 0, 0, 0.4);

  /* --- Village Layout --- */
  --tile-size: 16px;
  --scale: 2;
  --panel-width: 280px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Reset & Base
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
* { 
  margin: 0; 
  padding: 0; 
  box-sizing: border-box; 
}

body { 
  background: var(--color-bg-primary); 
  overflow: hidden; 
  font-family: var(--font-body);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

canvas { 
  display: block; 
  image-rendering: pixelated; 
  image-rendering: crisp-edges; 
  cursor: grab; 
}

canvas.dragging { 
  cursor: grabbing; 
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   iOS-Style Navigation Header
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#topbar {
  position: fixed; 
  top: 0; 
  left: 0; 
  right: 0; 
  height: 52px; 
  z-index: 1000;
  background: var(--color-nav-bg);
  backdrop-filter: saturate(180%) blur(20px);
  -webkit-backdrop-filter: saturate(180%) blur(20px);
  border-bottom: 1px solid var(--color-nav-border); 
  display: flex;
  align-items: center; 
  padding: 0 var(--space-5); 
  gap: var(--space-4);
  font-family: var(--font-display);
}

.nav-title { 
  color: var(--color-text-primary); 
  font-size: 1.125rem;
  font-weight: 700;
  letter-spacing: -0.01em; 
}

.nav-badge { 
  color: var(--color-accent); 
  font-size: 0.75rem;
  font-weight: 600;
  padding: 4px var(--space-2);
  border: 1px solid var(--color-accent);
  border-radius: var(--radius-pill);
  background: var(--color-accent-light);
}

.nav-spacer { 
  flex: 1; 
}

.zoom-info { 
  color: var(--color-text-secondary); 
  font-size: 0.8125rem;
  font-weight: 500;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   iOS-Style Bottom Status Bar
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#bottombar {
  position: fixed; 
  bottom: 0; 
  left: 0; 
  right: var(--panel-width); 
  min-height: 52px; 
  z-index: 100;
  background: var(--color-nav-bg);
  backdrop-filter: saturate(180%) blur(20px);
  -webkit-backdrop-filter: saturate(180%) blur(20px);
  border-top: 1px solid var(--color-nav-border); 
  display: flex;
  align-items: center; 
  padding: 0 var(--space-4); 
  gap: var(--space-3);
  font-size: 0.75rem; 
  color: var(--color-text-secondary);
  flex-wrap: wrap;
  font-family: var(--font-body);
}

.agent-stat { 
  display: flex; 
  align-items: center; 
  gap: var(--space-1); 
  cursor: pointer; 
  padding: 6px var(--space-2); 
  border-radius: var(--radius-sm);
  transition: all var(--duration-fast) var(--ease-out);
}

.agent-stat:hover { 
  background: var(--color-accent-light);
  border-color: var(--color-accent);
}

.agent-stat .dot { 
  width: 8px; 
  height: 8px; 
  border-radius: 50%; 
  flex-shrink: 0; 
}

.agent-stat .aname { 
  color: var(--color-text-primary);
  font-weight: 500;
}

.agent-stat .atask { 
  color: var(--color-text-secondary); 
  max-width: 120px; 
  overflow: hidden; 
  text-overflow: ellipsis; 
  white-space: nowrap; 
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   iOS-Style Agent Panel
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#agent-panel {
  position: fixed; 
  top: 52px; 
  right: 0; 
  width: var(--panel-width); 
  bottom: 0; 
  z-index: 99;
  background: var(--color-nav-bg);
  backdrop-filter: saturate(180%) blur(20px);
  -webkit-backdrop-filter: saturate(180%) blur(20px);
  border-left: 1px solid var(--color-nav-border);
  transform: translateX(100%); 
  transition: transform var(--duration-normal) var(--ease-spring);
  overflow-y: auto; 
  color: var(--color-text-primary);
  font-family: var(--font-body);
}

#agent-panel.open { 
  transform: translateX(0); 
}

.panel-header {
  padding: var(--space-5);
  border-bottom: 1px solid var(--color-nav-border);
  position: relative;
}

#panel-name { 
  font-size: 1.25rem;
  font-weight: 700;
  color: var(--color-text-primary);
  margin-bottom: 4px;
  letter-spacing: -0.01em;
  font-family: var(--font-display);
}

.panel-role { 
  font-size: 0.875rem;
  color: var(--color-accent);
  font-weight: 500;
}

.close-btn {
  position: absolute; 
  top: var(--space-4); 
  right: var(--space-4); 
  background: none; 
  border: 1px solid var(--color-border);
  color: var(--color-text-tertiary); 
  font-size: 1rem;
  cursor: pointer; 
  padding: 6px; 
  font-family: inherit;
  border-radius: 50%;
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all var(--duration-fast) var(--ease-out);
}

.close-btn:hover {
  background: var(--color-bg-tertiary);
  border-color: var(--color-accent);
  color: var(--color-text-primary);
}

.panel-content {
  padding: var(--space-5);
}

.field { 
  font-size: 0.8125rem;
  margin-bottom: var(--space-3);
  line-height: 1.5;
}

.field label { 
  color: var(--color-text-secondary);
  font-weight: 500;
}

.field-value {
  color: var(--color-text-primary);
  font-weight: 400;
}

.task-list { 
  margin-top: var(--space-4);
}

.task-section-title {
  font-size: 0.875rem;
  font-weight: 600;
  color: var(--color-text-primary);
  margin-bottom: var(--space-3);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.task { 
  font-size: 0.75rem;
  color: var(--color-text-secondary);
  padding: var(--space-3);
  background: var(--color-bg-tertiary);
  margin-bottom: var(--space-2);
  border-left: 3px solid var(--color-accent);
  border-radius: var(--radius-sm);
  line-height: 1.4;
}

.anim-info { 
  font-size: 0.75rem;
  color: var(--color-info);
  margin-top: var(--space-4);
  padding: var(--space-3);
  background: var(--color-bg-tertiary);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  line-height: 1.4;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   iOS-Style Loading Screen
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#loading {
  position: fixed;
  inset: 0;
  background: var(--color-bg-primary);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 2000;
  color: var(--color-accent);
  font-family: var(--font-body);
}

#loading h2 {
  font-family: var(--font-display);
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--color-text-primary);
  margin-bottom: var(--space-3);
  letter-spacing: -0.02em;
}

#loading .subtitle {
  font-size: 0.9375rem;
  color: var(--color-text-secondary);
  margin-bottom: var(--space-5);
}

.loading-bar {
  width: 200px;
  height: 4px;
  background: var(--color-bg-tertiary);
  border-radius: var(--radius-pill);
  overflow: hidden;
}

.loading-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--color-accent), var(--color-accent-hover));
  width: 0%;
  transition: width 0.3s var(--ease-apple);
  border-radius: var(--radius-pill);
}

.loading-fade {
  opacity: 1;
  transition: opacity var(--duration-normal) var(--ease-out);
}

.loading-fade.hidden {
  opacity: 0;
  pointer-events: none;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   iOS-Style Tooltip
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.village-tooltip {
  position: fixed;
  background: var(--color-nav-bg);
  backdrop-filter: saturate(180%) blur(20px);
  -webkit-backdrop-filter: saturate(180%) blur(20px);
  border: 1px solid var(--color-nav-border);
  border-radius: var(--radius-md);
  padding: var(--space-3);
  color: var(--color-text-primary);
  font-size: 0.75rem;
  line-height: 1.4;
  max-width: 200px;
  z-index: 200;
  display: none;
  pointer-events: none;
  box-shadow: var(--shadow-md);
  font-family: var(--font-body);
}

.tooltip-name {
  font-weight: 600;
  color: var(--color-text-primary);
  margin-bottom: 2px;
}

.tooltip-role {
  color: var(--color-accent);
  font-size: 0.6875rem;
  margin-bottom: 4px;
}

.tooltip-info {
  color: var(--color-text-secondary);
  font-size: 0.6875rem;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Responsive Design
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media (max-width: 768px) {
  #agent-panel {
    width: 100%;
    max-width: var(--panel-width);
  }

  #bottombar {
    right: 0;
  }

  #topbar {
    padding: 0 var(--space-4);
  }

  .nav-title {
    font-size: 1rem;
  }
}

@media (max-width: 480px) {
  #topbar {
    height: 48px;
  }

  #agent-panel {
    top: 48px;
  }

  .zoom-info {
    display: none;
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Village-specific Canvas Styling
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#game {
  background: var(--color-bg-primary);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Agent Status Colors (Village Theme)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.status-active { background-color: var(--color-success) !important; }
.status-busy { background-color: var(--color-warning) !important; }
.status-idle { background-color: var(--color-text-secondary) !important; }
.status-error { background-color: var(--color-error) !important; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   iOS Button Component
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.btn-primary {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-2);
  padding: 12px 24px;
  font-family: var(--font-body);
  font-size: 0.9375rem;
  font-weight: 600;
  line-height: 1;
  text-decoration: none;
  border: none;
  border-radius: var(--radius-pill);
  cursor: pointer;
  transition: all var(--duration-fast) var(--ease-out);
  white-space: nowrap;
  background-color: var(--color-accent);
  color: white;
}

.btn-primary:hover {
  background-color: var(--color-accent-hover);
  transform: translateY(-1px);
  text-decoration: none;
}

.btn-primary:active {
  background-color: var(--color-accent-active);
  transform: translateY(0);
}
</style>
</head>
<body>
  <!-- iOS-Style Navigation -->
  <div id="topbar">
    <span class="nav-title">ğŸ¡ SpawnKit Village</span>
    <span class="nav-badge" id="mode-badge">VILLAGE</span>
    <span class="nav-spacer"></span>
    <span id="zoom-info" class="zoom-info">100%</span>
  </div>

  <!-- Main Canvas -->
  <canvas id="game"></canvas>

  <!-- iOS-Style Status Bar -->
  <div id="bottombar">
    <!-- populated by JavaScript -->
  </div>

  <!-- iOS-Style Agent Panel -->
  <div id="agent-panel">
    <div class="panel-header">
      <button class="close-btn" onclick="closePanel()">Ã—</button>
      <h2 id="panel-name">â€”</h2>
      <div class="panel-role" id="panel-role">â€”</div>
    </div>
    
    <div class="panel-content">
      <div class="field">
        <label>Status: </label>
        <span class="field-value" id="panel-status">â€”</span>
      </div>
      <div class="field">
        <label>Animation: </label>
        <span class="field-value" id="panel-anim">â€”</span>
      </div>
      <div class="field">
        <label>Location: </label>
        <span class="field-value" id="panel-location">â€”</span>
      </div>
      
      <div class="task-list">
        <div class="task-section-title">Current Tasks</div>
        <div id="panel-tasks">
          <!-- populated by JavaScript -->
        </div>
      </div>
      
      <div class="anim-info" id="panel-anim-info">â€”</div>
    </div>
  </div>

  <!-- iOS-Style Loading Screen -->
  <div id="loading" class="loading-fade">
    <h2>Loading SpawnKit Village</h2>
    <div class="subtitle">Building your cozy AI workspace...</div>
    <div class="loading-bar">
      <div class="loading-fill" id="loading-fill"></div>
    </div>
  </div>

  <!-- Village Tooltip -->
  <div class="village-tooltip" id="village-tooltip">
    <div class="tooltip-name"></div>
    <div class="tooltip-role"></div>
    <div class="tooltip-info"></div>
  </div>

  <script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // SpawnKit Village Theme JavaScript with iOS Integration
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    'use strict';

    // Configuration
    const TILE = 16;
    const SCALE = 2;
    const T = TILE * SCALE;
    const FPS_ANIM = 8;
    const MOVE_SPEED = 1.0;
    const SPRITE_DRAW_SIZE = 50;
    const SPRITE_FRAMES = 8;

    // Global variables
    let canvas, ctx;
    let panX = 0, panY = 0, zoom = 1.0;
    let isDragging = false, lastMouseX = 0, lastMouseY = 0;
    let agents = [];
    let buildings = [];
    let selectedAgent = null;
    let animationFrame = 0;

    // Agent definitions with iOS branding
    const agentData = [
      {
        id: 'ceo',
        name: 'CEO Agent',
        role: 'Strategic Leadership',
        color: '#f56300',
        icon: 'ğŸ‘‘',
        tasks: ['Review quarterly reports', 'Strategic planning session', 'Board meeting preparation'],
        x: 3, y: 3
      },
      {
        id: 'atlas',
        name: 'Atlas Agent', 
        role: 'Knowledge Mapping',
        color: '#64d2ff',
        icon: 'ğŸ—ºï¸',
        tasks: ['Update knowledge base', 'Document new processes', 'Data architecture review'],
        x: 8, y: 4
      },
      {
        id: 'forge',
        name: 'Forge Agent',
        role: 'Development & Build',
        color: '#ffd60a', 
        icon: 'ğŸ”¨',
        tasks: ['Code review', 'Build pipeline optimization', 'Feature development'],
        x: 12, y: 6
      },
      {
        id: 'hunter',
        name: 'Hunter Agent',
        role: 'Data Collection',
        color: '#ff453a',
        icon: 'ğŸ¯', 
        tasks: ['Market research', 'Competitor analysis', 'Data gathering'],
        x: 6, y: 8
      },
      {
        id: 'echo',
        name: 'Echo Agent',
        role: 'Communication Hub',
        color: '#0077ed',
        icon: 'ğŸ“¡',
        tasks: ['Message routing', 'Status updates', 'Team coordination'],
        x: 15, y: 3
      },
      {
        id: 'sentinel',
        name: 'Sentinel Agent',
        role: 'Security & Monitoring',
        color: '#30d158',
        icon: 'ğŸ›¡ï¸',
        tasks: ['Security audit', 'Threat monitoring', 'Access control'],
        x: 10, y: 10
      }
    ];

    // Initialize the application
    function init() {
      canvas = document.getElementById('game');
      ctx = canvas.getContext('2d');
      
      resizeCanvas();
      window.addEventListener('resize', resizeCanvas);
      
      setupEventListeners();
      initializeAgents();
      initializeBuildings();
      
      // Start render loop
      gameLoop();
      
      // Simulate loading
      simulateLoading();
      
      // Update status bar
      updateStatusBar();
    }

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }

    function setupEventListeners() {
      // Mouse events for panning
      canvas.addEventListener('mousedown', startPan);
      canvas.addEventListener('mousemove', handlePan);
      canvas.addEventListener('mouseup', endPan);
      canvas.addEventListener('mouseleave', endPan);
      
      // Mouse events for agent selection
      canvas.addEventListener('click', handleClick);
      
      // Tooltip events
      canvas.addEventListener('mousemove', handleTooltip);
      canvas.addEventListener('mouseleave', hideTooltip);
    }

    function initializeAgents() {
      agents = agentData.map((data, index) => ({
        ...data,
        worldX: data.x * T,
        worldY: data.y * T,
        targetX: data.x * T,
        targetY: data.y * T,
        status: Math.random() > 0.3 ? 'active' : 'busy',
        animFrame: Math.floor(Math.random() * SPRITE_FRAMES),
        lastUpdate: Date.now()
      }));
    }

    function initializeBuildings() {
      buildings = [
        { x: 1, y: 1, width: 3, height: 2, type: 'headquarters', name: 'HQ' },
        { x: 5, y: 2, width: 2, height: 2, type: 'office', name: 'Dev Lab' },
        { x: 9, y: 1, width: 2, height: 1, type: 'storage', name: 'Data Center' },
        { x: 13, y: 5, width: 3, height: 2, type: 'factory', name: 'Build Farm' },
        { x: 2, y: 7, width: 2, height: 2, type: 'house', name: 'Rest Area' },
        { x: 7, y: 9, width: 4, height: 2, type: 'market', name: 'Resource Hub' }
      ];
    }

    function startPan(e) {
      isDragging = true;
      lastMouseX = e.clientX;
      lastMouseY = e.clientY;
      canvas.classList.add('dragging');
    }

    function handlePan(e) {
      if (!isDragging) return;
      
      const deltaX = e.clientX - lastMouseX;
      const deltaY = e.clientY - lastMouseY;
      
      panX += deltaX / zoom;
      panY += deltaY / zoom;
      
      lastMouseX = e.clientX;
      lastMouseY = e.clientY;
    }

    function endPan() {
      isDragging = false;
      canvas.classList.remove('dragging');
    }

    function handleClick(e) {
      const rect = canvas.getBoundingClientRect();
      const mouseX = (e.clientX - rect.left) / zoom - panX;
      const mouseY = (e.clientY - rect.top) / zoom - panY;
      
      // Check if clicking on an agent
      for (let agent of agents) {
        const agentScreenX = agent.worldX;
        const agentScreenY = agent.worldY;
        
        if (mouseX >= agentScreenX - SPRITE_DRAW_SIZE/2 && 
            mouseX <= agentScreenX + SPRITE_DRAW_SIZE/2 &&
            mouseY >= agentScreenY - SPRITE_DRAW_SIZE/2 && 
            mouseY <= agentScreenY + SPRITE_DRAW_SIZE/2) {
          selectAgent(agent);
          return;
        }
      }
    }

    function selectAgent(agent) {
      selectedAgent = agent;
      showAgentPanel(agent);
    }

    function showAgentPanel(agent) {
      const panel = document.getElementById('agent-panel');
      const statusColors = {
        active: '#30d158',
        busy: '#ffd60a',
        idle: '#86868b',
        error: '#ff453a'
      };
      
      document.getElementById('panel-name').textContent = agent.name;
      document.getElementById('panel-role').textContent = agent.role;
      document.getElementById('panel-status').textContent = agent.status;
      document.getElementById('panel-status').style.color = statusColors[agent.status];
      document.getElementById('panel-anim').textContent = `Frame ${agent.animFrame + 1}/${SPRITE_FRAMES}`;
      document.getElementById('panel-location').textContent = `(${Math.floor(agent.worldX/T)}, ${Math.floor(agent.worldY/T)})`;
      
      // Update tasks
      const tasksContainer = document.getElementById('panel-tasks');
      tasksContainer.innerHTML = '';
      agent.tasks.forEach(task => {
        const taskElement = document.createElement('div');
        taskElement.className = 'task';
        taskElement.textContent = task;
        tasksContainer.appendChild(taskElement);
      });
      
      document.getElementById('panel-anim-info').textContent = 
        `Agent is currently ${agent.status} and moving through the village workspace.`;
      
      panel.classList.add('open');
    }

    function closePanel() {
      document.getElementById('agent-panel').classList.remove('open');
      selectedAgent = null;
    }

    function handleTooltip(e) {
      const rect = canvas.getBoundingClientRect();
      const mouseX = (e.clientX - rect.left) / zoom - panX;
      const mouseY = (e.clientY - rect.top) / zoom - panY;
      
      // Check if hovering over an agent
      for (let agent of agents) {
        const agentScreenX = agent.worldX;
        const agentScreenY = agent.worldY;
        
        if (mouseX >= agentScreenX - SPRITE_DRAW_SIZE/2 && 
            mouseX <= agentScreenX + SPRITE_DRAW_SIZE/2 &&
            mouseY >= agentScreenY - SPRITE_DRAW_SIZE/2 && 
            mouseY <= agentScreenY + SPRITE_DRAW_SIZE/2) {
          showTooltip(agent, e.clientX + 10, e.clientY - 10);
          return;
        }
      }
      
      hideTooltip();
    }

    function showTooltip(agent, x, y) {
      const tooltip = document.getElementById('village-tooltip');
      tooltip.querySelector('.tooltip-name').textContent = agent.name;
      tooltip.querySelector('.tooltip-role').textContent = agent.role;
      tooltip.querySelector('.tooltip-info').textContent = `Status: ${agent.status} | Tasks: ${agent.tasks.length}`;
      
      tooltip.style.left = x + 'px';
      tooltip.style.top = y + 'px';
      tooltip.style.display = 'block';
    }

    function hideTooltip() {
      document.getElementById('village-tooltip').style.display = 'none';
    }

    function updateStatusBar() {
      const statusBar = document.getElementById('bottombar');
      statusBar.innerHTML = '';
      
      agents.forEach(agent => {
        const agentStat = document.createElement('div');
        agentStat.className = 'agent-stat';
        agentStat.onclick = () => selectAgent(agent);
        
        const statusColors = {
          active: '#30d158',
          busy: '#ffd60a', 
          idle: '#86868b',
          error: '#ff453a'
        };
        
        agentStat.innerHTML = `
          <div class="dot" style="background-color: ${statusColors[agent.status]}"></div>
          <span class="aname">${agent.name}</span>
          <span class="atask">${agent.tasks[0] || 'Idle'}</span>
        `;
        
        statusBar.appendChild(agentStat);
      });
    }

    function gameLoop() {
      update();
      render();
      requestAnimationFrame(gameLoop);
    }

    function update() {
      const now = Date.now();
      
      agents.forEach(agent => {
        // Simple animation frame cycling
        if (now - agent.lastUpdate > 1000 / FPS_ANIM) {
          agent.animFrame = (agent.animFrame + 1) % SPRITE_FRAMES;
          agent.lastUpdate = now;
        }
        
        // Simple movement (agents wander around)
        if (Math.random() < 0.01) {
          agent.targetX = Math.random() * canvas.width;
          agent.targetY = Math.random() * canvas.height;
        }
        
        // Move towards target
        const dx = agent.targetX - agent.worldX;
        const dy = agent.targetY - agent.worldY;
        const dist = Math.sqrt(dx * dx + dy * dy);
        
        if (dist > 5) {
          agent.worldX += (dx / dist) * MOVE_SPEED;
          agent.worldY += (dy / dist) * MOVE_SPEED;
        }
      });
      
      // Update zoom info
      document.getElementById('zoom-info').textContent = Math.round(zoom * 100) + '%';
    }

    function render() {
      // Clear canvas
      ctx.fillStyle = '#1a1a2e';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      // Apply transformations
      ctx.save();
      ctx.scale(zoom, zoom);
      ctx.translate(panX, panY);
      
      // Draw grid
      drawGrid();
      
      // Draw buildings
      drawBuildings();
      
      // Draw agents
      drawAgents();
      
      ctx.restore();
    }

    function drawGrid() {
      ctx.strokeStyle = 'rgba(245, 99, 0, 0.1)';
      ctx.lineWidth = 1;
      
      const gridSize = T;
      const startX = Math.floor(-panX / gridSize) * gridSize;
      const startY = Math.floor(-panY / gridSize) * gridSize;
      const endX = startX + (canvas.width / zoom) + gridSize;
      const endY = startY + (canvas.height / zoom) + gridSize;
      
      ctx.beginPath();
      for (let x = startX; x <= endX; x += gridSize) {
        ctx.moveTo(x, startY);
        ctx.lineTo(x, endY);
      }
      for (let y = startY; y <= endY; y += gridSize) {
        ctx.moveTo(startX, y);
        ctx.lineTo(endX, y);
      }
      ctx.stroke();
    }

    function drawBuildings() {
      const buildingColors = {
        headquarters: '#f56300',
        office: '#64d2ff', 
        storage: '#ffd60a',
        factory: '#30d158',
        house: '#ff453a',
        market: '#8b5cf6'
      };
      
      buildings.forEach(building => {
        ctx.fillStyle = buildingColors[building.type] || '#666';
        ctx.fillRect(
          building.x * T,
          building.y * T, 
          building.width * T,
          building.height * T
        );
        
        // Building name
        ctx.fillStyle = 'white';
        ctx.font = '12px Inter, sans-serif';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(
          building.name,
          building.x * T + (building.width * T) / 2,
          building.y * T + (building.height * T) / 2
        );
      });
    }

    function drawAgents() {
      agents.forEach(agent => {
        // Agent body (simplified representation)
        ctx.fillStyle = agent.color;
        ctx.beginPath();
        ctx.arc(agent.worldX, agent.worldY, SPRITE_DRAW_SIZE / 3, 0, Math.PI * 2);
        ctx.fill();
        
        // Status indicator
        const statusColors = {
          active: '#30d158',
          busy: '#ffd60a',
          idle: '#86868b', 
          error: '#ff453a'
        };
        
        ctx.fillStyle = statusColors[agent.status];
        ctx.beginPath();
        ctx.arc(agent.worldX + 15, agent.worldY - 15, 5, 0, Math.PI * 2);
        ctx.fill();
        
        // Agent icon
        ctx.fillStyle = 'white';
        ctx.font = '20px Arial';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(agent.icon, agent.worldX, agent.worldY);
        
        // Selection indicator
        if (selectedAgent === agent) {
          ctx.strokeStyle = '#f56300';
          ctx.lineWidth = 3;
          ctx.beginPath();
          ctx.arc(agent.worldX, agent.worldY, SPRITE_DRAW_SIZE / 2, 0, Math.PI * 2);
          ctx.stroke();
        }
      });
    }

    function simulateLoading() {
      const loading = document.getElementById('loading');
      const fill = document.getElementById('loading-fill');
      let progress = 0;
      
      const interval = setInterval(() => {
        progress += Math.random() * 12;
        if (progress > 100) progress = 100;
        
        fill.style.width = progress + '%';
        
        if (progress >= 100) {
          clearInterval(interval);
          setTimeout(() => {
            loading.classList.add('hidden');
          }, 500);
        }
      }, 120);
    }

    // Initialize when DOM is ready
    document.addEventListener('DOMContentLoaded', init);

    // Global functions for UI
    window.closePanel = closePanel;
    
    console.log('ğŸ¡ SpawnKit Village theme loaded with iOS branding');
  </script>
</body>
</html>