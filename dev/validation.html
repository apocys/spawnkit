<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpawnKit v2 - Validation Test</title>
    <style>
        body {
            font-family: 'Monaco', monospace;
            background: #1a1a1a;
            color: #00ff00;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            border: 1px solid #333;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        .pass { color: #00ff00; }
        .fail { color: #ff0000; }
        .info { color: #00ffff; }
        pre {
            background: #000;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>SpawnKit v2 - System Validation</h1>
    
    <div class="test-section">
        <h2>1. Data Bridge Test</h2>
        <div id="dataBridgeTest">Loading...</div>
    </div>
    
    <div class="test-section">
        <h2>2. Theme System Test</h2>
        <div id="themeSystemTest">Loading...</div>
    </div>
    
    <div class="test-section">
        <h2>3. Event System Test</h2>
        <div id="eventSystemTest">Loading...</div>
    </div>
    
    <div class="test-section">
        <h2>4. Data Structure Validation</h2>
        <div id="dataValidationTest">Loading...</div>
    </div>
    
    <div class="test-section">
        <h2>5. Live Data Preview</h2>
        <div id="dataPreview">Loading...</div>
    </div>

    <!-- Include the data bridge -->
    <script src="data-bridge.js"></script>
    <script src="theme-switcher.js"></script>
    
    <script>
        // Validation tests
        document.addEventListener('DOMContentLoaded', function() {
            // Wait for data bridge to initialize
            setTimeout(runTests, 500);
        });
        
        function runTests() {
            testDataBridge();
            testThemeSystem(); 
            testEventSystem();
            testDataStructure();
            showDataPreview();
        }
        
        function testDataBridge() {
            const results = [];
            
            // Check if SpawnKit exists
            if (typeof SpawnKit !== 'undefined') {
                results.push('<span class="pass">‚úÖ SpawnKit global object exists</span>');
            } else {
                results.push('<span class="fail">‚ùå SpawnKit global object missing</span>');
                return;
            }
            
            // Check data structure
            if (SpawnKit.data) {
                results.push('<span class="pass">‚úÖ SpawnKit.data available</span>');
                
                const requiredKeys = ['agents', 'subagents', 'missions', 'crons', 'metrics', 'events'];
                requiredKeys.forEach(key => {
                    if (SpawnKit.data[key]) {
                        results.push(`<span class="pass">‚úÖ SpawnKit.data.${key} exists</span>`);
                    } else {
                        results.push(`<span class="fail">‚ùå SpawnKit.data.${key} missing</span>`);
                    }
                });
            } else {
                results.push('<span class="fail">‚ùå SpawnKit.data not available</span>');
            }
            
            // Check API functions
            if (SpawnKit.api) {
                results.push('<span class="pass">‚úÖ SpawnKit.api available</span>');
            } else {
                results.push('<span class="fail">‚ùå SpawnKit.api missing</span>');
            }
            
            document.getElementById('dataBridgeTest').innerHTML = results.join('<br>');
        }
        
        function testThemeSystem() {
            const results = [];
            
            // Check theme switcher functions
            if (typeof initThemeSwitcher === 'function') {
                results.push('<span class="pass">‚úÖ initThemeSwitcher function available</span>');
            } else {
                results.push('<span class="fail">‚ùå initThemeSwitcher function missing</span>');
            }
            
            if (typeof switchTheme === 'function') {
                results.push('<span class="pass">‚úÖ switchTheme function available</span>');
            } else {
                results.push('<span class="fail">‚ùå switchTheme function missing</span>');
            }
            
            // Check localStorage theme
            const savedTheme = localStorage.getItem('spawnkit-theme');
            if (savedTheme) {
                results.push(`<span class="info">‚ÑπÔ∏è Saved theme: ${savedTheme}</span>`);
            } else {
                results.push('<span class="info">‚ÑπÔ∏è No saved theme (first run)</span>');
            }
            
            document.getElementById('themeSystemTest').innerHTML = results.join('<br>');
        }
        
        function testEventSystem() {
            const results = [];
            
            // Check event functions
            if (typeof SpawnKit.on === 'function') {
                results.push('<span class="pass">‚úÖ SpawnKit.on function available</span>');
            } else {
                results.push('<span class="fail">‚ùå SpawnKit.on function missing</span>');
            }
            
            if (typeof SpawnKit.emit === 'function') {
                results.push('<span class="pass">‚úÖ SpawnKit.emit function available</span>');
            } else {
                results.push('<span class="fail">‚ùå SpawnKit.emit function missing</span>');
            }
            
            // Test event listening
            let eventReceived = false;
            SpawnKit.on('test:event', () => {
                eventReceived = true;
            });
            
            SpawnKit.emit('test:event', { test: true });
            
            if (eventReceived) {
                results.push('<span class="pass">‚úÖ Event system working</span>');
            } else {
                results.push('<span class="fail">‚ùå Event system not working</span>');
            }
            
            document.getElementById('eventSystemTest').innerHTML = results.join('<br>');
        }
        
        function testDataStructure() {
            const results = [];
            
            if (!SpawnKit.data) {
                results.push('<span class="fail">‚ùå No data to validate</span>');
                document.getElementById('dataValidationTest').innerHTML = results.join('<br>');
                return;
            }
            
            // Validate agents
            if (Array.isArray(SpawnKit.data.agents)) {
                results.push(`<span class="pass">‚úÖ ${SpawnKit.data.agents.length} agents loaded</span>`);
                
                const requiredAgentFields = ['id', 'name', 'role', 'status', 'emoji'];
                const agent = SpawnKit.data.agents[0];
                if (agent) {
                    requiredAgentFields.forEach(field => {
                        if (agent[field]) {
                            results.push(`<span class="pass">‚úÖ Agent.${field} present</span>`);
                        } else {
                            results.push(`<span class="fail">‚ùå Agent.${field} missing</span>`);
                        }
                    });
                }
            } else {
                results.push('<span class="fail">‚ùå Agents not an array</span>');
            }
            
            // Validate missions
            if (Array.isArray(SpawnKit.data.missions)) {
                results.push(`<span class="pass">‚úÖ ${SpawnKit.data.missions.length} missions loaded</span>`);
            } else {
                results.push('<span class="fail">‚ùå Missions not an array</span>');
            }
            
            // Validate metrics
            if (SpawnKit.data.metrics && typeof SpawnKit.data.metrics === 'object') {
                const metricCount = Object.keys(SpawnKit.data.metrics).length;
                results.push(`<span class="pass">‚úÖ ${metricCount} metrics loaded</span>`);
            } else {
                results.push('<span class="fail">‚ùå Metrics not an object</span>');
            }
            
            document.getElementById('dataValidationTest').innerHTML = results.join('<br>');
        }
        
        function showDataPreview() {
            if (!SpawnKit.data) {
                document.getElementById('dataPreview').innerHTML = '<span class="fail">No data available</span>';
                return;
            }
            
            const preview = `
                <div class="info">
                    <strong>Agents:</strong> ${SpawnKit.data.agents.length} (${SpawnKit.data.agents.filter(a => a.status === 'active').length} active)<br>
                    <strong>Subagents:</strong> ${SpawnKit.data.subagents.length} (${SpawnKit.data.subagents.filter(s => s.status === 'running').length} running)<br>
                    <strong>Missions:</strong> ${SpawnKit.data.missions.length} (${SpawnKit.data.missions.filter(m => m.status === 'in_progress').length} in progress)<br>
                    <strong>Crons:</strong> ${SpawnKit.data.crons.length} (${SpawnKit.data.crons.filter(c => c.status === 'active').length} active)<br>
                    <strong>Tokens Today:</strong> ${SpawnKit.data.metrics.tokensToday.toLocaleString()}<br>
                    <strong>API Calls Today:</strong> ${SpawnKit.data.metrics.apiCallsToday.toLocaleString()}<br>
                    <strong>System Uptime:</strong> ${SpawnKit.data.metrics.uptime}
                </div>
                
                <h3>Sample Agent Data:</h3>
                <pre>${JSON.stringify(SpawnKit.data.agents[0], null, 2)}</pre>
                
                <h3>Sample Mission Data:</h3>
                <pre>${JSON.stringify(SpawnKit.data.missions[0], null, 2)}</pre>
            `;
            
            document.getElementById('dataPreview').innerHTML = preview;
        }
        
        // Add some real-time updates to show the system working
        SpawnKit.on('data:refresh', () => {
            const timestamp = new Date().toLocaleTimeString();
            console.log(`[${timestamp}] Data refreshed automatically`);
        });
        
        // Show console instructions
        console.log('üöÄ SpawnKit v2 Validation System');
        console.log('Try these commands:');
        console.log('  SpawnKit.data.agents - View all agents');
        console.log('  SpawnKit.data.missions - View all missions');
        console.log('  SpawnKit.emit("test", {data: "hello"}) - Emit test event');
        console.log('  SpawnKit.refresh() - Manually refresh data');
    </script>
</body>
</html>