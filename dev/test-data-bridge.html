<!DOCTYPE html>
<html>
<head>
    <title>SpawnKit Data Bridge Test</title>
    <style>
        body { font-family: monospace; background: #0a0a0f; color: #00FF41; padding: 20px; }
        .test-section { margin: 20px 0; border: 1px solid #00FF41; padding: 15px; }
        .test-title { color: #00FFFF; font-size: 18px; font-weight: bold; }
        pre { background: #1a1a2e; padding: 10px; border-radius: 4px; overflow-x: auto; }
        .pass { color: #00FF41; }
        .fail { color: #FF073A; }
    </style>
</head>
<body>
    <h1>ðŸš€ SpawnKit Data Bridge Connection Test</h1>
    
    <div class="test-section">
        <div class="test-title">1. Data Bridge Initialization</div>
        <div id="init-test">Loading...</div>
    </div>
    
    <div class="test-section">
        <div class="test-title">2. Agent Data</div>
        <pre id="agent-data">Loading...</pre>
    </div>
    
    <div class="test-section">
        <div class="test-title">3. System Metrics</div>
        <pre id="metrics-data">Loading...</pre>
    </div>
    
    <div class="test-section">
        <div class="test-title">4. Missions</div>
        <pre id="mission-data">Loading...</pre>
    </div>
    
    <div class="test-section">
        <div class="test-title">5. Event System</div>
        <div id="event-test">Testing...</div>
    </div>

    <script src="../src/data-bridge.js"></script>
    <script>
        function runTests() {
            // Test 1: SpawnKit availability
            const initTest = document.getElementById('init-test');
            if (typeof SpawnKit !== 'undefined') {
                initTest.innerHTML = '<span class="pass">âœ“ SpawnKit object is available</span>';
            } else {
                initTest.innerHTML = '<span class="fail">âœ— SpawnKit object not found</span>';
                return;
            }

            // Test 2: Agent data
            const agentData = document.getElementById('agent-data');
            if (SpawnKit.data && SpawnKit.data.agents) {
                const agents = SpawnKit.data.agents.map(a => ({
                    id: a.id,
                    name: a.name,
                    role: a.role,
                    status: a.status,
                    currentTask: a.currentTask
                }));
                agentData.textContent = JSON.stringify(agents, null, 2);
            } else {
                agentData.innerHTML = '<span class="fail">âœ— No agent data found</span>';
            }

            // Test 3: System metrics
            const metricsData = document.getElementById('metrics-data');
            if (SpawnKit.data && SpawnKit.data.metrics) {
                const metrics = {
                    tokensToday: SpawnKit.data.metrics.tokensToday,
                    apiCallsToday: SpawnKit.data.metrics.apiCallsToday,
                    activeAgents: SpawnKit.data.metrics.activeAgents,
                    uptime: SpawnKit.data.metrics.uptime,
                    memoryUsage: SpawnKit.data.metrics.memoryUsage,
                    successRate: SpawnKit.data.metrics.successRate
                };
                metricsData.textContent = JSON.stringify(metrics, null, 2);
            } else {
                metricsData.innerHTML = '<span class="fail">âœ— No metrics data found</span>';
            }

            // Test 4: Mission data
            const missionData = document.getElementById('mission-data');
            if (SpawnKit.data && SpawnKit.data.missions) {
                const missions = SpawnKit.data.missions.map(m => ({
                    id: m.id,
                    title: m.title,
                    status: m.status,
                    progress: m.progress,
                    assignedTo: m.assignedTo
                }));
                missionData.textContent = JSON.stringify(missions, null, 2);
            } else {
                missionData.innerHTML = '<span class="fail">âœ— No mission data found</span>';
            }

            // Test 5: Event system
            const eventTest = document.getElementById('event-test');
            try {
                let eventReceived = false;
                
                SpawnKit.on('test:event', function(data) {
                    eventReceived = true;
                    eventTest.innerHTML += '<br><span class="pass">âœ“ Event received: ' + JSON.stringify(data) + '</span>';
                });

                // Trigger a test event
                setTimeout(() => {
                    SpawnKit.emit('test:event', { message: 'Event system working!' });
                    
                    setTimeout(() => {
                        if (eventReceived) {
                            eventTest.innerHTML = '<span class="pass">âœ“ Event system is functional</span>' + eventTest.innerHTML;
                        } else {
                            eventTest.innerHTML = '<span class="fail">âœ— Event system not working</span>';
                        }
                    }, 100);
                }, 100);
                
            } catch (error) {
                eventTest.innerHTML = '<span class="fail">âœ— Event system error: ' + error.message + '</span>';
            }
        }

        // Run tests when SpawnKit is ready
        if (typeof SpawnKit !== 'undefined') {
            runTests();
        } else {
            document.addEventListener('DOMContentLoaded', function() {
                setTimeout(runTests, 1000);
            });
        }
    </script>
</body>
</html>